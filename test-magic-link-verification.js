const fetch = require('node-fetch');

const BASE_URL = 'http://localhost:3000';

async function testMagicLinkVerification() {
  console.log('üîó Testing Magic Link Verification Endpoints...\n');

  // Test with invalid token (should fail)
  const testCases = [
    {
      name: 'Individual Verification (Invalid Token)',
      endpoint: '/api/auth/verify-magic-link',
      token: 'invalid-token',
      userType: 'individual'
    },
    {
      name: 'Therapist Verification (Invalid Token)',
      endpoint: '/api/therapist/verify-magic-link',
      token: 'invalid-token'
    },
    {
      name: 'Partner Verification (Invalid Token)',
      endpoint: '/api/partner/verify-magic-link',
      token: 'invalid-token'
    }
  ];

  for (const testCase of testCases) {
    console.log(`Testing ${testCase.name}...`);
    try {
      const response = await fetch(`${BASE_URL}${testCase.endpoint}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          token: testCase.token,
          userType: testCase.userType
        })
      });
      
      const data = await response.json();
      console.log(`   Status: ${response.status}`);
      console.log(`   Response:`, data);
      
      if (response.status === 400) {
        console.log('   ‚úÖ Correctly rejected invalid token');
      } else {
        console.log('   ‚ö†Ô∏è Unexpected response for invalid token');
      }
      console.log('');
    } catch (error) {
      console.log(`   ‚ùå Error: ${error.message}\n`);
    }
  }

  // Test missing token (should fail)
  console.log('Testing Missing Token...');
  try {
    const response = await fetch(`${BASE_URL}/api/auth/verify-magic-link`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({})
    });
    
    const data = await response.json();
    console.log(`   Status: ${response.status}`);
    console.log(`   Response:`, data);
    
    if (response.status === 400) {
      console.log('   ‚úÖ Correctly rejected missing token');
    } else {
      console.log('   ‚ö†Ô∏è Unexpected response for missing token');
    }
    console.log('');
  } catch (error) {
    console.log(`   ‚ùå Error: ${error.message}\n`);
  }

  console.log('üéâ Magic link verification tests completed!');
  console.log('\nüìù Note: These tests use invalid tokens. In a real scenario,');
  console.log('   valid tokens would be generated by the magic link system.');
}

// Run the tests
testMagicLinkVerification().catch(console.error);

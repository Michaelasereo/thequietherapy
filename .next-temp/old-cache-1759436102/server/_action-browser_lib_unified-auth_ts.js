"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
exports.id = "_action-browser_lib_unified-auth_ts";
exports.ids = ["_action-browser_lib_unified-auth_ts"];
exports.modules = {

/***/ "(action-browser)/./lib/session-manager.ts":
/*!********************************!*\
  !*** ./lib/session-manager.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SessionManager: () => (/* binding */ SessionManager),\n/* harmony export */   requireAuth: () => (/* binding */ requireAuth)\n/* harmony export */ });\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jose */ \"(action-browser)/./node_modules/jose/dist/webapi/jwt/sign.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! jose */ \"(action-browser)/./node_modules/jose/dist/webapi/jwt/verify.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(action-browser)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/server */ \"(action-browser)/./node_modules/next/dist/api/server.js\");\n\n\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || 'trpi-super-secret-key-2024-therapy-platform');\nclass SessionManager {\n    static{\n        this.COOKIE_NAME = 'quiet_session';\n    }\n    static{\n        this.MAX_AGE = 24 * 60 * 60 * 1000 // 24 hours (healthcare-grade security)\n        ;\n    }\n    static{\n        this.REFRESH_WINDOW = 6 * 60 * 60 * 1000 // Refresh if < 6 hours left\n        ;\n    }\n    static{\n        this.GRACE_PERIOD = 30 * 60 * 1000 // 30 minutes grace after expiry\n        ;\n    }\n    static{\n        this.ABSOLUTE_MAX_AGE = 30 * 24 * 60 * 60 * 1000 // 30 days absolute maximum\n        ;\n    }\n    /**\n   * Create a new session and set the cookie\n   */ static async createSession(sessionData) {\n        const token = await new jose__WEBPACK_IMPORTED_MODULE_2__.SignJWT(sessionData).setProtectedHeader({\n            alg: 'HS256'\n        }).setIssuedAt().setExpirationTime('24h') // Healthcare-grade: 24 hours\n        .sign(JWT_SECRET);\n        // Set the cookie\n        const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n        cookieStore.set(this.COOKIE_NAME, token, {\n            httpOnly: true,\n            secure: \"development\" === 'production',\n            sameSite: 'lax',\n            maxAge: this.MAX_AGE,\n            path: '/'\n        });\n        return token;\n    }\n    /**\n   * Get the current session from the cookie\n   */ static async getSession() {\n        try {\n            const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n            const token = cookieStore.get(this.COOKIE_NAME)?.value;\n            if (!token) {\n                console.log('üîç No session cookie found');\n                return null;\n            }\n            console.log('üç™ Raw cookie value:', token.substring(0, 50) + '...');\n            const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtVerify)(token, JWT_SECRET);\n            const sessionData = payload;\n            // Basic validation\n            if (!sessionData.id || !sessionData.email) {\n                console.error('‚ùå Invalid session data structure');\n                return null;\n            }\n            console.log('‚úÖ Session validated for user:', sessionData.email);\n            return sessionData;\n        } catch (error) {\n            // Distinguish between expired and invalid tokens\n            if (error?.code === 'ERR_JWT_EXPIRED' || error?.message?.includes('exp')) {\n                console.log('‚è∞ Session token expired');\n            } else {\n                console.error('‚ùå Session retrieval error:', error);\n            }\n            return null;\n        }\n    }\n    /**\n   * Get session with automatic refresh if nearing expiration\n   */ static async getSessionWithRefresh() {\n        try {\n            const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n            const token = cookieStore.get(this.COOKIE_NAME)?.value;\n            if (!token) {\n                console.log('üîç No session cookie found');\n                return null;\n            }\n            try {\n                const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtVerify)(token, JWT_SECRET);\n                const sessionData = payload;\n                // Check if token is nearing expiration (less than 6 hours remaining)\n                const expiryTime = (payload.exp || 0) * 1000;\n                const timeUntilExpiry = expiryTime - Date.now();\n                if (timeUntilExpiry < this.REFRESH_WINDOW && timeUntilExpiry > 0) {\n                    console.log('üîÑ Session nearing expiration, refreshing...');\n                    // Refresh the session\n                    await this.createSession(sessionData);\n                    console.log('‚úÖ Session refreshed successfully');\n                }\n                return sessionData;\n            } catch (error) {\n                // If token is expired but within grace period (30 minutes), allow refresh\n                if (error?.code === 'ERR_JWT_EXPIRED' || error?.message?.includes('exp')) {\n                    console.log('‚è∞ Token expired, checking if within grace period...');\n                    try {\n                        // Decode without verification to check expiry time\n                        const decoded = JSON.parse(Buffer.from(token.split('.')[1], 'base64').toString());\n                        const expiryTime = decoded.exp * 1000;\n                        const timeSinceExpiry = Date.now() - expiryTime;\n                        // Allow refresh if expired less than 30 minutes ago (grace period)\n                        if (timeSinceExpiry < this.GRACE_PERIOD && timeSinceExpiry > 0) {\n                            console.log('‚úÖ Within 30-minute grace period, refreshing session...');\n                            const sessionData = decoded;\n                            await this.createSession(sessionData);\n                            return sessionData;\n                        } else {\n                            console.log('‚ùå Expired beyond grace period, cannot refresh');\n                        }\n                    } catch (decodeError) {\n                        console.error('‚ùå Error decoding expired token:', decodeError);\n                    }\n                }\n                console.error('‚ùå Session retrieval error:', error);\n                return null;\n            }\n        } catch (error) {\n            console.error('‚ùå Session refresh error:', error);\n            return null;\n        }\n    }\n    /**\n   * Get session from request (for API routes)\n   */ static async getSessionFromRequest(request) {\n        try {\n            const sessionCookie = request.cookies.get(this.COOKIE_NAME)?.value;\n            if (!sessionCookie) {\n                console.log('üîç No session cookie found');\n                return null;\n            }\n            console.log('üç™ Raw cookie value:', sessionCookie.substring(0, 50) + '...');\n            // Verify JWT token\n            const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtVerify)(sessionCookie, JWT_SECRET);\n            const sessionData = payload;\n            // Basic validation\n            if (!sessionData.id || !sessionData.email) {\n                console.error('‚ùå Invalid session data structure');\n                return null;\n            }\n            console.log('‚úÖ Session found for user:', sessionData.email);\n            return sessionData;\n        } catch (error) {\n            console.error('‚ùå Session retrieval error:', error);\n            return null;\n        }\n    }\n    /**\n   * Clear the session cookie\n   */ static async clearSession() {\n        const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n        cookieStore.delete(this.COOKIE_NAME);\n    }\n    /**\n   * Clear expired session cookie from request\n   */ static async clearExpiredSession(request) {\n        const token = request.cookies.get(this.COOKIE_NAME)?.value;\n        if (token) {\n            try {\n                await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtVerify)(token, JWT_SECRET);\n            } catch (error) {\n                // Token is expired or invalid, clear it\n                if (error instanceof Error && error.message.includes('exp')) {\n                    const response = next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.next();\n                    response.cookies.delete(this.COOKIE_NAME);\n                    return;\n                }\n            }\n        }\n    }\n    /**\n   * Update session data (useful for profile updates)\n   */ static async updateSession(updates) {\n        const currentSession = await this.getSession();\n        if (!currentSession) {\n            return null;\n        }\n        const updatedSession = {\n            ...currentSession,\n            ...updates\n        };\n        await this.createSession(updatedSession);\n        return updatedSession;\n    }\n    /**\n   * Check if user has specific role\n   */ static async hasRole(role) {\n        const session = await this.getSession();\n        return session?.role === role;\n    }\n    /**\n   * Require specific role (throws if not authorized)\n   */ static async requireRole(role) {\n        const session = await this.getSession();\n        if (!session || session.role !== role) {\n            throw new Error(`Access denied. Required role: ${role}`);\n        }\n        return session;\n    }\n}\n/**\n * Middleware helper for API routes\n */ async function requireAuth(requiredRole) {\n    return async (request)=>{\n        const session = await SessionManager.getSessionFromRequest(request);\n        if (!session) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                error: 'Authentication required'\n            }, {\n                status: 401\n            });\n        }\n        if (requiredRole && session.role !== requiredRole) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                error: `Access denied. Required role: ${requiredRole}`\n            }, {\n                status: 403\n            });\n        }\n        return {\n            session\n        };\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL2xpYi9zZXNzaW9uLW1hbmFnZXIudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBQXlDO0FBQ0g7QUFDaUI7QUFFdkQsTUFBTUksYUFBYSxJQUFJQyxjQUFjQyxNQUFNLENBQUNDLFFBQVFDLEdBQUcsQ0FBQ0osVUFBVSxJQUFJO0FBYS9ELE1BQU1LOzthQUNhQyxjQUFjOzs7YUFDZEMsVUFBVSxLQUFLLEtBQUssS0FBSyxLQUFLLHVDQUF1Qzs7OzthQUNyRUMsaUJBQWlCLElBQUksS0FBSyxLQUFLLEtBQUssNEJBQTRCOzs7O2FBQ2hFQyxlQUFlLEtBQUssS0FBSyxLQUFLLGdDQUFnQzs7OzthQUM5REMsbUJBQW1CLEtBQUssS0FBSyxLQUFLLEtBQUssS0FBSywyQkFBMkI7OztJQUUvRjs7R0FFQyxHQUNELGFBQWFDLGNBQWNDLFdBQXdCLEVBQW1CO1FBQ3BFLE1BQU1DLFFBQVEsTUFBTSxJQUFJakIseUNBQU9BLENBQUNnQixhQUM3QkUsa0JBQWtCLENBQUM7WUFBRUMsS0FBSztRQUFRLEdBQ2xDQyxXQUFXLEdBQ1hDLGlCQUFpQixDQUFDLE9BQU8sNkJBQTZCO1NBQ3REQyxJQUFJLENBQUNsQjtRQUVSLGlCQUFpQjtRQUNqQixNQUFNbUIsY0FBYyxNQUFNckIscURBQU9BO1FBQ2pDcUIsWUFBWUMsR0FBRyxDQUFDLElBQUksQ0FBQ2QsV0FBVyxFQUFFTyxPQUFPO1lBQ3ZDUSxVQUFVO1lBQ1ZDLFFBQVFuQixrQkFBeUI7WUFDakNvQixVQUFVO1lBQ1ZDLFFBQVEsSUFBSSxDQUFDakIsT0FBTztZQUNwQmtCLE1BQU07UUFDUjtRQUVBLE9BQU9aO0lBQ1Q7SUFFQTs7R0FFQyxHQUNELGFBQWFhLGFBQTBDO1FBQ3JELElBQUk7WUFDRixNQUFNUCxjQUFjLE1BQU1yQixxREFBT0E7WUFDakMsTUFBTWUsUUFBUU0sWUFBWVEsR0FBRyxDQUFDLElBQUksQ0FBQ3JCLFdBQVcsR0FBR3NCO1lBRWpELElBQUksQ0FBQ2YsT0FBTztnQkFD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QUVBLElBQUlGLGdCQUFnQkgsUUFBUUQsSUFBSSxLQUFLSSxjQUFjO1lBQ2pELE9BQU96RSxxREFBWUEsQ0FBQzBFLElBQUksQ0FBQztnQkFBRXRDLE9BQU8sQ0FBQyw4QkFBOEIsRUFBRXFDLGNBQWM7WUFBQyxHQUFHO2dCQUFFRSxRQUFRO1lBQUk7UUFDckc7UUFFQSxPQUFPO1lBQUVMO1FBQVE7SUFDbkI7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL21hY2Jvb2svRGVza3RvcC90cnBpLWFwcC9saWIvc2Vzc2lvbi1tYW5hZ2VyLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IFNpZ25KV1QsIGp3dFZlcmlmeSB9IGZyb20gJ2pvc2UnXG5pbXBvcnQgeyBjb29raWVzIH0gZnJvbSAnbmV4dC9oZWFkZXJzJ1xuaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJ1xuXG5jb25zdCBKV1RfU0VDUkVUID0gbmV3IFRleHRFbmNvZGVyKCkuZW5jb2RlKHByb2Nlc3MuZW52LkpXVF9TRUNSRVQgfHwgJ3RycGktc3VwZXItc2VjcmV0LWtleS0yMDI0LXRoZXJhcHktcGxhdGZvcm0nKVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlc3Npb25EYXRhIHtcbiAgaWQ6IHN0cmluZ1xuICBlbWFpbDogc3RyaW5nXG4gIG5hbWU6IHN0cmluZ1xuICByb2xlOiAnaW5kaXZpZHVhbCcgfCAndGhlcmFwaXN0JyB8ICdwYXJ0bmVyJyB8ICdhZG1pbidcbiAgdXNlcl90eXBlOiBzdHJpbmdcbiAgaXNfdmVyaWZpZWQ6IGJvb2xlYW5cbiAgaXNfYWN0aXZlOiBib29sZWFuXG4gIHNlc3Npb25fdG9rZW4/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGNsYXNzIFNlc3Npb25NYW5hZ2VyIHtcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQ09PS0lFX05BTUUgPSAncXVpZXRfc2Vzc2lvbidcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgTUFYX0FHRSA9IDI0ICogNjAgKiA2MCAqIDEwMDAgLy8gMjQgaG91cnMgKGhlYWx0aGNhcmUtZ3JhZGUgc2VjdXJpdHkpXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFJFRlJFU0hfV0lORE9XID0gNiAqIDYwICogNjAgKiAxMDAwIC8vIFJlZnJlc2ggaWYgPCA2IGhvdXJzIGxlZnRcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgR1JBQ0VfUEVSSU9EID0gMzAgKiA2MCAqIDEwMDAgLy8gMzAgbWludXRlcyBncmFjZSBhZnRlciBleHBpcnlcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQUJTT0xVVEVfTUFYX0FHRSA9IDMwICogMjQgKiA2MCAqIDYwICogMTAwMCAvLyAzMCBkYXlzIGFic29sdXRlIG1heGltdW1cblxuICAvKipcbiAgICogQ3JlYXRlIGEgbmV3IHNlc3Npb24gYW5kIHNldCB0aGUgY29va2llXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgY3JlYXRlU2Vzc2lvbihzZXNzaW9uRGF0YTogU2Vzc2lvbkRhdGEpOiBQcm9taXNlPHN0cmluZz4ge1xuICAgIGNvbnN0IHRva2VuID0gYXdhaXQgbmV3IFNpZ25KV1Qoc2Vzc2lvbkRhdGEgYXMgYW55KVxuICAgICAgLnNldFByb3RlY3RlZEhlYWRlcih7IGFsZzogJ0hTMjU2JyB9KVxuICAgICAgLnNldElzc3VlZEF0KClcbiAgICAgIC5zZXRFeHBpcmF0aW9uVGltZSgnMjRoJykgLy8gSGVhbHRoY2FyZS1ncmFkZTogMjQgaG91cnNcbiAgICAgIC5zaWduKEpXVF9TRUNSRVQpXG5cbiAgICAvLyBTZXQgdGhlIGNvb2tpZVxuICAgIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpXG4gICAgY29va2llU3RvcmUuc2V0KHRoaXMuQ09PS0lFX05BTUUsIHRva2VuLCB7XG4gICAgICBodHRwT25seTogdHJ1ZSxcbiAgICAgIHNlY3VyZTogcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdwcm9kdWN0aW9uJyxcbiAgICAgIHNhbWVTaXRlOiAnbGF4JyxcbiAgICAgIG1heEFnZTogdGhpcy5NQVhfQUdFLCAvLyAyNCBob3Vyc1xuICAgICAgcGF0aDogJy8nXG4gICAgfSlcblxuICAgIHJldHVybiB0b2tlblxuICB9XG5cbiAgLyoqXG4gICAqIEdldCB0aGUgY3VycmVudCBzZXNzaW9uIGZyb20gdGhlIGNvb2tpZVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldFNlc3Npb24oKTogUHJvbWlzZTxTZXNzaW9uRGF0YSB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKClcbiAgICAgIGNvbnN0IHRva2VuID0gY29va2llU3RvcmUuZ2V0KHRoaXMuQ09PS0lFX05BTUUpPy52YWx1ZVxuXG4gICAgICBpZiAoIXRva2VuKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIE5vIHNlc3Npb24gY29va2llIGZvdW5kJylcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ/CfjaogUmF3IGNvb2tpZSB2YWx1ZTonLCB0b2tlbi5zdWJzdHJpbmcoMCwgNTApICsgJy4uLicpXG5cbiAgICAgIGNvbnN0IHsgcGF5bG9hZCB9ID0gYXdhaXQgand0VmVyaWZ5KHRva2VuLCBKV1RfU0VDUkVUKVxuICAgICAgY29uc3Qgc2Vzc2lvbkRhdGEgPSBwYXlsb2FkIGFzIGFueSBhcyBTZXNzaW9uRGF0YVxuXG4gICAgICAvLyBCYXNpYyB2YWxpZGF0aW9uXG4gICAgICBpZiAoIXNlc3Npb25EYXRhLmlkIHx8ICFzZXNzaW9uRGF0YS5lbWFpbCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgSW52YWxpZCBzZXNzaW9uIGRhdGEgc3RydWN0dXJlJylcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ+KchSBTZXNzaW9uIHZhbGlkYXRlZCBmb3IgdXNlcjonLCBzZXNzaW9uRGF0YS5lbWFpbClcbiAgICAgIHJldHVybiBzZXNzaW9uRGF0YVxuICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgIC8vIERpc3Rpbmd1aXNoIGJldHdlZW4gZXhwaXJlZCBhbmQgaW52YWxpZCB0b2tlbnNcbiAgICAgIGlmIChlcnJvcj8uY29kZSA9PT0gJ0VSUl9KV1RfRVhQSVJFRCcgfHwgZXJyb3I/Lm1lc3NhZ2U/LmluY2x1ZGVzKCdleHAnKSkge1xuICAgICAgICBjb25zb2xlLmxvZygn4o+wIFNlc3Npb24gdG9rZW4gZXhwaXJlZCcpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgU2Vzc2lvbiByZXRyaWV2YWwgZXJyb3I6JywgZXJyb3IpXG4gICAgICB9XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc2Vzc2lvbiB3aXRoIGF1dG9tYXRpYyByZWZyZXNoIGlmIG5lYXJpbmcgZXhwaXJhdGlvblxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldFNlc3Npb25XaXRoUmVmcmVzaCgpOiBQcm9taXNlPFNlc3Npb25EYXRhIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKVxuICAgICAgY29uc3QgdG9rZW4gPSBjb29raWVTdG9yZS5nZXQodGhpcy5DT09LSUVfTkFNRSk/LnZhbHVlXG5cbiAgICAgIGlmICghdG9rZW4pIHtcbiAgICAgICAgY29uc29sZS5sb2coJ/CflI0gTm8gc2Vzc2lvbiBjb29raWUgZm91bmQnKVxuICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgfVxuXG4gICAgICB0cnkge1xuICAgICAgICBjb25zdCB7IHBheWxvYWQgfSA9IGF3YWl0IGp3dFZlcmlmeSh0b2tlbiwgSldUX1NFQ1JFVClcbiAgICAgICAgY29uc3Qgc2Vzc2lvbkRhdGEgPSBwYXlsb2FkIGFzIGFueSBhcyBTZXNzaW9uRGF0YVxuXG4gICAgICAgIC8vIENoZWNrIGlmIHRva2VuIGlzIG5lYXJpbmcgZXhwaXJhdGlvbiAobGVzcyB0aGFuIDYgaG91cnMgcmVtYWluaW5nKVxuICAgICAgICBjb25zdCBleHBpcnlUaW1lID0gKHBheWxvYWQuZXhwIHx8IDApICogMTAwMFxuICAgICAgICBjb25zdCB0aW1lVW50aWxFeHBpcnkgPSBleHBpcnlUaW1lIC0gRGF0ZS5ub3coKVxuXG4gICAgICAgIGlmICh0aW1lVW50aWxFeHBpcnkgPCB0aGlzLlJFRlJFU0hfV0lORE9XICYmIHRpbWVVbnRpbEV4cGlyeSA+IDApIHtcbiAgICAgICAgICBjb25zb2xlLmxvZygn8J+UhCBTZXNzaW9uIG5lYXJpbmcgZXhwaXJhdGlvbiwgcmVmcmVzaGluZy4uLicpXG4gICAgICAgICAgLy8gUmVmcmVzaCB0aGUgc2Vzc2lvblxuICAgICAgICAgIGF3YWl0IHRoaXMuY3JlYXRlU2Vzc2lvbihzZXNzaW9uRGF0YSlcbiAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIFNlc3Npb24gcmVmcmVzaGVkIHN1Y2Nlc3NmdWxseScpXG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gc2Vzc2lvbkRhdGFcbiAgICAgIH0gY2F0Y2ggKGVycm9yOiBhbnkpIHtcbiAgICAgICAgLy8gSWYgdG9rZW4gaXMgZXhwaXJlZCBidXQgd2l0aGluIGdyYWNlIHBlcmlvZCAoMzAgbWludXRlcyksIGFsbG93IHJlZnJlc2hcbiAgICAgICAgaWYgKGVycm9yPy5jb2RlID09PSAnRVJSX0pXVF9FWFBJUkVEJyB8fCBlcnJvcj8ubWVzc2FnZT8uaW5jbHVkZXMoJ2V4cCcpKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ+KPsCBUb2tlbiBleHBpcmVkLCBjaGVja2luZyBpZiB3aXRoaW4gZ3JhY2UgcGVyaW9kLi4uJylcbiAgICAgICAgICBcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgLy8gRGVjb2RlIHdpdGhvdXQgdmVyaWZpY2F0aW9uIHRvIGNoZWNrIGV4cGlyeSB0aW1lXG4gICAgICAgICAgICBjb25zdCBkZWNvZGVkID0gSlNPTi5wYXJzZShCdWZmZXIuZnJvbSh0b2tlbi5zcGxpdCgnLicpWzFdLCAnYmFzZTY0JykudG9TdHJpbmcoKSlcbiAgICAgICAgICAgIGNvbnN0IGV4cGlyeVRpbWUgPSBkZWNvZGVkLmV4cCAqIDEwMDBcbiAgICAgICAgICAgIGNvbnN0IHRpbWVTaW5jZUV4cGlyeSA9IERhdGUubm93KCkgLSBleHBpcnlUaW1lXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIEFsbG93IHJlZnJlc2ggaWYgZXhwaXJlZCBsZXNzIHRoYW4gMzAgbWludXRlcyBhZ28gKGdyYWNlIHBlcmlvZClcbiAgICAgICAgICAgIGlmICh0aW1lU2luY2VFeHBpcnkgPCB0aGlzLkdSQUNFX1BFUklPRCAmJiB0aW1lU2luY2VFeHBpcnkgPiAwKSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfinIUgV2l0aGluIDMwLW1pbnV0ZSBncmFjZSBwZXJpb2QsIHJlZnJlc2hpbmcgc2Vzc2lvbi4uLicpXG4gICAgICAgICAgICAgIGNvbnN0IHNlc3Npb25EYXRhID0gZGVjb2RlZCBhcyBTZXNzaW9uRGF0YVxuICAgICAgICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZVNlc3Npb24oc2Vzc2lvbkRhdGEpXG4gICAgICAgICAgICAgIHJldHVybiBzZXNzaW9uRGF0YVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coJ+KdjCBFeHBpcmVkIGJleW9uZCBncmFjZSBwZXJpb2QsIGNhbm5vdCByZWZyZXNoJylcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGNhdGNoIChkZWNvZGVFcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGRlY29kaW5nIGV4cGlyZWQgdG9rZW46JywgZGVjb2RlRXJyb3IpXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgU2Vzc2lvbiByZXRyaWV2YWwgZXJyb3I6JywgZXJyb3IpXG4gICAgICAgIHJldHVybiBudWxsXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBTZXNzaW9uIHJlZnJlc2ggZXJyb3I6JywgZXJyb3IpXG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgc2Vzc2lvbiBmcm9tIHJlcXVlc3QgKGZvciBBUEkgcm91dGVzKVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldFNlc3Npb25Gcm9tUmVxdWVzdChyZXF1ZXN0OiBOZXh0UmVxdWVzdCk6IFByb21pc2U8U2Vzc2lvbkRhdGEgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHNlc3Npb25Db29raWUgPSByZXF1ZXN0LmNvb2tpZXMuZ2V0KHRoaXMuQ09PS0lFX05BTUUpPy52YWx1ZVxuXG4gICAgICBpZiAoIXNlc3Npb25Db29raWUpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ/CflI0gTm8gc2Vzc2lvbiBjb29raWUgZm91bmQnKVxuICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgfVxuXG4gICAgICBjb25zb2xlLmxvZygn8J+NqiBSYXcgY29va2llIHZhbHVlOicsIHNlc3Npb25Db29raWUuc3Vic3RyaW5nKDAsIDUwKSArICcuLi4nKVxuXG4gICAgICAvLyBWZXJpZnkgSldUIHRva2VuXG4gICAgICBjb25zdCB7IHBheWxvYWQgfSA9IGF3YWl0IGp3dFZlcmlmeShzZXNzaW9uQ29va2llLCBKV1RfU0VDUkVUKVxuICAgICAgY29uc3Qgc2Vzc2lvbkRhdGEgPSBwYXlsb2FkIGFzIGFueSBhcyBTZXNzaW9uRGF0YVxuXG4gICAgICAvLyBCYXNpYyB2YWxpZGF0aW9uXG4gICAgICBpZiAoIXNlc3Npb25EYXRhLmlkIHx8ICFzZXNzaW9uRGF0YS5lbWFpbCkge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgSW52YWxpZCBzZXNzaW9uIGRhdGEgc3RydWN0dXJlJylcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ+KchSBTZXNzaW9uIGZvdW5kIGZvciB1c2VyOicsIHNlc3Npb25EYXRhLmVtYWlsKVxuICAgICAgcmV0dXJuIHNlc3Npb25EYXRhXG5cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIFNlc3Npb24gcmV0cmlldmFsIGVycm9yOicsIGVycm9yKVxuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgdGhlIHNlc3Npb24gY29va2llXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgY2xlYXJTZXNzaW9uKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpXG4gICAgY29va2llU3RvcmUuZGVsZXRlKHRoaXMuQ09PS0lFX05BTUUpXG4gIH1cblxuICAvKipcbiAgICogQ2xlYXIgZXhwaXJlZCBzZXNzaW9uIGNvb2tpZSBmcm9tIHJlcXVlc3RcbiAgICovXG4gIHN0YXRpYyBhc3luYyBjbGVhckV4cGlyZWRTZXNzaW9uKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgdG9rZW4gPSByZXF1ZXN0LmNvb2tpZXMuZ2V0KHRoaXMuQ09PS0lFX05BTUUpPy52YWx1ZVxuICAgIGlmICh0b2tlbikge1xuICAgICAgdHJ5IHtcbiAgICAgICAgYXdhaXQgand0VmVyaWZ5KHRva2VuLCBKV1RfU0VDUkVUKVxuICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgLy8gVG9rZW4gaXMgZXhwaXJlZCBvciBpbnZhbGlkLCBjbGVhciBpdFxuICAgICAgICBpZiAoZXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJiBlcnJvci5tZXNzYWdlLmluY2x1ZGVzKCdleHAnKSkge1xuICAgICAgICAgIGNvbnN0IHJlc3BvbnNlID0gTmV4dFJlc3BvbnNlLm5leHQoKVxuICAgICAgICAgIHJlc3BvbnNlLmNvb2tpZXMuZGVsZXRlKHRoaXMuQ09PS0lFX05BTUUpXG4gICAgICAgICAgcmV0dXJuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogVXBkYXRlIHNlc3Npb24gZGF0YSAodXNlZnVsIGZvciBwcm9maWxlIHVwZGF0ZXMpXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgdXBkYXRlU2Vzc2lvbih1cGRhdGVzOiBQYXJ0aWFsPFNlc3Npb25EYXRhPik6IFByb21pc2U8U2Vzc2lvbkRhdGEgfCBudWxsPiB7XG4gICAgY29uc3QgY3VycmVudFNlc3Npb24gPSBhd2FpdCB0aGlzLmdldFNlc3Npb24oKVxuICAgIGlmICghY3VycmVudFNlc3Npb24pIHtcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuXG4gICAgY29uc3QgdXBkYXRlZFNlc3Npb24gPSB7IC4uLmN1cnJlbnRTZXNzaW9uLCAuLi51cGRhdGVzIH1cbiAgICBhd2FpdCB0aGlzLmNyZWF0ZVNlc3Npb24odXBkYXRlZFNlc3Npb24pXG4gICAgcmV0dXJuIHVwZGF0ZWRTZXNzaW9uXG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgaWYgdXNlciBoYXMgc3BlY2lmaWMgcm9sZVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGhhc1JvbGUocm9sZTogU2Vzc2lvbkRhdGFbJ3JvbGUnXSk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCB0aGlzLmdldFNlc3Npb24oKVxuICAgIHJldHVybiBzZXNzaW9uPy5yb2xlID09PSByb2xlXG4gIH1cblxuICAvKipcbiAgICogUmVxdWlyZSBzcGVjaWZpYyByb2xlICh0aHJvd3MgaWYgbm90IGF1dGhvcml6ZWQpXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgcmVxdWlyZVJvbGUocm9sZTogU2Vzc2lvbkRhdGFbJ3JvbGUnXSk6IFByb21pc2U8U2Vzc2lvbkRhdGE+IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgdGhpcy5nZXRTZXNzaW9uKClcbiAgICBpZiAoIXNlc3Npb24gfHwgc2Vzc2lvbi5yb2xlICE9PSByb2xlKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEFjY2VzcyBkZW5pZWQuIFJlcXVpcmVkIHJvbGU6ICR7cm9sZX1gKVxuICAgIH1cbiAgICByZXR1cm4gc2Vzc2lvblxuICB9XG59XG5cbi8qKlxuICogTWlkZGxld2FyZSBoZWxwZXIgZm9yIEFQSSByb3V0ZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHJlcXVpcmVBdXRoKHJlcXVpcmVkUm9sZT86IFNlc3Npb25EYXRhWydyb2xlJ10pIHtcbiAgcmV0dXJuIGFzeW5jIChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkgPT4ge1xuICAgIGNvbnN0IHNlc3Npb24gPSBhd2FpdCBTZXNzaW9uTWFuYWdlci5nZXRTZXNzaW9uRnJvbVJlcXVlc3QocmVxdWVzdClcbiAgICBcbiAgICBpZiAoIXNlc3Npb24pIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnQXV0aGVudGljYXRpb24gcmVxdWlyZWQnIH0sIHsgc3RhdHVzOiA0MDEgfSlcbiAgICB9XG5cbiAgICBpZiAocmVxdWlyZWRSb2xlICYmIHNlc3Npb24ucm9sZSAhPT0gcmVxdWlyZWRSb2xlKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogYEFjY2VzcyBkZW5pZWQuIFJlcXVpcmVkIHJvbGU6ICR7cmVxdWlyZWRSb2xlfWAgfSwgeyBzdGF0dXM6IDQwMyB9KVxuICAgIH1cblxuICAgIHJldHVybiB7IHNlc3Npb24gfVxuICB9XG59XG4iXSwibmFtZXMiOlsiU2lnbkpXVCIsImp3dFZlcmlmeSIsImNvb2tpZXMiLCJOZXh0UmVzcG9uc2UiLCJKV1RfU0VDUkVUIiwiVGV4dEVuY29kZXIiLCJlbmNvZGUiLCJwcm9jZXNzIiwiZW52IiwiU2Vzc2lvbk1hbmFnZXIiLCJDT09LSUVfTkFNRSIsIk1BWF9BR0UiLCJSRUZSRVNIX1dJTkRPVyIsIkdSQUNFX1BFUklPRCIsIkFCU09MVVRFX01BWF9BR0UiLCJjcmVhdGVTZXNzaW9uIiwic2Vzc2lvbkRhdGEiLCJ0b2tlbiIsInNldFByb3RlY3RlZEhlYWRlciIsImFsZyIsInNldElzc3VlZEF0Iiwic2V0RXhwaXJhdGlvblRpbWUiLCJzaWduIiwiY29va2llU3RvcmUiLCJzZXQiLCJodHRwT25seSIsInNlY3VyZSIsInNhbWVTaXRlIiwibWF4QWdlIiwicGF0aCIsImdldFNlc3Npb24iLCJnZXQiLCJ2YWx1ZSIsImNvbnNvbGUiLCJsb2ciLCJzdWJzdHJpbmciLCJwYXlsb2FkIiwiaWQiLCJlbWFpbCIsImVycm9yIiwiY29kZSIsIm1lc3NhZ2UiLCJpbmNsdWRlcyIsImdldFNlc3Npb25XaXRoUmVmcmVzaCIsImV4cGlyeVRpbWUiLCJleHAiLCJ0aW1lVW50aWxFeHBpcnkiLCJEYXRlIiwibm93IiwiZGVjb2RlZCIsIkpTT04iLCJwYXJzZSIsIkJ1ZmZlciIsImZyb20iLCJzcGxpdCIsInRvU3RyaW5nIiwidGltZVNpbmNlRXhwaXJ5IiwiZGVjb2RlRXJyb3IiLCJnZXRTZXNzaW9uRnJvbVJlcXVlc3QiLCJyZXF1ZXN0Iiwic2Vzc2lvbkNvb2tpZSIsImNsZWFyU2Vzc2lvbiIsImRlbGV0ZSIsImNsZWFyRXhwaXJlZFNlc3Npb24iLCJFcnJvciIsInJlc3BvbnNlIiwibmV4dCIsInVwZGF0ZVNlc3Npb24iLCJ1cGRhdGVzIiwiY3VycmVudFNlc3Npb24iLCJ1cGRhdGVkU2Vzc2lvbiIsImhhc1JvbGUiLCJyb2xlIiwic2Vzc2lvbiIsInJlcXVpcmVSb2xlIiwicmVxdWlyZUF1dGgiLCJyZXF1aXJlZFJvbGUiLCJqc29uIiwic3RhdHVzIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(action-browser)/./lib/session-manager.ts\n");

/***/ }),

/***/ "(action-browser)/./lib/unified-auth.ts":
/*!*****************************!*\
  !*** ./lib/unified-auth.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   UnifiedAuth: () => (/* binding */ UnifiedAuth)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(action-browser)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _session_manager__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./session-manager */ \"(action-browser)/./lib/session-manager.ts\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @supabase/supabase-js */ \"(action-browser)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _audit_logger__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./audit-logger */ \"(action-browser)/./lib/audit-logger.ts\");\n\n\n\n\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_3__.createClient)(\"https://frzciymslvpohhyefmtr.supabase.co\" || 0, process.env.SUPABASE_SERVICE_ROLE_KEY || '');\n/**\n * Unified Authentication System\n * Single source of truth for all authentication operations\n */ class UnifiedAuth {\n    static{\n        this.SESSION_COOKIE = 'quiet_session';\n    }\n    /**\n   * Validate current session with automatic refresh\n   * Returns user and session data if valid, null otherwise\n   */ static async validateSession() {\n        try {\n            console.log('üîç UnifiedAuth: Validating session...');\n            // Try to get session with automatic refresh\n            const session = await _session_manager__WEBPACK_IMPORTED_MODULE_1__.SessionManager.getSessionWithRefresh();\n            if (!session) {\n                console.log('‚ùå UnifiedAuth: No valid session found');\n                // Clear any inconsistent client-side cookies\n                await this.clearLegacyCookies();\n                return null;\n            }\n            console.log('‚úÖ UnifiedAuth: Session validated for user:', session.email);\n            return {\n                user: {\n                    id: session.id,\n                    email: session.email,\n                    name: session.name,\n                    role: session.role,\n                    user_type: session.user_type,\n                    is_verified: session.is_verified,\n                    is_active: session.is_active\n                },\n                session: {\n                    id: session.id,\n                    token: session.session_token || '',\n                    expires_at: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7 days\n                }\n            };\n        } catch (error) {\n            console.error('‚ùå UnifiedAuth: Session validation error:', error);\n            await this.logout() // Clean up on any error\n            ;\n            return null;\n        }\n    }\n    /**\n   * Comprehensive logout - clears everything\n   */ static async logout() {\n        try {\n            console.log('üîê UnifiedAuth: Starting comprehensive logout...');\n            // Get current session before clearing\n            const session = await _session_manager__WEBPACK_IMPORTED_MODULE_1__.SessionManager.getSession();\n            // Audit log: Logout event\n            if (session) {\n                await _audit_logger__WEBPACK_IMPORTED_MODULE_2__.AuditLogger.logLogout(session.id, {\n                    email: session.email,\n                    role: session.role\n                });\n            }\n            // Invalidate server-side session in database\n            if (session?.session_token) {\n                await this.invalidateDatabaseSession(session.session_token);\n            }\n            // Clear the main session cookie\n            await _session_manager__WEBPACK_IMPORTED_MODULE_1__.SessionManager.clearSession();\n            // Clear any legacy cookies\n            await this.clearLegacyCookies();\n            console.log('‚úÖ UnifiedAuth: Logout completed');\n        } catch (error) {\n            console.error('‚ùå UnifiedAuth: Logout error:', error);\n            // Still try to clear cookies even if DB operation fails\n            await _session_manager__WEBPACK_IMPORTED_MODULE_1__.SessionManager.clearSession();\n            await this.clearLegacyCookies();\n        }\n    }\n    /**\n   * Invalidate session in database\n   */ static async invalidateDatabaseSession(sessionToken) {\n        try {\n            console.log('üóëÔ∏è  UnifiedAuth: Invalidating database session...');\n            // Mark session as invalidated in database\n            const { error } = await supabase.from('user_sessions').update({\n                invalidated_at: new Date().toISOString(),\n                updated_at: new Date().toISOString()\n            }).eq('session_token', sessionToken);\n            if (error) {\n                console.error('‚ùå UnifiedAuth: Error invalidating session:', error);\n            } else {\n                console.log('‚úÖ UnifiedAuth: Database session invalidated');\n            }\n        } catch (error) {\n            console.error('‚ùå UnifiedAuth: Database session invalidation failed:', error);\n        }\n    }\n    /**\n   * Clear legacy/inconsistent cookies\n   */ static async clearLegacyCookies() {\n        try {\n            const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n            // List of legacy cookies to clear\n            const legacyCookies = [\n                'quiet_user',\n                'quiet_therapist',\n                'quiet_therapist_user',\n                'quiet_individual_user',\n                'quiet_partner_user',\n                'quiet_admin_user'\n            ];\n            for (const cookieName of legacyCookies){\n                cookieStore.delete(cookieName);\n            }\n            console.log('üßπ UnifiedAuth: Legacy cookies cleared');\n        } catch (error) {\n            console.error('‚ùå UnifiedAuth: Error clearing legacy cookies:', error);\n        }\n    }\n    /**\n   * Check if user has specific role\n   */ static async hasRole(requiredRole) {\n        const validation = await this.validateSession();\n        return validation?.user.role === requiredRole;\n    }\n    /**\n   * Require specific role (throws if not authorized)\n   */ static async requireRole(requiredRole) {\n        const validation = await this.validateSession();\n        if (!validation) {\n            throw new Error('AUTH_REQUIRED: Authentication required');\n        }\n        if (validation.user.role !== requiredRole) {\n            throw new Error(`ACCESS_DENIED: Required role: ${requiredRole}, got: ${validation.user.role}`);\n        }\n        return validation;\n    }\n    /**\n   * Refresh session activity timestamp\n   */ static async updateSessionActivity(sessionToken) {\n        try {\n            await supabase.from('user_sessions').update({\n                last_accessed_at: new Date().toISOString()\n            }).eq('session_token', sessionToken);\n        } catch (error) {\n            console.error('‚ùå UnifiedAuth: Error updating session activity:', error);\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKGFjdGlvbi1icm93c2VyKS8uL2xpYi91bmlmaWVkLWF1dGgudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBc0M7QUFDWTtBQUNFO0FBQ1I7QUFFNUMsTUFBTUksV0FBV0YsbUVBQVlBLENBQzNCRywwQ0FBb0MsSUFBSSxDQUFFLEVBQzFDQSxRQUFRQyxHQUFHLENBQUNFLHlCQUF5QixJQUFJO0FBb0IzQzs7O0NBR0MsR0FDTSxNQUFNQzs7YUFDSUMsaUJBQWlCOztJQUVoQzs7O0dBR0MsR0FDRCxhQUFhQyxrQkFBd0Q7UUFDbkUsSUFBSTtZQUNGQyxRQUFRQyxHQUFHLENBQUM7WUFFWiw0Q0FBNEM7WUFDNUMsTUFBTUMsVUFBVSxNQUFNYiw0REFBY0EsQ0FBQ2MscUJBQXFCO1lBRTFELElBQUksQ0FBQ0QsU0FBUztnQkFDWkYsUUFBUUMsR0FBRyxDQUFDO2dCQUNaLDZDQUE2QztnQkFDN0MsTUFBTSxJQUFJLENBQUNHLGtCQUFrQjtnQkFDN0IsT0FBTztZQUNUO1lBRUFKLFFBQVFDLEdBQUcsQ0FBQyw4Q0FBOENDLFFBQVFHLEtBQUs7WUFFdkUsT0FBTztnQkFDTEMsTUFBTTtvQkFDSkMsSUFBSUwsUUFBUUssRUFBRTtvQkFDZEYsT0FBT0gsUUFBUUcsS0FBSztvQkFDcEJHLE1BQU1OLFFBQVFNLElBQUk7b0JBQ2xCQyxNQUFNUCxRQUFRTyxJQUFJO29CQUNsQkMsV0FBV1IsUUFBUVEsU0FBUztvQkFDNUJDLGFBQWFULFFBQVFTLFdBQVc7b0JBQ2hDQyxXQUFXVixRQUFRVSxTQUFTO2dCQUM5QjtnQkFDQVYsU0FBUztvQkFDUEssSUFBSUwsUUFBUUssRUFBRTtvQkFDZE0sT0FBT1gsUUFBUVksYUFBYSxJQUFJO29CQUNoQ0MsWUFBWSxJQUFJQyxLQUFLQSxLQUFLQyxHQUFHLEtBQUssSUFBSSxLQUFLLEtBQUssS0FBSyxNQUFNLFNBQVM7Z0JBQ3RFO1lBQ0Y7UUFDRixFQUFFLE9BQU9DLE9BQU87WUFDZGxCLFFBQVFrQixLQUFLLENBQUMsNENBQTRDQTtZQUMx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LEVBQWlCO1FBQ3RFLElBQUk7WUFDRixNQUFNaEMsU0FDSGlDLElBQUksQ0FBQyxpQkFDTEMsTUFBTSxDQUFDO2dCQUNOZSxrQkFBa0IsSUFBSXpCLE9BQU9ZLFdBQVc7WUFDMUMsR0FDQ0UsRUFBRSxDQUFDLGlCQUFpQk47UUFDekIsRUFBRSxPQUFPTixPQUFPO1lBQ2RsQixRQUFRa0IsS0FBSyxDQUFDLG1EQUFtREE7UUFDbkU7SUFDRjtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvbWFjYm9vay9EZXNrdG9wL3RycGktYXBwL2xpYi91bmlmaWVkLWF1dGgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycydcbmltcG9ydCB7IFNlc3Npb25NYW5hZ2VyIH0gZnJvbSAnLi9zZXNzaW9uLW1hbmFnZXInXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5pbXBvcnQgeyBBdWRpdExvZ2dlciB9IGZyb20gJy4vYXVkaXQtbG9nZ2VyJ1xuXG5jb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcbiAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIHx8ICcnLFxuICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIHx8ICcnXG4pXG5cbmV4cG9ydCBpbnRlcmZhY2UgQXV0aFZhbGlkYXRpb25SZXN1bHQge1xuICB1c2VyOiB7XG4gICAgaWQ6IHN0cmluZ1xuICAgIGVtYWlsOiBzdHJpbmdcbiAgICBuYW1lOiBzdHJpbmdcbiAgICByb2xlOiAnaW5kaXZpZHVhbCcgfCAndGhlcmFwaXN0JyB8ICdwYXJ0bmVyJyB8ICdhZG1pbidcbiAgICB1c2VyX3R5cGU6IHN0cmluZ1xuICAgIGlzX3ZlcmlmaWVkOiBib29sZWFuXG4gICAgaXNfYWN0aXZlOiBib29sZWFuXG4gIH1cbiAgc2Vzc2lvbjoge1xuICAgIGlkOiBzdHJpbmdcbiAgICB0b2tlbjogc3RyaW5nXG4gICAgZXhwaXJlc19hdDogRGF0ZVxuICB9XG59XG5cbi8qKlxuICogVW5pZmllZCBBdXRoZW50aWNhdGlvbiBTeXN0ZW1cbiAqIFNpbmdsZSBzb3VyY2Ugb2YgdHJ1dGggZm9yIGFsbCBhdXRoZW50aWNhdGlvbiBvcGVyYXRpb25zXG4gKi9cbmV4cG9ydCBjbGFzcyBVbmlmaWVkQXV0aCB7XG4gIHByaXZhdGUgc3RhdGljIFNFU1NJT05fQ09PS0lFID0gJ3F1aWV0X3Nlc3Npb24nXG4gIFxuICAvKipcbiAgICogVmFsaWRhdGUgY3VycmVudCBzZXNzaW9uIHdpdGggYXV0b21hdGljIHJlZnJlc2hcbiAgICogUmV0dXJucyB1c2VyIGFuZCBzZXNzaW9uIGRhdGEgaWYgdmFsaWQsIG51bGwgb3RoZXJ3aXNlXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgdmFsaWRhdGVTZXNzaW9uKCk6IFByb21pc2U8QXV0aFZhbGlkYXRpb25SZXN1bHQgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnNvbGUubG9nKCfwn5SNIFVuaWZpZWRBdXRoOiBWYWxpZGF0aW5nIHNlc3Npb24uLi4nKVxuICAgICAgXG4gICAgICAvLyBUcnkgdG8gZ2V0IHNlc3Npb24gd2l0aCBhdXRvbWF0aWMgcmVmcmVzaFxuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IFNlc3Npb25NYW5hZ2VyLmdldFNlc3Npb25XaXRoUmVmcmVzaCgpXG4gICAgICBcbiAgICAgIGlmICghc2Vzc2lvbikge1xuICAgICAgICBjb25zb2xlLmxvZygn4p2MIFVuaWZpZWRBdXRoOiBObyB2YWxpZCBzZXNzaW9uIGZvdW5kJylcbiAgICAgICAgLy8gQ2xlYXIgYW55IGluY29uc2lzdGVudCBjbGllbnQtc2lkZSBjb29raWVzXG4gICAgICAgIGF3YWl0IHRoaXMuY2xlYXJMZWdhY3lDb29raWVzKClcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ+KchSBVbmlmaWVkQXV0aDogU2Vzc2lvbiB2YWxpZGF0ZWQgZm9yIHVzZXI6Jywgc2Vzc2lvbi5lbWFpbClcbiAgICAgIFxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdXNlcjoge1xuICAgICAgICAgIGlkOiBzZXNzaW9uLmlkLFxuICAgICAgICAgIGVtYWlsOiBzZXNzaW9uLmVtYWlsLFxuICAgICAgICAgIG5hbWU6IHNlc3Npb24ubmFtZSxcbiAgICAgICAgICByb2xlOiBzZXNzaW9uLnJvbGUsXG4gICAgICAgICAgdXNlcl90eXBlOiBzZXNzaW9uLnVzZXJfdHlwZSxcbiAgICAgICAgICBpc192ZXJpZmllZDogc2Vzc2lvbi5pc192ZXJpZmllZCxcbiAgICAgICAgICBpc19hY3RpdmU6IHNlc3Npb24uaXNfYWN0aXZlXG4gICAgICAgIH0sXG4gICAgICAgIHNlc3Npb246IHtcbiAgICAgICAgICBpZDogc2Vzc2lvbi5pZCxcbiAgICAgICAgICB0b2tlbjogc2Vzc2lvbi5zZXNzaW9uX3Rva2VuIHx8ICcnLFxuICAgICAgICAgIGV4cGlyZXNfYXQ6IG5ldyBEYXRlKERhdGUubm93KCkgKyA3ICogMjQgKiA2MCAqIDYwICogMTAwMCkgLy8gNyBkYXlzXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIFVuaWZpZWRBdXRoOiBTZXNzaW9uIHZhbGlkYXRpb24gZXJyb3I6JywgZXJyb3IpXG4gICAgICBhd2FpdCB0aGlzLmxvZ291dCgpIC8vIENsZWFuIHVwIG9uIGFueSBlcnJvclxuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gIH1cbiAgXG4gIC8qKlxuICAgKiBDb21wcmVoZW5zaXZlIGxvZ291dCAtIGNsZWFycyBldmVyeXRoaW5nXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgbG9nb3V0KCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygn8J+UkCBVbmlmaWVkQXV0aDogU3RhcnRpbmcgY29tcHJlaGVuc2l2ZSBsb2dvdXQuLi4nKVxuICAgICAgXG4gICAgICAvLyBHZXQgY3VycmVudCBzZXNzaW9uIGJlZm9yZSBjbGVhcmluZ1xuICAgICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IFNlc3Npb25NYW5hZ2VyLmdldFNlc3Npb24oKVxuICAgICAgXG4gICAgICAvLyBBdWRpdCBsb2c6IExvZ291dCBldmVudFxuICAgICAgaWYgKHNlc3Npb24pIHtcbiAgICAgICAgYXdhaXQgQXVkaXRMb2dnZXIubG9nTG9nb3V0KHNlc3Npb24uaWQsIHtcbiAgICAgICAgICBlbWFpbDogc2Vzc2lvbi5lbWFpbCxcbiAgICAgICAgICByb2xlOiBzZXNzaW9uLnJvbGVcbiAgICAgICAgfSlcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gSW52YWxpZGF0ZSBzZXJ2ZXItc2lkZSBzZXNzaW9uIGluIGRhdGFiYXNlXG4gICAgICBpZiAoc2Vzc2lvbj8uc2Vzc2lvbl90b2tlbikge1xuICAgICAgICBhd2FpdCB0aGlzLmludmFsaWRhdGVEYXRhYmFzZVNlc3Npb24oc2Vzc2lvbi5zZXNzaW9uX3Rva2VuKVxuICAgICAgfVxuICAgICAgXG4gICAgICAvLyBDbGVhciB0aGUgbWFpbiBzZXNzaW9uIGNvb2tpZVxuICAgICAgYXdhaXQgU2Vzc2lvbk1hbmFnZXIuY2xlYXJTZXNzaW9uKClcbiAgICAgIFxuICAgICAgLy8gQ2xlYXIgYW55IGxlZ2FjeSBjb29raWVzXG4gICAgICBhd2FpdCB0aGlzLmNsZWFyTGVnYWN5Q29va2llcygpXG4gICAgICBcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgVW5pZmllZEF1dGg6IExvZ291dCBjb21wbGV0ZWQnKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgVW5pZmllZEF1dGg6IExvZ291dCBlcnJvcjonLCBlcnJvcilcbiAgICAgIC8vIFN0aWxsIHRyeSB0byBjbGVhciBjb29raWVzIGV2ZW4gaWYgREIgb3BlcmF0aW9uIGZhaWxzXG4gICAgICBhd2FpdCBTZXNzaW9uTWFuYWdlci5jbGVhclNlc3Npb24oKVxuICAgICAgYXdhaXQgdGhpcy5jbGVhckxlZ2FjeUNvb2tpZXMoKVxuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIEludmFsaWRhdGUgc2Vzc2lvbiBpbiBkYXRhYmFzZVxuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgaW52YWxpZGF0ZURhdGFiYXNlU2Vzc2lvbihzZXNzaW9uVG9rZW46IHN0cmluZyk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zb2xlLmxvZygn8J+Xke+4jyAgVW5pZmllZEF1dGg6IEludmFsaWRhdGluZyBkYXRhYmFzZSBzZXNzaW9uLi4uJylcbiAgICAgIFxuICAgICAgLy8gTWFyayBzZXNzaW9uIGFzIGludmFsaWRhdGVkIGluIGRhdGFiYXNlXG4gICAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgndXNlcl9zZXNzaW9ucycpXG4gICAgICAgIC51cGRhdGUoeyBcbiAgICAgICAgICBpbnZhbGlkYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIHVwZGF0ZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICB9KVxuICAgICAgICAuZXEoJ3Nlc3Npb25fdG9rZW4nLCBzZXNzaW9uVG9rZW4pXG4gICAgICBcbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgVW5pZmllZEF1dGg6IEVycm9yIGludmFsaWRhdGluZyBzZXNzaW9uOicsIGVycm9yKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ+KchSBVbmlmaWVkQXV0aDogRGF0YWJhc2Ugc2Vzc2lvbiBpbnZhbGlkYXRlZCcpXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBVbmlmaWVkQXV0aDogRGF0YWJhc2Ugc2Vzc2lvbiBpbnZhbGlkYXRpb24gZmFpbGVkOicsIGVycm9yKVxuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIENsZWFyIGxlZ2FjeS9pbmNvbnNpc3RlbnQgY29va2llc1xuICAgKi9cbiAgcHJpdmF0ZSBzdGF0aWMgYXN5bmMgY2xlYXJMZWdhY3lDb29raWVzKCk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKVxuICAgICAgXG4gICAgICAvLyBMaXN0IG9mIGxlZ2FjeSBjb29raWVzIHRvIGNsZWFyXG4gICAgICBjb25zdCBsZWdhY3lDb29raWVzID0gW1xuICAgICAgICAncXVpZXRfdXNlcicsXG4gICAgICAgICdxdWlldF90aGVyYXBpc3QnLFxuICAgICAgICAncXVpZXRfdGhlcmFwaXN0X3VzZXInLFxuICAgICAgICAncXVpZXRfaW5kaXZpZHVhbF91c2VyJyxcbiAgICAgICAgJ3F1aWV0X3BhcnRuZXJfdXNlcicsXG4gICAgICAgICdxdWlldF9hZG1pbl91c2VyJ1xuICAgICAgXVxuICAgICAgXG4gICAgICBmb3IgKGNvbnN0IGNvb2tpZU5hbWUgb2YgbGVnYWN5Q29va2llcykge1xuICAgICAgICBjb29raWVTdG9yZS5kZWxldGUoY29va2llTmFtZSlcbiAgICAgIH1cbiAgICAgIFxuICAgICAgY29uc29sZS5sb2coJ/Cfp7kgVW5pZmllZEF1dGg6IExlZ2FjeSBjb29raWVzIGNsZWFyZWQnKVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgVW5pZmllZEF1dGg6IEVycm9yIGNsZWFyaW5nIGxlZ2FjeSBjb29raWVzOicsIGVycm9yKVxuICAgIH1cbiAgfVxuICBcbiAgLyoqXG4gICAqIENoZWNrIGlmIHVzZXIgaGFzIHNwZWNpZmljIHJvbGVcbiAgICovXG4gIHN0YXRpYyBhc3luYyBoYXNSb2xlKHJlcXVpcmVkUm9sZTogJ2luZGl2aWR1YWwnIHwgJ3RoZXJhcGlzdCcgfCAncGFydG5lcicgfCAnYWRtaW4nKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgdmFsaWRhdGlvbiA9IGF3YWl0IHRoaXMudmFsaWRhdGVTZXNzaW9uKClcbiAgICByZXR1cm4gdmFsaWRhdGlvbj8udXNlci5yb2xlID09PSByZXF1aXJlZFJvbGVcbiAgfVxuICBcbiAgLyoqXG4gICAqIFJlcXVpcmUgc3BlY2lmaWMgcm9sZSAodGhyb3dzIGlmIG5vdCBhdXRob3JpemVkKVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIHJlcXVpcmVSb2xlKHJlcXVpcmVkUm9sZTogJ2luZGl2aWR1YWwnIHwgJ3RoZXJhcGlzdCcgfCAncGFydG5lcicgfCAnYWRtaW4nKTogUHJvbWlzZTxBdXRoVmFsaWRhdGlvblJlc3VsdD4ge1xuICAgIGNvbnN0IHZhbGlkYXRpb24gPSBhd2FpdCB0aGlzLnZhbGlkYXRlU2Vzc2lvbigpXG4gICAgXG4gICAgaWYgKCF2YWxpZGF0aW9uKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoJ0FVVEhfUkVRVUlSRUQ6IEF1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJylcbiAgICB9XG4gICAgXG4gICAgaWYgKHZhbGlkYXRpb24udXNlci5yb2xlICE9PSByZXF1aXJlZFJvbGUpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgQUNDRVNTX0RFTklFRDogUmVxdWlyZWQgcm9sZTogJHtyZXF1aXJlZFJvbGV9LCBnb3Q6ICR7dmFsaWRhdGlvbi51c2VyLnJvbGV9YClcbiAgICB9XG4gICAgXG4gICAgcmV0dXJuIHZhbGlkYXRpb25cbiAgfVxuICBcbiAgLyoqXG4gICAqIFJlZnJlc2ggc2Vzc2lvbiBhY3Rpdml0eSB0aW1lc3RhbXBcbiAgICovXG4gIHN0YXRpYyBhc3luYyB1cGRhdGVTZXNzaW9uQWN0aXZpdHkoc2Vzc2lvblRva2VuOiBzdHJpbmcpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICB0cnkge1xuICAgICAgYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3VzZXJfc2Vzc2lvbnMnKVxuICAgICAgICAudXBkYXRlKHsgXG4gICAgICAgICAgbGFzdF9hY2Nlc3NlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpIFxuICAgICAgICB9KVxuICAgICAgICAuZXEoJ3Nlc3Npb25fdG9rZW4nLCBzZXNzaW9uVG9rZW4pXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBVbmlmaWVkQXV0aDogRXJyb3IgdXBkYXRpbmcgc2Vzc2lvbiBhY3Rpdml0eTonLCBlcnJvcilcbiAgICB9XG4gIH1cbn1cblxuIl0sIm5hbWVzIjpbImNvb2tpZXMiLCJTZXNzaW9uTWFuYWdlciIsImNyZWF0ZUNsaWVudCIsIkF1ZGl0TG9nZ2VyIiwic3VwYWJhc2UiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsIlVuaWZpZWRBdXRoIiwiU0VTU0lPTl9DT09LSUUiLCJ2YWxpZGF0ZVNlc3Npb24iLCJjb25zb2xlIiwibG9nIiwic2Vzc2lvbiIsImdldFNlc3Npb25XaXRoUmVmcmVzaCIsImNsZWFyTGVnYWN5Q29va2llcyIsImVtYWlsIiwidXNlciIsImlkIiwibmFtZSIsInJvbGUiLCJ1c2VyX3R5cGUiLCJpc192ZXJpZmllZCIsImlzX2FjdGl2ZSIsInRva2VuIiwic2Vzc2lvbl90b2tlbiIsImV4cGlyZXNfYXQiLCJEYXRlIiwibm93IiwiZXJyb3IiLCJsb2dvdXQiLCJnZXRTZXNzaW9uIiwibG9nTG9nb3V0IiwiaW52YWxpZGF0ZURhdGFiYXNlU2Vzc2lvbiIsImNsZWFyU2Vzc2lvbiIsInNlc3Npb25Ub2tlbiIsImZyb20iLCJ1cGRhdGUiLCJpbnZhbGlkYXRlZF9hdCIsInRvSVNPU3RyaW5nIiwidXBkYXRlZF9hdCIsImVxIiwiY29va2llU3RvcmUiLCJsZWdhY3lDb29raWVzIiwiY29va2llTmFtZSIsImRlbGV0ZSIsImhhc1JvbGUiLCJyZXF1aXJlZFJvbGUiLCJ2YWxpZGF0aW9uIiwicmVxdWlyZVJvbGUiLCJFcnJvciIsInVwZGF0ZVNlc3Npb25BY3Rpdml0eSIsImxhc3RfYWNjZXNzZWRfYXQiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(action-browser)/./lib/unified-auth.ts\n");

/***/ })

};
;
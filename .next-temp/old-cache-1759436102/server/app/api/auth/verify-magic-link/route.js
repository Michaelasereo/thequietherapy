/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/auth/verify-magic-link/route";
exports.ids = ["app/api/auth/verify-magic-link/route"];
exports.modules = {

/***/ "(rsc)/./app/api/auth/verify-magic-link/route.ts":
/*!*************************************************!*\
  !*** ./app/api/auth/verify-magic-link/route.ts ***!
  \*************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_auth__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/auth */ \"(rsc)/./lib/auth.ts\");\n/* harmony import */ var _lib_session_manager__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/session-manager */ \"(rsc)/./lib/session-manager.ts\");\n\n\n\nasync function GET(request) {\n    const { searchParams } = new URL(request.url);\n    const token = searchParams.get('token');\n    const authType = searchParams.get('auth_type');\n    try {\n        console.log(`üîê Verifying magic link for auth type: ${authType}`);\n        if (!token || !authType) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/auth/error?error=Invalid verification link', request.url));\n        }\n        // Validate auth type\n        const validAuthTypes = [\n            'individual',\n            'therapist',\n            'partner',\n            'admin'\n        ];\n        if (!validAuthTypes.includes(authType)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/auth/error?error=Invalid authentication type', request.url));\n        }\n        // Verify the magic link\n        const result = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.verifyMagicLinkForAuthType)(token, authType);\n        if (!result.success || !result.user) {\n            console.error('‚ùå Magic link verification failed:', result.error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(`/auth/error?error=${result.error || 'Verification failed'}`, request.url));\n        }\n        console.log('‚úÖ Magic link verified successfully for user:', result.user.email);\n        // Create session data with proper typing\n        const sessionData = {\n            id: result.user.id,\n            email: result.user.email,\n            name: result.user.full_name || result.user.email.split('@')[0],\n            role: authType,\n            user_type: result.user.user_type || authType,\n            is_verified: result.user.is_verified || false,\n            is_active: result.user.is_active || true,\n            session_token: result.user.session_token\n        };\n        // Create JWT session token using SessionManager\n        const sessionToken = await _lib_session_manager__WEBPACK_IMPORTED_MODULE_2__.SessionManager.createSession(sessionData);\n        // Create the redirect response FIRST\n        let redirectUrl = '/dashboard';\n        if (authType === 'therapist') redirectUrl = '/therapist/dashboard';\n        if (authType === 'partner') redirectUrl = '/partner/dashboard';\n        if (authType === 'admin') redirectUrl = '/admin/dashboard';\n        const response = next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL(redirectUrl, request.url));\n        // Set the JWT session cookie\n        response.cookies.set({\n            name: 'quiet_session',\n            value: sessionToken,\n            httpOnly: true,\n            secure: \"development\" === 'production',\n            sameSite: 'lax',\n            maxAge: 7 * 24 * 60 * 60 * 1000,\n            path: '/'\n        });\n        console.log('üç™ Session cookies set successfully for:', result.user.email);\n        console.log('üîë Auth type:', authType);\n        console.log('üìç Redirecting to:', redirectUrl);\n        return response;\n    } catch (error) {\n        console.error('‚ùå Magic link verification error:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.redirect(new URL('/auth/error?error=Internal server error', request.url));\n    }\n}\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        const { token, userType = 'individual' } = body;\n        console.log('üîç Verifying magic link:', {\n            token: token?.substring(0, 10) + '...',\n            userType\n        });\n        if (!token) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: 'Token is required'\n            }, {\n                status: 400\n            });\n        }\n        // Verify the magic link\n        const result = await (0,_lib_auth__WEBPACK_IMPORTED_MODULE_1__.verifyMagicLinkForAuthType)(token, userType);\n        if (result.success && result.user) {\n            console.log('‚úÖ Magic link verified for user:', result.user.email);\n            // Create session using the new session manager\n            const sessionToken = await _lib_session_manager__WEBPACK_IMPORTED_MODULE_2__.SessionManager.createSession({\n                id: result.user.id,\n                email: result.user.email,\n                name: result.user.full_name || result.user.email.split('@')[0],\n                role: userType,\n                user_type: result.user.user_type || userType,\n                is_verified: result.user.is_verified || false,\n                is_active: result.user.is_active || true,\n                session_token: result.user.session_token\n            });\n            console.log('üç™ Created unified session for:', userType, 'Token:', sessionToken.substring(0, 20) + '...');\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                message: 'Authentication successful',\n                user: {\n                    id: result.user.id,\n                    email: result.user.email,\n                    user_type: result.user.user_type\n                }\n            });\n        } else {\n            console.error('‚ùå Magic link verification failed:', result.error);\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: result.error || 'Invalid or expired magic link'\n            }, {\n                status: 400\n            });\n        }\n    } catch (error) {\n        console.error('‚ùå Magic link verification error:', error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: 'Internal server error'\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL2F1dGgvdmVyaWZ5LW1hZ2ljLWxpbmsvcm91dGUudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7QUFBdUQ7QUFDQTtBQUNEO0FBRS9DLGVBQWVHLElBQUlDLE9BQW9CO0lBQzVDLE1BQU0sRUFBRUMsWUFBWSxFQUFFLEdBQUcsSUFBSUMsSUFBSUYsUUFBUUcsR0FBRztJQUM1QyxNQUFNQyxRQUFRSCxhQUFhSSxHQUFHLENBQUM7SUFDL0IsTUFBTUMsV0FBV0wsYUFBYUksR0FBRyxDQUFDO0lBRWxDLElBQUk7UUFDRkUsUUFBUUMsR0FBRyxDQUFDLENBQUMsdUNBQXVDLEVBQUVGLFVBQVU7UUFFaEUsSUFBSSxDQUFDRixTQUFTLENBQUNFLFVBQVU7WUFDdkIsT0FBT1YscURBQVlBLENBQUNhLFFBQVEsQ0FDMUIsSUFBSVAsSUFBSSwrQ0FBK0NGLFFBQVFHLEdBQUc7UUFFdEU7UUFFQSxxQkFBcUI7UUFDckIsTUFBTU8saUJBQWlCO1lBQUM7WUFBYztZQUFhO1lBQVc7U0FBUTtRQUN0RSxJQUFJLENBQUNBLGVBQWVDLFFBQVEsQ0FBQ0wsV0FBa0I7WUFDN0MsT0FBT1YscURBQVlBLENBQUNhLFFBQVEsQ0FDMUIsSUFBSVAsSUFBSSxpREFBaURGLFFBQVFHLEdBQUc7UUFFeEU7UUFFQSx3QkFBd0I7UUFDeEIsTUFBTVMsU0FBUyxNQUFNZixxRUFBMEJBLENBQUNPLE9BQU9FO1FBRXZELElBQUksQ0FBQ00sT0FBT0MsT0FBTyxJQUFJLENBQUNELE9BQU9FLElBQUksRUFBRTtZQUNuQ1AsUUFBUVEsS0FBSyxDQUFDLHFDQUFxQ0gsT0FBT0csS0FBSztZQUMvRCxPQUFPbkIscURBQVlBLENBQUNhLFFBQVEsQ0FDMUIsSUFBSVAsSUFBSSxDQUFDLGtCQUFrQixFQUFFVSxPQUFPRyxLQUFLLElBQUksdUJBQXVCLEVBQUVmLFFBQVFHLEdBQUc7UUFFckY7UUFFQUksUUFBUUMsR0FBRyxDQUFDLGdEQUFnREksT0FBT0UsSUFBSSxDQUFDRSxLQUFLO1FB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SW9CO2dCQUNwQ25CLGFBQWFaLE9BQU9FLElBQUksQ0FBQ1UsV0FBVyxJQUFJO2dCQUN4Q0MsV0FBV2IsT0FBT0UsSUFBSSxDQUFDVyxTQUFTLElBQUk7Z0JBQ3BDQyxlQUFlZCxPQUFPRSxJQUFJLENBQUNZLGFBQWE7WUFDMUM7WUFFQW5CLFFBQVFDLEdBQUcsQ0FBQyxtQ0FBbUNtQyxVQUFVLFVBQVVoQixhQUFhaUIsU0FBUyxDQUFDLEdBQUcsTUFBTTtZQUVuRyxPQUFPaEQscURBQVlBLENBQUM4QyxJQUFJLENBQUM7Z0JBQ3ZCN0IsU0FBUztnQkFDVGlDLFNBQVM7Z0JBQ1RoQyxNQUFNO29CQUNKSSxJQUFJTixPQUFPRSxJQUFJLENBQUNJLEVBQUU7b0JBQ2xCRixPQUFPSixPQUFPRSxJQUFJLENBQUNFLEtBQUs7b0JBQ3hCTyxXQUFXWCxPQUFPRSxJQUFJLENBQUNTLFNBQVM7Z0JBQ2xDO1lBQ0Y7UUFDRixPQUFPO1lBQ0xoQixRQUFRUSxLQUFLLENBQUMscUNBQXFDSCxPQUFPRyxLQUFLO1lBQy9ELE9BQU9uQixxREFBWUEsQ0FBQzhDLElBQUksQ0FDdEI7Z0JBQUU3QixTQUFTO2dCQUFPRSxPQUFPSCxPQUFPRyxLQUFLLElBQUk7WUFBZ0MsR0FDekU7Z0JBQUU4QixRQUFRO1lBQUk7UUFFbEI7SUFFRixFQUFFLE9BQU85QixPQUFPO1FBQ2RSLFFBQVFRLEtBQUssQ0FBQyxvQ0FBb0NBO1FBQ2xELE9BQU9uQixxREFBWUEsQ0FBQzhDLElBQUksQ0FDdEI7WUFBRTdCLFNBQVM7WUFBT0UsT0FBTztRQUF3QixHQUNqRDtZQUFFOEIsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL0Rlc2t0b3AvdHJwaS1hcHAvYXBwL2FwaS9hdXRoL3ZlcmlmeS1tYWdpYy1saW5rL3JvdXRlLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcbmltcG9ydCB7IHZlcmlmeU1hZ2ljTGlua0ZvckF1dGhUeXBlIH0gZnJvbSAnQC9saWIvYXV0aCdcbmltcG9ydCB7IFNlc3Npb25NYW5hZ2VyIH0gZnJvbSAnQC9saWIvc2Vzc2lvbi1tYW5hZ2VyJ1xuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gR0VUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIGNvbnN0IHsgc2VhcmNoUGFyYW1zIH0gPSBuZXcgVVJMKHJlcXVlc3QudXJsKVxuICBjb25zdCB0b2tlbiA9IHNlYXJjaFBhcmFtcy5nZXQoJ3Rva2VuJylcbiAgY29uc3QgYXV0aFR5cGUgPSBzZWFyY2hQYXJhbXMuZ2V0KCdhdXRoX3R5cGUnKVxuXG4gIHRyeSB7XG4gICAgY29uc29sZS5sb2coYPCflJAgVmVyaWZ5aW5nIG1hZ2ljIGxpbmsgZm9yIGF1dGggdHlwZTogJHthdXRoVHlwZX1gKVxuICAgIFxuICAgIGlmICghdG9rZW4gfHwgIWF1dGhUeXBlKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KFxuICAgICAgICBuZXcgVVJMKCcvYXV0aC9lcnJvcj9lcnJvcj1JbnZhbGlkIHZlcmlmaWNhdGlvbiBsaW5rJywgcmVxdWVzdC51cmwpXG4gICAgICApXG4gICAgfVxuXG4gICAgLy8gVmFsaWRhdGUgYXV0aCB0eXBlXG4gICAgY29uc3QgdmFsaWRBdXRoVHlwZXMgPSBbJ2luZGl2aWR1YWwnLCAndGhlcmFwaXN0JywgJ3BhcnRuZXInLCAnYWRtaW4nXSBhcyBjb25zdFxuICAgIGlmICghdmFsaWRBdXRoVHlwZXMuaW5jbHVkZXMoYXV0aFR5cGUgYXMgYW55KSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5yZWRpcmVjdChcbiAgICAgICAgbmV3IFVSTCgnL2F1dGgvZXJyb3I/ZXJyb3I9SW52YWxpZCBhdXRoZW50aWNhdGlvbiB0eXBlJywgcmVxdWVzdC51cmwpXG4gICAgICApXG4gICAgfVxuXG4gICAgLy8gVmVyaWZ5IHRoZSBtYWdpYyBsaW5rXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgdmVyaWZ5TWFnaWNMaW5rRm9yQXV0aFR5cGUodG9rZW4sIGF1dGhUeXBlIGFzICdpbmRpdmlkdWFsJyB8ICd0aGVyYXBpc3QnIHwgJ3BhcnRuZXInIHwgJ2FkbWluJylcbiAgICBcbiAgICBpZiAoIXJlc3VsdC5zdWNjZXNzIHx8ICFyZXN1bHQudXNlcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIE1hZ2ljIGxpbmsgdmVyaWZpY2F0aW9uIGZhaWxlZDonLCByZXN1bHQuZXJyb3IpXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KFxuICAgICAgICBuZXcgVVJMKGAvYXV0aC9lcnJvcj9lcnJvcj0ke3Jlc3VsdC5lcnJvciB8fCAnVmVyaWZpY2F0aW9uIGZhaWxlZCd9YCwgcmVxdWVzdC51cmwpXG4gICAgICApXG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ+KchSBNYWdpYyBsaW5rIHZlcmlmaWVkIHN1Y2Nlc3NmdWxseSBmb3IgdXNlcjonLCByZXN1bHQudXNlci5lbWFpbClcblxuICAgIC8vIENyZWF0ZSBzZXNzaW9uIGRhdGEgd2l0aCBwcm9wZXIgdHlwaW5nXG4gICAgY29uc3Qgc2Vzc2lvbkRhdGEgPSB7XG4gICAgICBpZDogcmVzdWx0LnVzZXIuaWQsXG4gICAgICBlbWFpbDogcmVzdWx0LnVzZXIuZW1haWwsXG4gICAgICBuYW1lOiByZXN1bHQudXNlci5mdWxsX25hbWUgfHwgcmVzdWx0LnVzZXIuZW1haWwuc3BsaXQoJ0AnKVswXSxcbiAgICAgIHJvbGU6IGF1dGhUeXBlIGFzICdhZG1pbicgfCAncGFydG5lcicgfCAndGhlcmFwaXN0JyB8ICdpbmRpdmlkdWFsJyxcbiAgICAgIHVzZXJfdHlwZTogcmVzdWx0LnVzZXIudXNlcl90eXBlIHx8IGF1dGhUeXBlLFxuICAgICAgaXNfdmVyaWZpZWQ6IHJlc3VsdC51c2VyLmlzX3ZlcmlmaWVkIHx8IGZhbHNlLFxuICAgICAgaXNfYWN0aXZlOiByZXN1bHQudXNlci5pc19hY3RpdmUgfHwgdHJ1ZSxcbiAgICAgIHNlc3Npb25fdG9rZW46IHJlc3VsdC51c2VyLnNlc3Npb25fdG9rZW5cbiAgICB9XG5cbiAgICAvLyBDcmVhdGUgSldUIHNlc3Npb24gdG9rZW4gdXNpbmcgU2Vzc2lvbk1hbmFnZXJcbiAgICBjb25zdCBzZXNzaW9uVG9rZW4gPSBhd2FpdCBTZXNzaW9uTWFuYWdlci5jcmVhdGVTZXNzaW9uKHNlc3Npb25EYXRhKVxuXG4gICAgLy8gQ3JlYXRlIHRoZSByZWRpcmVjdCByZXNwb25zZSBGSVJTVFxuICAgIGxldCByZWRpcmVjdFVybCA9ICcvZGFzaGJvYXJkJ1xuICAgIGlmIChhdXRoVHlwZSA9PT0gJ3RoZXJhcGlzdCcpIHJlZGlyZWN0VXJsID0gJy90aGVyYXBpc3QvZGFzaGJvYXJkJ1xuICAgIGlmIChhdXRoVHlwZSA9PT0gJ3BhcnRuZXInKSByZWRpcmVjdFVybCA9ICcvcGFydG5lci9kYXNoYm9hcmQnXG4gICAgaWYgKGF1dGhUeXBlID09PSAnYWRtaW4nKSByZWRpcmVjdFVybCA9ICcvYWRtaW4vZGFzaGJvYXJkJ1xuXG4gICAgY29uc3QgcmVzcG9uc2UgPSBOZXh0UmVzcG9uc2UucmVkaXJlY3QobmV3IFVSTChyZWRpcmVjdFVybCwgcmVxdWVzdC51cmwpKVxuXG4gICAgLy8gU2V0IHRoZSBKV1Qgc2Vzc2lvbiBjb29raWVcbiAgICByZXNwb25zZS5jb29raWVzLnNldCh7XG4gICAgICBuYW1lOiAncXVpZXRfc2Vzc2lvbicsXG4gICAgICB2YWx1ZTogc2Vzc2lvblRva2VuLCAvLyBUaGlzIGlzIG5vdyBhIEpXVCB0b2tlbiwgbm90IEpTT05cbiAgICAgIGh0dHBPbmx5OiB0cnVlLFxuICAgICAgc2VjdXJlOiBwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ3Byb2R1Y3Rpb24nLFxuICAgICAgc2FtZVNpdGU6ICdsYXgnLFxuICAgICAgbWF4QWdlOiA3ICogMjQgKiA2MCAqIDYwICogMTAwMCwgLy8gNyBkYXlzXG4gICAgICBwYXRoOiAnLycsXG4gICAgfSlcblxuICAgIGNvbnNvbGUubG9nKCfwn42qIFNlc3Npb24gY29va2llcyBzZXQgc3VjY2Vzc2Z1bGx5IGZvcjonLCByZXN1bHQudXNlci5lbWFpbClcbiAgICBjb25zb2xlLmxvZygn8J+UkSBBdXRoIHR5cGU6JywgYXV0aFR5cGUpXG4gICAgY29uc29sZS5sb2coJ/Cfk40gUmVkaXJlY3RpbmcgdG86JywgcmVkaXJlY3RVcmwpXG5cbiAgICByZXR1cm4gcmVzcG9uc2VcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBNYWdpYyBsaW5rIHZlcmlmaWNhdGlvbiBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLnJlZGlyZWN0KFxuICAgICAgbmV3IFVSTCgnL2F1dGgvZXJyb3I/ZXJyb3I9SW50ZXJuYWwgc2VydmVyIGVycm9yJywgcmVxdWVzdC51cmwpXG4gICAgKVxuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QuanNvbigpXG4gICAgY29uc3QgeyB0b2tlbiwgdXNlclR5cGUgPSAnaW5kaXZpZHVhbCcgfSA9IGJvZHlcblxuICAgIGNvbnNvbGUubG9nKCfwn5SNIFZlcmlmeWluZyBtYWdpYyBsaW5rOicsIHsgdG9rZW46IHRva2VuPy5zdWJzdHJpbmcoMCwgMTApICsgJy4uLicsIHVzZXJUeXBlIH0pXG5cbiAgICBpZiAoIXRva2VuKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVG9rZW4gaXMgcmVxdWlyZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICAgIC8vIFZlcmlmeSB0aGUgbWFnaWMgbGlua1xuICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHZlcmlmeU1hZ2ljTGlua0ZvckF1dGhUeXBlKHRva2VuLCB1c2VyVHlwZSlcbiAgICBcbiAgICBpZiAocmVzdWx0LnN1Y2Nlc3MgJiYgcmVzdWx0LnVzZXIpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgTWFnaWMgbGluayB2ZXJpZmllZCBmb3IgdXNlcjonLCByZXN1bHQudXNlci5lbWFpbClcbiAgICAgIFxuICAgICAgLy8gQ3JlYXRlIHNlc3Npb24gdXNpbmcgdGhlIG5ldyBzZXNzaW9uIG1hbmFnZXJcbiAgICAgIGNvbnN0IHNlc3Npb25Ub2tlbiA9IGF3YWl0IFNlc3Npb25NYW5hZ2VyLmNyZWF0ZVNlc3Npb24oe1xuICAgICAgICBpZDogcmVzdWx0LnVzZXIuaWQsXG4gICAgICAgIGVtYWlsOiByZXN1bHQudXNlci5lbWFpbCxcbiAgICAgICAgbmFtZTogcmVzdWx0LnVzZXIuZnVsbF9uYW1lIHx8IHJlc3VsdC51c2VyLmVtYWlsLnNwbGl0KCdAJylbMF0sXG4gICAgICAgIHJvbGU6IHVzZXJUeXBlIGFzICdpbmRpdmlkdWFsJyB8ICd0aGVyYXBpc3QnIHwgJ3BhcnRuZXInIHwgJ2FkbWluJyxcbiAgICAgICAgdXNlcl90eXBlOiByZXN1bHQudXNlci51c2VyX3R5cGUgfHwgdXNlclR5cGUsXG4gICAgICAgIGlzX3ZlcmlmaWVkOiByZXN1bHQudXNlci5pc192ZXJpZmllZCB8fCBmYWxzZSxcbiAgICAgICAgaXNfYWN0aXZlOiByZXN1bHQudXNlci5pc19hY3RpdmUgfHwgdHJ1ZSxcbiAgICAgICAgc2Vzc2lvbl90b2tlbjogcmVzdWx0LnVzZXIuc2Vzc2lvbl90b2tlblxuICAgICAgfSlcblxuICAgICAgY29uc29sZS5sb2coJ/CfjaogQ3JlYXRlZCB1bmlmaWVkIHNlc3Npb24gZm9yOicsIHVzZXJUeXBlLCAnVG9rZW46Jywgc2Vzc2lvblRva2VuLnN1YnN0cmluZygwLCAyMCkgKyAnLi4uJylcbiAgICAgIFxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgICAgbWVzc2FnZTogJ0F1dGhlbnRpY2F0aW9uIHN1Y2Nlc3NmdWwnLFxuICAgICAgICB1c2VyOiB7XG4gICAgICAgICAgaWQ6IHJlc3VsdC51c2VyLmlkLFxuICAgICAgICAgIGVtYWlsOiByZXN1bHQudXNlci5lbWFpbCxcbiAgICAgICAgICB1c2VyX3R5cGU6IHJlc3VsdC51c2VyLnVzZXJfdHlwZVxuICAgICAgICB9XG4gICAgICB9KVxuICAgIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgTWFnaWMgbGluayB2ZXJpZmljYXRpb24gZmFpbGVkOicsIHJlc3VsdC5lcnJvcilcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHJlc3VsdC5lcnJvciB8fCAnSW52YWxpZCBvciBleHBpcmVkIG1hZ2ljIGxpbmsnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKVxuICAgIH1cblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBNYWdpYyBsaW5rIHZlcmlmaWNhdGlvbiBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgIClcbiAgfVxufVxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsInZlcmlmeU1hZ2ljTGlua0ZvckF1dGhUeXBlIiwiU2Vzc2lvbk1hbmFnZXIiLCJHRVQiLCJyZXF1ZXN0Iiwic2VhcmNoUGFyYW1zIiwiVVJMIiwidXJsIiwidG9rZW4iLCJnZXQiLCJhdXRoVHlwZSIsImNvbnNvbGUiLCJsb2ciLCJyZWRpcmVjdCIsInZhbGlkQXV0aFR5cGVzIiwiaW5jbHVkZXMiLCJyZXN1bHQiLCJzdWNjZXNzIiwidXNlciIsImVycm9yIiwiZW1haWwiLCJzZXNzaW9uRGF0YSIsImlkIiwibmFtZSIsImZ1bGxfbmFtZSIsInNwbGl0Iiwicm9sZSIsInVzZXJfdHlwZSIsImlzX3ZlcmlmaWVkIiwiaXNfYWN0aXZlIiwic2Vzc2lvbl90b2tlbiIsInNlc3Npb25Ub2tlbiIsImNyZWF0ZVNlc3Npb24iLCJyZWRpcmVjdFVybCIsInJlc3BvbnNlIiwiY29va2llcyIsInNldCIsInZhbHVlIiwiaHR0cE9ubHkiLCJzZWN1cmUiLCJwcm9jZXNzIiwic2FtZVNpdGUiLCJtYXhBZ2UiLCJwYXRoIiwiUE9TVCIsImJvZHkiLCJqc29uIiwidXNlclR5cGUiLCJzdWJzdHJpbmciLCJzdGF0dXMiLCJtZXNzYWdlIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/auth/verify-magic-link/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/audit-logger.ts":
/*!*****************************!*\
  !*** ./lib/audit-logger.ts ***!
  \*****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   AuditLogger: () => (/* binding */ AuditLogger)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://frzciymslvpohhyefmtr.supabase.co\" || 0, process.env.SUPABASE_SERVICE_ROLE_KEY || '');\n/**\n * HIPAA-compliant audit logging system\n * Logs all authentication and security events\n */ class AuditLogger {\n    /**\n   * Log an authentication event\n   */ static async logAuthEvent(userId, eventType, metadata = {}) {\n        try {\n            const logEntry = {\n                user_id: userId,\n                event_type: eventType,\n                ip_address: metadata.ip_address || null,\n                user_agent: metadata.user_agent || null,\n                device_fingerprint: metadata.device_fingerprint || null,\n                session_id: metadata.session_id || null,\n                metadata: metadata,\n                created_at: new Date().toISOString()\n            };\n            const { error } = await supabase.from('audit_logs').insert(logEntry);\n            if (error) {\n                console.error('‚ùå Audit log error:', error);\n            // Don't throw - we don't want audit logging to break the app\n            } else {\n                console.log(`üìù Audit logged: ${eventType} for user ${userId || 'anonymous'}`);\n            }\n        } catch (error) {\n            console.error('‚ùå Audit logging failed:', error);\n        // Silent fail - audit logging should never break the app\n        }\n    }\n    /**\n   * Log successful login\n   */ static async logLoginSuccess(userId, metadata) {\n        await this.logAuthEvent(userId, 'login_success', {\n            ...metadata,\n            message: 'User logged in successfully'\n        });\n    }\n    /**\n   * Log failed login attempt\n   */ static async logLoginFailure(email, reason, metadata) {\n        await this.logAuthEvent(null, 'login_failure', {\n            ...metadata,\n            email,\n            error_message: reason,\n            message: 'Login attempt failed'\n        });\n    }\n    /**\n   * Log logout event\n   */ static async logLogout(userId, metadata) {\n        await this.logAuthEvent(userId, 'logout', {\n            ...metadata,\n            message: 'User logged out'\n        });\n    }\n    /**\n   * Log session refresh\n   */ static async logSessionRefresh(userId, metadata) {\n        await this.logAuthEvent(userId, 'session_refresh', {\n            ...metadata,\n            message: 'Session token refreshed'\n        });\n    }\n    /**\n   * Log magic link sent\n   */ static async logMagicLinkSent(email, metadata) {\n        await this.logAuthEvent(null, 'magic_link_sent', {\n            ...metadata,\n            email,\n            message: 'Magic link sent to user'\n        });\n    }\n    /**\n   * Log magic link verification (success or failure)\n   */ static async logMagicLinkVerification(userId, success, metadata) {\n        await this.logAuthEvent(userId, success ? 'magic_link_verified' : 'magic_link_failed', {\n            ...metadata,\n            message: success ? 'Magic link verified successfully' : 'Magic link verification failed'\n        });\n    }\n    /**\n   * Log suspicious activity (e.g., session hijacking attempt)\n   */ static async logSuspiciousActivity(userId, activity, metadata) {\n        await this.logAuthEvent(userId, 'suspicious_activity', {\n            ...metadata,\n            activity,\n            severity: 'high',\n            message: `Suspicious activity detected: ${activity}`\n        });\n    }\n    /**\n   * Log session hijack attempt\n   */ static async logSessionHijackAttempt(userId, metadata) {\n        await this.logAuthEvent(userId, 'session_hijack_attempt', {\n            ...metadata,\n            severity: 'critical',\n            message: 'Possible session hijacking attempt detected'\n        });\n    }\n    /**\n   * Log rate limit exceeded\n   */ static async logRateLimitExceeded(identifier, action, metadata) {\n        await this.logAuthEvent(null, 'rate_limit_exceeded', {\n            ...metadata,\n            identifier,\n            action,\n            message: `Rate limit exceeded for action: ${action}`\n        });\n    }\n    /**\n   * Get recent logs for a user (for admin/debugging)\n   */ static async getUserLogs(userId, limit = 50) {\n        try {\n            const { data, error } = await supabase.from('audit_logs').select('*').eq('user_id', userId).order('created_at', {\n                ascending: false\n            }).limit(limit);\n            if (error) {\n                console.error('‚ùå Error fetching user logs:', error);\n                return [];\n            }\n            return data || [];\n        } catch (error) {\n            console.error('‚ùå Error fetching user logs:', error);\n            return [];\n        }\n    }\n    /**\n   * Get suspicious activity logs (for security monitoring)\n   */ static async getSuspiciousActivityLogs(limit = 100) {\n        try {\n            const { data, error } = await supabase.from('audit_logs').select('*').in('event_type', [\n                'suspicious_activity',\n                'session_hijack_attempt',\n                'rate_limit_exceeded'\n            ]).order('created_at', {\n                ascending: false\n            }).limit(limit);\n            if (error) {\n                console.error('‚ùå Error fetching suspicious activity logs:', error);\n                return [];\n            }\n            return data || [];\n        } catch (error) {\n            console.error('‚ùå Error fetching suspicious activity logs:', error);\n            return [];\n        }\n    }\n    /**\n   * Archive old logs (for HIPAA compliance - retain for required period)\n   * Should be run via cron job\n   */ static async archiveOldLogs(daysToRetain = 90) {\n        const cutoffDate = new Date(Date.now() - daysToRetain * 24 * 60 * 60 * 1000);\n        try {\n            // In production, you'd move these to cold storage rather than delete\n            // For now, we'll just mark them as archived\n            const { error } = await supabase.from('audit_logs').update({\n                archived: true\n            }).lt('created_at', cutoffDate.toISOString()).eq('archived', false);\n            if (error) {\n                console.error('‚ùå Audit log archival error:', error);\n            } else {\n                console.log(`‚úÖ Archived audit logs older than ${daysToRetain} days`);\n            }\n        } catch (error) {\n            console.error('‚ùå Audit log archival failed:', error);\n        }\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvYXVkaXQtbG9nZ2VyLnRzIiwibWFwcGluZ3MiOiI7Ozs7O0FBQW9EO0FBRXBELE1BQU1DLFdBQVdELG1FQUFZQSxDQUMzQkUsMENBQW9DLElBQUksQ0FBRSxFQUMxQ0EsUUFBUUMsR0FBRyxDQUFDRSx5QkFBeUIsSUFBSTtBQW9DM0M7OztDQUdDLEdBQ00sTUFBTUM7SUFDWDs7R0FFQyxHQUNELGFBQWFDLGFBQ1hDLE1BQXFCLEVBQ3JCQyxTQUF3QixFQUN4QkMsV0FBNkIsQ0FBQyxDQUFDLEVBQ2hCO1FBQ2YsSUFBSTtZQUNGLE1BQU1DLFdBQVc7Z0JBQ2ZDLFNBQVNKO2dCQUNUSyxZQUFZSjtnQkFDWkssWUFBWUosU0FBU0ksVUFBVSxJQUFJO2dCQUNuQ0MsWUFBWUwsU0FBU0ssVUFBVSxJQUFJO2dCQUNuQ0Msb0JBQW9CTixTQUFTTSxrQkFBa0IsSUFBSTtnQkFDbkRDLFlBQVlQLFNBQVNPLFVBQVUsSUFBSTtnQkFDbkNQLFVBQVVBO2dCQUNWUSxZQUFZLElBQUlDLE9BQU9DLFdBQVc7WUFDcEM7WUFFQSxNQUFNLEVBQUVDLEtBQUssRUFBRSxHQUFHLE1BQU1wQixTQUNyQnFCLElBQUksQ0FBQyxjQUNMQyxNQUFNLENBQUNaO1lBRVYsSUFBSVUsT0FBTztnQkFDVEcsUUFBUUgsS0FBSyxDQUFDLHNCQUFzQkE7WUFDcEMsNkRBQTZEO1lBQy9ELE9BQU87Z0JBQ0xHLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLGlCQUFpQixFQUFFaEIsVUFBVSxVQUFVLEVBQUVELFVBQVUsYUFBYTtZQUMvRTtRQUNGLEVBQUUsT0FBT2EsT0FBTztZQUNkRyxRQUFRSCxLQUFLLENBQUMsMkJBQTJCQTtRQUN6Qyx5REFBeUQ7UUFDM0Q7SUFDRjtJQUVBOztHQUVDLEdBQ0QsYUFBYUssZ0JBQWdCbEIsTUFBYyxFQUFFRSxRQUEwQixFQUFpQjtRQUN0RixNQUFNLElBQUksQ0FBQ0gsWUFBWSxDQUFDQyxRQUFRLGlCQUFpQjtZQUMvQyxHQUFHRSxRQUFRO1lBQ1hpQixTQUFTO1FBQ1g7SUFDRjtJQUVBOztHQUVDLEdBQ0QsYUFBYUMsZ0JBQWdCQyxLQUFhLEVBQUVDLE1BQWMsRUFBRXBCLFFBQTBCLEVBQWlCO1FBQ3JHLE1BQU0sSUFBSSxDQUFDSCxZQUFZLENBQUMsTUFBTSxpQkFBaUI7WUFDN0MsR0FBR0csUUFBUTtZQUNYbUI7WUFDQUUsZUFBZUQ7WUFDZkgsU0FBUztRQUNYO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELGFBQWFLLFVBQVV4QixNQUFjLEVBQUVFLFFBQTBCLEVBQWlCO1FBQ2hGLE1BQU0sSUFBSSxDQUFDSCxZQUFZLENBQUNDLFFBQVEsVUFBVTtZQUN4QyxHQUFHRSxRQUFRO1lBQ1hpQixTQUFTO1FBQ1g7SUFDRjtJQUVBOztHQUVDLEdBQ0QsYUFBYU0sa0JBQWtCekIsTUFBYyxFQUFFRSxRQUEwQixFQUFpQjtRQUN4RixNQUFNLElBQUksQ0FBQ0gsWUFBWSxDQUFDQyxRQUFRLG1CQUFtQjtZQUNqRCxHQUFHRSxRQUFRO1lBQ1hpQixTQUFTO1FBQ1g7SUFDRjtJQUVBOztHQUVDLEdBQ0QsYUFBYU8saUJBQWlCTCxLQUFhLEVBQUVuQixRQUEwQixFQUFpQjtRQUN0RixNQUFNLElBQUksQ0FBQ0gsWUFBWSxDQUFDLE1BQU0sbUJBQW1CO1lBQy9DLEdBQUdHLFFBQVE7WUFDWG1CO1lBQ0FGLFNBQVM7UUFDWDtJQUNGO0lBRUE7O0dBRUMsR0FDRCxhQUFhUSx5QkFDWDNCLE1BQXFCLEVBQ3JCNEIsT0FBZ0IsRUFDaEIxQixRQUEwQixFQUNYO1FBQ2YsTUFBTSxJQUFJLENBQUNILFlBQVksQ0FDckJDLFFBQ0E0QixVQUFVLHdCQUF3QixxQkFDbEM7WUFDRSxHQUFHMUIsUUFBUTtZQUNYaUIsU0FBU1MsVUFBVSxxQ0FBcUM7UUFDMUQ7SUFFSjtJQUVBOztHQUVDLEdBQ0QsYUFBYUMsc0JBQ1g3QixNQUFjLEVBQ2Q4QixRQUFnQixFQUNoQjVCLFFBQTBCLEVBQ1g7UUFDZixNQUFNLElBQUksQ0FBQ0gsWUFBWSxDQUFDQyxRQUFRLHVCQUF1QjtZQUNyRCxHQUFHRSxRQUFRO1lBQ1g0QjtZQUNBQyxVQUFVO1lBQ1ZaLFNBQVMsQ0FBQyw4QkFBOEIsRUFBRVcsVUFBVTtRQUN0RDtJQUNGO0lBRUE7O0dBRUMsR0FDRCxhQUFhRSx3QkFDWGhDLE1BQWMsRUFDZEUsUUFBMEIsRUFDWDtRQUNmLE1BQU0sSUFBSSxDQUFDSCxZQUFZLENBQUNDLFFBQVEsMEJBQTBCO1lBQ3hELEdBQUdFLFFBQVE7WUFDWDZCLFVBQVU7WUFDVlosU0FBUztRQUNYO0lBQ0Y7SUFFQTs7R0FFQyxHQUNELGFBQWFjLHFCQUNYQyxVQUFrQixFQUNsQkMsTUFBYyxFQUNkakMsUUFBMEIsRUFDWDtRQUNmLE1BQU0sSUFBSSxDQUFDSCxZQUFZLENBQUMsTUFBTSx1QkFBdUI7WUFDbkQsR0FBR0csUUFBUTtZQUNYZ0M7WUFDQUM7WUFDQWhCLFNBQVMsQ0FBQyxnQ0FBZ0MsRUFBRWdCLFFBQVE7UUFDdEQ7SUFDRjtJQUVBOztHQUVDLEdBQ0QsYUFBYUMsWUFDWHBDLE1BQWMsRUFDZHFDLFFBQWdCLEVBQUUsRUFDRjtRQUNoQixJQUFJO1lBQ0YsTUFBTSxFQUFFQyxJQUFJLEVBQUV6QixLQUFLLEVBQUUsR0FBRyxNQUFNcEIsU0FDM0JxQixJQUFJLENBQUMsY0FDTHlCLE1BQU0sQ0FBQyxLQUNQQyxFQUFFLENBQUMsV0FBV3hDLFFBQ2R5QyxLQUFLLENBQUMsY0FBYztnQkFBRUMsV0FBVztZQUFNLEdBQ3ZDTCxLQUFLLENBQUNBO1lBRVQsSUFBSXhCLE9BQU87Z0JBQ1RHLFFBQVFILEtBQUssQ0FBQywrQkFBK0JBO2dCQUM3QyxPQUFPLEVBQUU7WUFDWDtZQUVBLE9BQU95QixRQUFRLEVBQUU7UUFDbkIsRUFBRSxPQUFPekIsT0FBTztZQUNkRyxRQUFRSCxLQUFLLENBQUMsK0JBQStCQTtZQUM3QyxPQUFPLEVBQUU7UUFDWDtJQUNGO0lBRUE7O0dBRUMsR0FDRCxhQUFhOEIsMEJBQTBCTixRQUFnQixHQUFHLEVBQWtCO1FBQzFFLElBQUk7WUFDRixNQUFNLEVBQUVDLElBQUksRUFBRXpCLEtBQUssRUFBRSxHQUFHLE1BQU1wQixTQUMzQnFCLElBQUksQ0FBQyxjQUNMeUIsTUFBTSxDQUFDLEtBQ1BLLEVBQUUsQ0FBQyxjQUFjO2dCQUFDO2dCQUF1QjtnQkFBMEI7YUFBc0IsRUFDekZILEtBQUssQ0FBQyxjQUFjO2dCQUFFQyxXQUFXO1lBQU0sR0FDdkNMLEtBQUssQ0FBQ0E7WUFFVCxJQUFJeEIsT0FBTztnQkFDVEcsUUFBUUgsS0FBSyxDQUFDLDhDQUE4Q0E7Z0JBQzVELE9BQU8sRUFBRTtZQUNYO1lBRUEsT0FBT3lCLFFBQVEsRUFBRTtRQUNuQixFQUFFLE9BQU96QixPQUFPO1lBQ2RHLFFBQVFILEtBQUssQ0FBQyw4Q0FBOENBO1lBQzVELE9BQU8sRUFBRTtRQUNYO0lBQ0Y7SUFFQTs7O0dBR0MsR0FDRCxhQUFhZ0MsZUFBZUMsZUFBdUIsRUFBRSxFQUFpQjtRQUNwRSxNQUFNQyxhQUFhLElBQUlwQyxLQUFLQSxLQUFLcUMsR0FBRyxLQUFLRixlQUFlLEtBQUssS0FBSyxLQUFLO1FBRXZFLElBQUk7WUFDRixxRUFBcUU7WUFDckUsNENBQTRDO1lBQzVDLE1BQU0sRUFBRWpDLEtBQUssRUFBRSxHQUFHLE1BQU1wQixTQUNyQnFCLElBQUksQ0FBQyxjQUNMbUMsTUFBTSxDQUFDO2dCQUFFQyxVQUFVO1lBQUssR0FDeEJDLEVBQUUsQ0FBQyxjQUFjSixXQUFXbkMsV0FBVyxJQUN2QzRCLEVBQUUsQ0FBQyxZQUFZO1lBRWxCLElBQUkzQixPQUFPO2dCQUNURyxRQUFRSCxLQUFLLENBQUMsK0JBQStCQTtZQUMvQyxPQUFPO2dCQUNMRyxRQUFRQyxHQUFHLENBQUMsQ0FBQyxpQ0FBaUMsRUFBRTZCLGFBQWEsS0FBSyxDQUFDO1lBQ3JFO1FBQ0YsRUFBRSxPQUFPakMsT0FBTztZQUNkRyxRQUFRSCxLQUFLLENBQUMsZ0NBQWdDQTtRQUNoRDtJQUNGO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL0Rlc2t0b3AvdHJwaS1hcHAvbGliL2F1ZGl0LWxvZ2dlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnXG5cbmNvbnN0IHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KFxuICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgfHwgJycsXG4gIHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgfHwgJydcbilcblxuZXhwb3J0IHR5cGUgQXV0aEV2ZW50VHlwZSA9XG4gIHwgJ2xvZ2luX2F0dGVtcHQnXG4gIHwgJ2xvZ2luX3N1Y2Nlc3MnXG4gIHwgJ2xvZ2luX2ZhaWx1cmUnXG4gIHwgJ2xvZ291dCdcbiAgfCAnc2Vzc2lvbl9yZWZyZXNoJ1xuICB8ICdzZXNzaW9uX2V4cGlyZWQnXG4gIHwgJ21hZ2ljX2xpbmtfc2VudCdcbiAgfCAnbWFnaWNfbGlua192ZXJpZmllZCdcbiAgfCAnbWFnaWNfbGlua19mYWlsZWQnXG4gIHwgJ3Bhc3N3b3JkX3Jlc2V0X3JlcXVlc3QnXG4gIHwgJ3Bhc3N3b3JkX3Jlc2V0X3N1Y2Nlc3MnXG4gIHwgJ2FjY291bnRfY3JlYXRlZCdcbiAgfCAnYWNjb3VudF9kZWxldGVkJ1xuICB8ICdyb2xlX2NoYW5nZWQnXG4gIHwgJ3Blcm1pc3Npb25zX21vZGlmaWVkJ1xuICB8ICdzdXNwaWNpb3VzX2FjdGl2aXR5J1xuICB8ICdzZXNzaW9uX2hpamFja19hdHRlbXB0J1xuICB8ICdyYXRlX2xpbWl0X2V4Y2VlZGVkJ1xuXG5leHBvcnQgaW50ZXJmYWNlIEF1ZGl0TG9nTWV0YWRhdGEge1xuICBpcF9hZGRyZXNzPzogc3RyaW5nXG4gIHVzZXJfYWdlbnQ/OiBzdHJpbmdcbiAgbG9jYXRpb24/OiBzdHJpbmdcbiAgZGV2aWNlX2ZpbmdlcnByaW50Pzogc3RyaW5nXG4gIHNlc3Npb25faWQ/OiBzdHJpbmdcbiAgZXJyb3JfbWVzc2FnZT86IHN0cmluZ1xuICBhZmZlY3RlZF91c2VyX2lkPzogc3RyaW5nXG4gIG9sZF92YWx1ZT86IHN0cmluZ1xuICBuZXdfdmFsdWU/OiBzdHJpbmdcbiAgW2tleTogc3RyaW5nXTogYW55XG59XG5cbi8qKlxuICogSElQQUEtY29tcGxpYW50IGF1ZGl0IGxvZ2dpbmcgc3lzdGVtXG4gKiBMb2dzIGFsbCBhdXRoZW50aWNhdGlvbiBhbmQgc2VjdXJpdHkgZXZlbnRzXG4gKi9cbmV4cG9ydCBjbGFzcyBBdWRpdExvZ2dlciB7XG4gIC8qKlxuICAgKiBMb2cgYW4gYXV0aGVudGljYXRpb24gZXZlbnRcbiAgICovXG4gIHN0YXRpYyBhc3luYyBsb2dBdXRoRXZlbnQoXG4gICAgdXNlcklkOiBzdHJpbmcgfCBudWxsLFxuICAgIGV2ZW50VHlwZTogQXV0aEV2ZW50VHlwZSxcbiAgICBtZXRhZGF0YTogQXVkaXRMb2dNZXRhZGF0YSA9IHt9XG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBsb2dFbnRyeSA9IHtcbiAgICAgICAgdXNlcl9pZDogdXNlcklkLFxuICAgICAgICBldmVudF90eXBlOiBldmVudFR5cGUsXG4gICAgICAgIGlwX2FkZHJlc3M6IG1ldGFkYXRhLmlwX2FkZHJlc3MgfHwgbnVsbCxcbiAgICAgICAgdXNlcl9hZ2VudDogbWV0YWRhdGEudXNlcl9hZ2VudCB8fCBudWxsLFxuICAgICAgICBkZXZpY2VfZmluZ2VycHJpbnQ6IG1ldGFkYXRhLmRldmljZV9maW5nZXJwcmludCB8fCBudWxsLFxuICAgICAgICBzZXNzaW9uX2lkOiBtZXRhZGF0YS5zZXNzaW9uX2lkIHx8IG51bGwsXG4gICAgICAgIG1ldGFkYXRhOiBtZXRhZGF0YSxcbiAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdhdWRpdF9sb2dzJylcbiAgICAgICAgLmluc2VydChsb2dFbnRyeSlcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBBdWRpdCBsb2cgZXJyb3I6JywgZXJyb3IpXG4gICAgICAgIC8vIERvbid0IHRocm93IC0gd2UgZG9uJ3Qgd2FudCBhdWRpdCBsb2dnaW5nIHRvIGJyZWFrIHRoZSBhcHBcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDwn5OdIEF1ZGl0IGxvZ2dlZDogJHtldmVudFR5cGV9IGZvciB1c2VyICR7dXNlcklkIHx8ICdhbm9ueW1vdXMnfWApXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBBdWRpdCBsb2dnaW5nIGZhaWxlZDonLCBlcnJvcilcbiAgICAgIC8vIFNpbGVudCBmYWlsIC0gYXVkaXQgbG9nZ2luZyBzaG91bGQgbmV2ZXIgYnJlYWsgdGhlIGFwcFxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgc3VjY2Vzc2Z1bCBsb2dpblxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGxvZ0xvZ2luU3VjY2Vzcyh1c2VySWQ6IHN0cmluZywgbWV0YWRhdGE6IEF1ZGl0TG9nTWV0YWRhdGEpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmxvZ0F1dGhFdmVudCh1c2VySWQsICdsb2dpbl9zdWNjZXNzJywge1xuICAgICAgLi4ubWV0YWRhdGEsXG4gICAgICBtZXNzYWdlOiAnVXNlciBsb2dnZWQgaW4gc3VjY2Vzc2Z1bGx5J1xuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogTG9nIGZhaWxlZCBsb2dpbiBhdHRlbXB0XG4gICAqL1xuICBzdGF0aWMgYXN5bmMgbG9nTG9naW5GYWlsdXJlKGVtYWlsOiBzdHJpbmcsIHJlYXNvbjogc3RyaW5nLCBtZXRhZGF0YTogQXVkaXRMb2dNZXRhZGF0YSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMubG9nQXV0aEV2ZW50KG51bGwsICdsb2dpbl9mYWlsdXJlJywge1xuICAgICAgLi4ubWV0YWRhdGEsXG4gICAgICBlbWFpbCxcbiAgICAgIGVycm9yX21lc3NhZ2U6IHJlYXNvbixcbiAgICAgIG1lc3NhZ2U6ICdMb2dpbiBhdHRlbXB0IGZhaWxlZCdcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqIExvZyBsb2dvdXQgZXZlbnRcbiAgICovXG4gIHN0YXRpYyBhc3luYyBsb2dMb2dvdXQodXNlcklkOiBzdHJpbmcsIG1ldGFkYXRhOiBBdWRpdExvZ01ldGFkYXRhKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgYXdhaXQgdGhpcy5sb2dBdXRoRXZlbnQodXNlcklkLCAnbG9nb3V0Jywge1xuICAgICAgLi4ubWV0YWRhdGEsXG4gICAgICBtZXNzYWdlOiAnVXNlciBsb2dnZWQgb3V0J1xuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogTG9nIHNlc3Npb24gcmVmcmVzaFxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGxvZ1Nlc3Npb25SZWZyZXNoKHVzZXJJZDogc3RyaW5nLCBtZXRhZGF0YTogQXVkaXRMb2dNZXRhZGF0YSk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMubG9nQXV0aEV2ZW50KHVzZXJJZCwgJ3Nlc3Npb25fcmVmcmVzaCcsIHtcbiAgICAgIC4uLm1ldGFkYXRhLFxuICAgICAgbWVzc2FnZTogJ1Nlc3Npb24gdG9rZW4gcmVmcmVzaGVkJ1xuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogTG9nIG1hZ2ljIGxpbmsgc2VudFxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGxvZ01hZ2ljTGlua1NlbnQoZW1haWw6IHN0cmluZywgbWV0YWRhdGE6IEF1ZGl0TG9nTWV0YWRhdGEpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmxvZ0F1dGhFdmVudChudWxsLCAnbWFnaWNfbGlua19zZW50Jywge1xuICAgICAgLi4ubWV0YWRhdGEsXG4gICAgICBlbWFpbCxcbiAgICAgIG1lc3NhZ2U6ICdNYWdpYyBsaW5rIHNlbnQgdG8gdXNlcidcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqIExvZyBtYWdpYyBsaW5rIHZlcmlmaWNhdGlvbiAoc3VjY2VzcyBvciBmYWlsdXJlKVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGxvZ01hZ2ljTGlua1ZlcmlmaWNhdGlvbihcbiAgICB1c2VySWQ6IHN0cmluZyB8IG51bGwsXG4gICAgc3VjY2VzczogYm9vbGVhbixcbiAgICBtZXRhZGF0YTogQXVkaXRMb2dNZXRhZGF0YVxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmxvZ0F1dGhFdmVudChcbiAgICAgIHVzZXJJZCxcbiAgICAgIHN1Y2Nlc3MgPyAnbWFnaWNfbGlua192ZXJpZmllZCcgOiAnbWFnaWNfbGlua19mYWlsZWQnLFxuICAgICAge1xuICAgICAgICAuLi5tZXRhZGF0YSxcbiAgICAgICAgbWVzc2FnZTogc3VjY2VzcyA/ICdNYWdpYyBsaW5rIHZlcmlmaWVkIHN1Y2Nlc3NmdWxseScgOiAnTWFnaWMgbGluayB2ZXJpZmljYXRpb24gZmFpbGVkJ1xuICAgICAgfVxuICAgIClcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgc3VzcGljaW91cyBhY3Rpdml0eSAoZS5nLiwgc2Vzc2lvbiBoaWphY2tpbmcgYXR0ZW1wdClcbiAgICovXG4gIHN0YXRpYyBhc3luYyBsb2dTdXNwaWNpb3VzQWN0aXZpdHkoXG4gICAgdXNlcklkOiBzdHJpbmcsXG4gICAgYWN0aXZpdHk6IHN0cmluZyxcbiAgICBtZXRhZGF0YTogQXVkaXRMb2dNZXRhZGF0YVxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmxvZ0F1dGhFdmVudCh1c2VySWQsICdzdXNwaWNpb3VzX2FjdGl2aXR5Jywge1xuICAgICAgLi4ubWV0YWRhdGEsXG4gICAgICBhY3Rpdml0eSxcbiAgICAgIHNldmVyaXR5OiAnaGlnaCcsXG4gICAgICBtZXNzYWdlOiBgU3VzcGljaW91cyBhY3Rpdml0eSBkZXRlY3RlZDogJHthY3Rpdml0eX1gXG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgc2Vzc2lvbiBoaWphY2sgYXR0ZW1wdFxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGxvZ1Nlc3Npb25IaWphY2tBdHRlbXB0KFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIG1ldGFkYXRhOiBBdWRpdExvZ01ldGFkYXRhXG4gICk6IFByb21pc2U8dm9pZD4ge1xuICAgIGF3YWl0IHRoaXMubG9nQXV0aEV2ZW50KHVzZXJJZCwgJ3Nlc3Npb25faGlqYWNrX2F0dGVtcHQnLCB7XG4gICAgICAuLi5tZXRhZGF0YSxcbiAgICAgIHNldmVyaXR5OiAnY3JpdGljYWwnLFxuICAgICAgbWVzc2FnZTogJ1Bvc3NpYmxlIHNlc3Npb24gaGlqYWNraW5nIGF0dGVtcHQgZGV0ZWN0ZWQnXG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiBMb2cgcmF0ZSBsaW1pdCBleGNlZWRlZFxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGxvZ1JhdGVMaW1pdEV4Y2VlZGVkKFxuICAgIGlkZW50aWZpZXI6IHN0cmluZyxcbiAgICBhY3Rpb246IHN0cmluZyxcbiAgICBtZXRhZGF0YTogQXVkaXRMb2dNZXRhZGF0YVxuICApOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBhd2FpdCB0aGlzLmxvZ0F1dGhFdmVudChudWxsLCAncmF0ZV9saW1pdF9leGNlZWRlZCcsIHtcbiAgICAgIC4uLm1ldGFkYXRhLFxuICAgICAgaWRlbnRpZmllcixcbiAgICAgIGFjdGlvbixcbiAgICAgIG1lc3NhZ2U6IGBSYXRlIGxpbWl0IGV4Y2VlZGVkIGZvciBhY3Rpb246ICR7YWN0aW9ufWBcbiAgICB9KVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCByZWNlbnQgbG9ncyBmb3IgYSB1c2VyIChmb3IgYWRtaW4vZGVidWdnaW5nKVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldFVzZXJMb2dzKFxuICAgIHVzZXJJZDogc3RyaW5nLFxuICAgIGxpbWl0OiBudW1iZXIgPSA1MFxuICApOiBQcm9taXNlPGFueVtdPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdhdWRpdF9sb2dzJylcbiAgICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAgIC5lcSgndXNlcl9pZCcsIHVzZXJJZClcbiAgICAgICAgLm9yZGVyKCdjcmVhdGVkX2F0JywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pXG4gICAgICAgIC5saW1pdChsaW1pdClcblxuICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyB1c2VyIGxvZ3M6JywgZXJyb3IpXG4gICAgICAgIHJldHVybiBbXVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gZGF0YSB8fCBbXVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgdXNlciBsb2dzOicsIGVycm9yKVxuICAgICAgcmV0dXJuIFtdXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIEdldCBzdXNwaWNpb3VzIGFjdGl2aXR5IGxvZ3MgKGZvciBzZWN1cml0eSBtb25pdG9yaW5nKVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGdldFN1c3BpY2lvdXNBY3Rpdml0eUxvZ3MobGltaXQ6IG51bWJlciA9IDEwMCk6IFByb21pc2U8YW55W10+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ2F1ZGl0X2xvZ3MnKVxuICAgICAgICAuc2VsZWN0KCcqJylcbiAgICAgICAgLmluKCdldmVudF90eXBlJywgWydzdXNwaWNpb3VzX2FjdGl2aXR5JywgJ3Nlc3Npb25faGlqYWNrX2F0dGVtcHQnLCAncmF0ZV9saW1pdF9leGNlZWRlZCddKVxuICAgICAgICAub3JkZXIoJ2NyZWF0ZWRfYXQnLCB7IGFzY2VuZGluZzogZmFsc2UgfSlcbiAgICAgICAgLmxpbWl0KGxpbWl0KVxuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGZldGNoaW5nIHN1c3BpY2lvdXMgYWN0aXZpdHkgbG9nczonLCBlcnJvcilcbiAgICAgICAgcmV0dXJuIFtdXG4gICAgICB9XG5cbiAgICAgIHJldHVybiBkYXRhIHx8IFtdXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyBzdXNwaWNpb3VzIGFjdGl2aXR5IGxvZ3M6JywgZXJyb3IpXG4gICAgICByZXR1cm4gW11cbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQXJjaGl2ZSBvbGQgbG9ncyAoZm9yIEhJUEFBIGNvbXBsaWFuY2UgLSByZXRhaW4gZm9yIHJlcXVpcmVkIHBlcmlvZClcbiAgICogU2hvdWxkIGJlIHJ1biB2aWEgY3JvbiBqb2JcbiAgICovXG4gIHN0YXRpYyBhc3luYyBhcmNoaXZlT2xkTG9ncyhkYXlzVG9SZXRhaW46IG51bWJlciA9IDkwKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3QgY3V0b2ZmRGF0ZSA9IG5ldyBEYXRlKERhdGUubm93KCkgLSBkYXlzVG9SZXRhaW4gKiAyNCAqIDYwICogNjAgKiAxMDAwKVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIEluIHByb2R1Y3Rpb24sIHlvdSdkIG1vdmUgdGhlc2UgdG8gY29sZCBzdG9yYWdlIHJhdGhlciB0aGFuIGRlbGV0ZVxuICAgICAgLy8gRm9yIG5vdywgd2UnbGwganVzdCBtYXJrIHRoZW0gYXMgYXJjaGl2ZWRcbiAgICAgIGNvbnN0IHsgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdhdWRpdF9sb2dzJylcbiAgICAgICAgLnVwZGF0ZSh7IGFyY2hpdmVkOiB0cnVlIH0pXG4gICAgICAgIC5sdCgnY3JlYXRlZF9hdCcsIGN1dG9mZkRhdGUudG9JU09TdHJpbmcoKSlcbiAgICAgICAgLmVxKCdhcmNoaXZlZCcsIGZhbHNlKVxuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEF1ZGl0IGxvZyBhcmNoaXZhbCBlcnJvcjonLCBlcnJvcilcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGDinIUgQXJjaGl2ZWQgYXVkaXQgbG9ncyBvbGRlciB0aGFuICR7ZGF5c1RvUmV0YWlufSBkYXlzYClcbiAgICAgIH1cbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEF1ZGl0IGxvZyBhcmNoaXZhbCBmYWlsZWQ6JywgZXJyb3IpXG4gICAgfVxuICB9XG59XG5cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiQXVkaXRMb2dnZXIiLCJsb2dBdXRoRXZlbnQiLCJ1c2VySWQiLCJldmVudFR5cGUiLCJtZXRhZGF0YSIsImxvZ0VudHJ5IiwidXNlcl9pZCIsImV2ZW50X3R5cGUiLCJpcF9hZGRyZXNzIiwidXNlcl9hZ2VudCIsImRldmljZV9maW5nZXJwcmludCIsInNlc3Npb25faWQiLCJjcmVhdGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwiZXJyb3IiLCJmcm9tIiwiaW5zZXJ0IiwiY29uc29sZSIsImxvZyIsImxvZ0xvZ2luU3VjY2VzcyIsIm1lc3NhZ2UiLCJsb2dMb2dpbkZhaWx1cmUiLCJlbWFpbCIsInJlYXNvbiIsImVycm9yX21lc3NhZ2UiLCJsb2dMb2dvdXQiLCJsb2dTZXNzaW9uUmVmcmVzaCIsImxvZ01hZ2ljTGlua1NlbnQiLCJsb2dNYWdpY0xpbmtWZXJpZmljYXRpb24iLCJzdWNjZXNzIiwibG9nU3VzcGljaW91c0FjdGl2aXR5IiwiYWN0aXZpdHkiLCJzZXZlcml0eSIsImxvZ1Nlc3Npb25IaWphY2tBdHRlbXB0IiwibG9nUmF0ZUxpbWl0RXhjZWVkZWQiLCJpZGVudGlmaWVyIiwiYWN0aW9uIiwiZ2V0VXNlckxvZ3MiLCJsaW1pdCIsImRhdGEiLCJzZWxlY3QiLCJlcSIsIm9yZGVyIiwiYXNjZW5kaW5nIiwiZ2V0U3VzcGljaW91c0FjdGl2aXR5TG9ncyIsImluIiwiYXJjaGl2ZU9sZExvZ3MiLCJkYXlzVG9SZXRhaW4iLCJjdXRvZmZEYXRlIiwibm93IiwidXBkYXRlIiwiYXJjaGl2ZWQiLCJsdCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/audit-logger.ts\n");

/***/ }),

/***/ "(rsc)/./lib/auth.ts":
/*!*********************!*\
  !*** ./lib/auth.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createMagicLink: () => (/* binding */ createMagicLink),\n/* harmony export */   createMagicLinkForAuthType: () => (/* binding */ createMagicLinkForAuthType),\n/* harmony export */   verifyMagicLink: () => (/* binding */ verifyMagicLink),\n/* harmony export */   verifyMagicLinkForAuthType: () => (/* binding */ verifyMagicLinkForAuthType)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! crypto */ \"crypto\");\n/* harmony import */ var crypto__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(crypto__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _email__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./email */ \"(rsc)/./lib/email.ts\");\n/* harmony import */ var _supabase_auth_sync__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! ./supabase-auth-sync */ \"(rsc)/./lib/supabase-auth-sync.ts\");\n/* harmony import */ var _rate_limit__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./rate-limit */ \"(rsc)/./lib/rate-limit.ts\");\n/* harmony import */ var _audit_logger__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ./audit-logger */ \"(rsc)/./lib/audit-logger.ts\");\n\n\n\n\n\n\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_5__.createClient)(\"https://frzciymslvpohhyefmtr.supabase.co\" || 0, process.env.SUPABASE_SERVICE_ROLE_KEY || '');\n/**\n * Get magic link expiry based on user email domain\n * Healthcare workers get 15 minutes for security\n * Regular users get 24 hours for convenience\n */ function getMagicLinkExpiry(email) {\n    const healthcareDomains = [\n        '@clinic.',\n        '@hospital.',\n        '@health.',\n        '@medical.',\n        '.med',\n        '.health'\n    ];\n    const isHealthcareUser = healthcareDomains.some((domain)=>email.toLowerCase().includes(domain));\n    if (isHealthcareUser) {\n        console.log('üè• Healthcare user detected, using 15-minute magic link expiry');\n        return 15 * 60 * 1000 // 15 minutes for healthcare workers\n        ;\n    }\n    console.log('üë§ Regular user, using 24-hour magic link expiry');\n    return 24 * 60 * 60 * 1000 // 24 hours for regular users\n    ;\n}\n// Unified function to create magic link for any auth type\nasync function createMagicLinkForAuthType(email, authType, type = 'login', metadata) {\n    console.log('üîë createMagicLinkForAuthType called:', {\n        email,\n        authType,\n        type,\n        metadata\n    });\n    try {\n        // Rate limiting check - 10 magic links per hour per email\n        const rateLimitAllowed = await _rate_limit__WEBPACK_IMPORTED_MODULE_3__.RateLimiter.checkMagicLinkRequest(email);\n        if (!rateLimitAllowed) {\n            console.warn('‚ö†Ô∏è Rate limit exceeded for magic link request:', email);\n            await _audit_logger__WEBPACK_IMPORTED_MODULE_4__.AuditLogger.logRateLimitExceeded(email, 'magic_link_request', {\n                email,\n                authType,\n                type\n            });\n            return {\n                success: false,\n                error: 'Too many requests. Please try again in an hour.'\n            };\n        }\n        const token = (0,crypto__WEBPACK_IMPORTED_MODULE_0__.randomUUID)();\n        const expiryDuration = getMagicLinkExpiry(email);\n        const expiresAt = new Date(Date.now() + expiryDuration);\n        console.log('‚úÖ Token created:', {\n            token: token.substring(0, 8) + '...',\n            expiresAt: expiresAt.toISOString(),\n            now: new Date().toISOString()\n        });\n        const { error } = await supabase.from('magic_links').insert({\n            email,\n            token,\n            type,\n            auth_type: authType,\n            expires_at: expiresAt.toISOString(),\n            metadata: {\n                ...metadata,\n                auth_type: authType\n            }\n        });\n        if (error) {\n            console.error('‚ùå Error creating magic link:', error);\n            throw error;\n        }\n        console.log('‚úÖ Magic link created successfully for auth type:', authType);\n        // Send the magic link email\n        const baseUrl = \"http://localhost:3000\" || 0;\n        const verificationUrl = `${baseUrl}/api/auth/verify-magic-link?token=${token}&auth_type=${authType}`;\n        console.log('üìß Sending magic link email...');\n        const emailResult = await (0,_email__WEBPACK_IMPORTED_MODULE_1__.sendMagicLinkEmail)(email, verificationUrl, type, {\n            ...metadata,\n            auth_type: authType\n        });\n        if (!emailResult.success) {\n            console.error('‚ùå Failed to send magic link email:', emailResult.error);\n            // Don't fail the entire request if email fails, just log it\n            console.log('‚ö†Ô∏è Magic link created but email failed to send. Token:', token.substring(0, 8) + '...');\n        } else {\n            console.log('‚úÖ Magic link email sent successfully');\n            // Audit log: Magic link sent\n            await _audit_logger__WEBPACK_IMPORTED_MODULE_4__.AuditLogger.logMagicLinkSent(email, {\n                email,\n                authType,\n                type,\n                expiryDuration: expiryDuration / 1000 / 60,\n                expiresAt: expiresAt.toISOString()\n            });\n        }\n        return {\n            success: true,\n            token\n        };\n    } catch (error) {\n        console.error('‚ùå createMagicLinkForAuthType error:', error);\n        return {\n            success: false,\n            error: 'Failed to create magic link'\n        };\n    }\n}\n// Unified function to verify magic link for any auth type\nasync function verifyMagicLinkForAuthType(token, authType) {\n    console.log('üîç verifyMagicLinkForAuthType called with token:', token.substring(0, 8) + '...', 'authType:', authType);\n    try {\n        // Rate limiting check - 3 attempts per token\n        const rateLimitAllowed = await _rate_limit__WEBPACK_IMPORTED_MODULE_3__.RateLimiter.checkMagicLinkVerification(token);\n        if (!rateLimitAllowed) {\n            console.warn('‚ö†Ô∏è Rate limit exceeded for magic link verification');\n            await _audit_logger__WEBPACK_IMPORTED_MODULE_4__.AuditLogger.logRateLimitExceeded(token, 'magic_link_verify', {\n                token: token.substring(0, 8) + '...',\n                authType\n            });\n            return {\n                success: false,\n                error: 'Too many verification attempts. Please request a new magic link.'\n            };\n        }\n        // Find the magic link\n        console.log('üîç Looking up magic link in database...');\n        const { data: magicLink, error: magicLinkError } = await supabase.from('magic_links').select('*').eq('token', token).eq('auth_type', authType).is('used_at', null).single();\n        if (magicLinkError) {\n            console.error('‚ùå Magic link lookup error:', magicLinkError);\n            await _audit_logger__WEBPACK_IMPORTED_MODULE_4__.AuditLogger.logMagicLinkVerification(null, false, {\n                token: token.substring(0, 8) + '...',\n                authType,\n                error_message: 'Database lookup error'\n            });\n            return {\n                success: false,\n                error: 'Invalid or expired magic link'\n            };\n        }\n        if (!magicLink) {\n            console.log('‚ùå Magic link not found or already used');\n            await _audit_logger__WEBPACK_IMPORTED_MODULE_4__.AuditLogger.logMagicLinkVerification(null, false, {\n                token: token.substring(0, 8) + '...',\n                authType,\n                error_message: 'Magic link not found or already used'\n            });\n            return {\n                success: false,\n                error: 'Invalid or expired magic link'\n            };\n        }\n        console.log('‚úÖ Magic link found:', {\n            id: magicLink.id,\n            email: magicLink.email,\n            type: magicLink.type,\n            auth_type: magicLink.auth_type,\n            expiresAt: magicLink.expires_at\n        });\n        // Check if expired\n        const now = new Date();\n        const expiresAt = new Date(magicLink.expires_at);\n        if (expiresAt < now) {\n            console.log('‚ùå Magic link expired');\n            return {\n                success: false,\n                error: 'Magic link has expired. Please request a new one.'\n            };\n        }\n        // Mark magic link as used with atomic update to prevent race condition\n        // This ensures only ONE request can mark it as used\n        const { data: updatedLink, error: updateError } = await supabase.from('magic_links').update({\n            used_at: now.toISOString(),\n            updated_at: now.toISOString()\n        }).eq('id', magicLink.id).is('used_at', null) // Critical: Only update if still unused\n        .select().single();\n        if (updateError || !updatedLink) {\n            console.error('‚ùå Magic link already used or update failed:', updateError);\n            return {\n                success: false,\n                error: 'Magic link already used or expired. Please request a new one.'\n            };\n        }\n        console.log('‚úÖ Magic link marked as used atomically');\n        // Get or create user\n        console.log('üîç Getting or creating user...');\n        const { data: user, error: userError } = await supabase.from('users').select('*').eq('email', magicLink.email).single();\n        if (userError && userError.code !== 'PGRST116') {\n            console.error('‚ùå Error getting user:', userError);\n            return {\n                success: false,\n                error: 'Error accessing user account'\n            };\n        }\n        let finalUser = user;\n        // If user doesn't exist and this is a signup, create them\n        if (!user && magicLink.type === 'signup') {\n            console.log('üë§ Creating new user with Supabase Auth sync...');\n            const createResult = await (0,_supabase_auth_sync__WEBPACK_IMPORTED_MODULE_2__.createUserWithSupabaseAuth)({\n                email: magicLink.email,\n                full_name: magicLink.metadata?.first_name || magicLink.email.split('@')[0],\n                user_type: authType\n            });\n            if (!createResult.success) {\n                console.error('‚ùå Error creating user with Supabase Auth sync:', createResult.error);\n                return {\n                    success: false,\n                    error: 'Error creating user account'\n                };\n            }\n            // Get the created user from database\n            const { data: newUser, error: fetchError } = await supabase.from('users').select('*').eq('id', createResult.user_id).single();\n            if (fetchError || !newUser) {\n                console.error('‚ùå Error fetching newly created user:', fetchError);\n                return {\n                    success: false,\n                    error: 'Error accessing new user account'\n                };\n            }\n            finalUser = newUser;\n            console.log('‚úÖ New user created with Supabase Auth sync:', finalUser.id);\n        } else if (!user && magicLink.type === 'login') {\n            console.log('‚ùå User not found for login');\n            return {\n                success: false,\n                error: 'User account not found. Please sign up first.'\n            };\n        } else if (user && magicLink.type === 'login') {\n            console.log('‚úÖ Existing user found for login:', user.email);\n            // Verify user type matches\n            if (user.user_type !== authType) {\n                console.log('‚ùå User type mismatch:', user.user_type, 'vs', authType);\n                return {\n                    success: false,\n                    error: 'Invalid user type for this login'\n                };\n            }\n        }\n        // Create session token and store in database\n        console.log('üîë Creating session token and storing in database...');\n        const sessionToken = (0,crypto__WEBPACK_IMPORTED_MODULE_0__.randomUUID)();\n        const sessionExpiresAt = new Date(Date.now() + 7 * 24 * 60 * 60 * 1000) // 7 days\n        ;\n        // Clear any existing sessions for this user\n        await supabase.from('user_sessions').delete().eq('user_id', finalUser.id);\n        // Create new session in database\n        const { error: sessionError } = await supabase.from('user_sessions').insert({\n            user_id: finalUser.id,\n            session_token: sessionToken,\n            expires_at: sessionExpiresAt.toISOString(),\n            created_at: now.toISOString(),\n            last_accessed_at: now.toISOString()\n        });\n        if (sessionError) {\n            console.error('‚ùå Error creating session:', sessionError);\n            return {\n                success: false,\n                error: 'Error creating session'\n            };\n        }\n        console.log('‚úÖ Session created and stored in database');\n        // Update user's last login and mark as verified\n        await supabase.from('users').update({\n            last_login_at: now.toISOString(),\n            is_verified: true // Mark user as verified after successful magic link verification\n        }).eq('id', finalUser.id);\n        // Audit log: Successful magic link verification\n        await _audit_logger__WEBPACK_IMPORTED_MODULE_4__.AuditLogger.logMagicLinkVerification(finalUser.id, true, {\n            email: finalUser.email,\n            authType,\n            magicLinkType: magicLink.type\n        });\n        // Audit log: Login success\n        await _audit_logger__WEBPACK_IMPORTED_MODULE_4__.AuditLogger.logLoginSuccess(finalUser.id, {\n            email: finalUser.email,\n            authType,\n            loginMethod: 'magic_link'\n        });\n        return {\n            success: true,\n            user: {\n                ...finalUser,\n                is_verified: true,\n                session_token: sessionToken\n            }\n        };\n    } catch (error) {\n        console.error('‚ùå verifyMagicLinkForAuthType error:', error);\n        return {\n            success: false,\n            error: 'Internal server error'\n        };\n    }\n}\n// Legacy functions for backward compatibility\nasync function createMagicLink(email, type, metadata) {\n    return createMagicLinkForAuthType(email, 'individual', type, metadata);\n}\nasync function verifyMagicLink(token) {\n    return verifyMagicLinkForAuthType(token, 'individual');\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNqQjtRQUNGO0lBRUYsRUFBRSxPQUFPOUMsT0FBTztRQUNkWCxRQUFRVyxLQUFLLENBQUMsdUNBQXVDQTtRQUNyRCxPQUFPO1lBQUVELFNBQVM7WUFBT0MsT0FBTztRQUF3QjtJQUMxRDtBQUNGO0FBRUEsOENBQThDO0FBQ3ZDLGVBQWUwRCxnQkFBZ0I1RSxLQUFhLEVBQUVXLElBQXdCLEVBQUVDLFFBQWM7SUFDM0YsT0FBT0gsMkJBQTJCVCxPQUFPLGNBQWNXLE1BQU1DO0FBQy9EO0FBRU8sZUFBZWlFLGdCQUFnQjFELEtBQWE7SUFDakQsT0FBT2dCLDJCQUEyQmhCLE9BQU87QUFDM0MiLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL0Rlc2t0b3AvdHJwaS1hcHAvbGliL2F1dGgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSAnQHN1cGFiYXNlL3N1cGFiYXNlLWpzJztcbmltcG9ydCB7IHJhbmRvbVVVSUQgfSBmcm9tICdjcnlwdG8nO1xuaW1wb3J0IHsgc2VuZE1hZ2ljTGlua0VtYWlsIH0gZnJvbSAnLi9lbWFpbCc7XG5pbXBvcnQgeyBzeW5jVXNlclRvU3VwYWJhc2VBdXRoLCBjcmVhdGVVc2VyV2l0aFN1cGFiYXNlQXV0aCB9IGZyb20gJy4vc3VwYWJhc2UtYXV0aC1zeW5jJztcbmltcG9ydCB7IFJhdGVMaW1pdGVyIH0gZnJvbSAnLi9yYXRlLWxpbWl0JztcbmltcG9ydCB7IEF1ZGl0TG9nZ2VyIH0gZnJvbSAnLi9hdWRpdC1sb2dnZXInO1xuXG5jb25zdCBzdXBhYmFzZSA9IGNyZWF0ZUNsaWVudChcbiAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIHx8ICcnLFxuICBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIHx8ICcnXG4pO1xuXG5leHBvcnQgaW50ZXJmYWNlIE1hZ2ljTGlua0RhdGEge1xuICBlbWFpbDogc3RyaW5nO1xuICB0eXBlOiAnYm9va2luZycgfCAnbG9naW4nIHwgJ3NpZ251cCc7XG4gIGF1dGhfdHlwZT86ICdpbmRpdmlkdWFsJyB8ICd0aGVyYXBpc3QnIHwgJ3BhcnRuZXInIHwgJ2FkbWluJztcbiAgbWV0YWRhdGE/OiB7XG4gICAgZmlyc3RfbmFtZT86IHN0cmluZztcbiAgICB1c2VyX3R5cGU/OiBzdHJpbmc7XG4gICAgW2tleTogc3RyaW5nXTogYW55O1xuICB9O1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIFNlc3Npb25EYXRhIHtcbiAgdXNlcl9pZDogc3RyaW5nO1xuICBzZXNzaW9uX3Rva2VuOiBzdHJpbmc7XG4gIGV4cGlyZXNfYXQ6IERhdGU7XG4gIHVzZXJfYWdlbnQ/OiBzdHJpbmc7XG4gIGlwX2FkZHJlc3M/OiBzdHJpbmc7XG59XG5cbi8qKlxuICogR2V0IG1hZ2ljIGxpbmsgZXhwaXJ5IGJhc2VkIG9uIHVzZXIgZW1haWwgZG9tYWluXG4gKiBIZWFsdGhjYXJlIHdvcmtlcnMgZ2V0IDE1IG1pbnV0ZXMgZm9yIHNlY3VyaXR5XG4gKiBSZWd1bGFyIHVzZXJzIGdldCAyNCBob3VycyBmb3IgY29udmVuaWVuY2VcbiAqL1xuZnVuY3Rpb24gZ2V0TWFnaWNMaW5rRXhwaXJ5KGVtYWlsOiBzdHJpbmcpOiBudW1iZXIge1xuICBjb25zdCBoZWFsdGhjYXJlRG9tYWlucyA9IFsnQGNsaW5pYy4nLCAnQGhvc3BpdGFsLicsICdAaGVhbHRoLicsICdAbWVkaWNhbC4nLCAnLm1lZCcsICcuaGVhbHRoJ11cbiAgY29uc3QgaXNIZWFsdGhjYXJlVXNlciA9IGhlYWx0aGNhcmVEb21haW5zLnNvbWUoZG9tYWluID0+IGVtYWlsLnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoZG9tYWluKSlcbiAgXG4gIGlmIChpc0hlYWx0aGNhcmVVc2VyKSB7XG4gICAgY29uc29sZS5sb2coJ/Cfj6UgSGVhbHRoY2FyZSB1c2VyIGRldGVjdGVkLCB1c2luZyAxNS1taW51dGUgbWFnaWMgbGluayBleHBpcnknKVxuICAgIHJldHVybiAxNSAqIDYwICogMTAwMCAvLyAxNSBtaW51dGVzIGZvciBoZWFsdGhjYXJlIHdvcmtlcnNcbiAgfVxuICBcbiAgY29uc29sZS5sb2coJ/CfkaQgUmVndWxhciB1c2VyLCB1c2luZyAyNC1ob3VyIG1hZ2ljIGxpbmsgZXhwaXJ5JylcbiAgcmV0dXJuIDI0ICogNjAgKiA2MCAqIDEwMDAgLy8gMjQgaG91cnMgZm9yIHJlZ3VsYXIgdXNlcnNcbn1cblxuLy8gVW5pZmllZCBmdW5jdGlvbiB0byBjcmVhdGUgbWFnaWMgbGluayBmb3IgYW55IGF1dGggdHlwZVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZU1hZ2ljTGlua0ZvckF1dGhUeXBlKFxuICBlbWFpbDogc3RyaW5nLCBcbiAgYXV0aFR5cGU6ICdpbmRpdmlkdWFsJyB8ICd0aGVyYXBpc3QnIHwgJ3BhcnRuZXInIHwgJ2FkbWluJyxcbiAgdHlwZTogJ2xvZ2luJyB8ICdzaWdudXAnID0gJ2xvZ2luJyxcbiAgbWV0YWRhdGE/OiBhbnlcbikge1xuICBjb25zb2xlLmxvZygn8J+UkSBjcmVhdGVNYWdpY0xpbmtGb3JBdXRoVHlwZSBjYWxsZWQ6JywgeyBlbWFpbCwgYXV0aFR5cGUsIHR5cGUsIG1ldGFkYXRhIH0pXG4gIFxuICB0cnkge1xuICAgIC8vIFJhdGUgbGltaXRpbmcgY2hlY2sgLSAxMCBtYWdpYyBsaW5rcyBwZXIgaG91ciBwZXIgZW1haWxcbiAgICBjb25zdCByYXRlTGltaXRBbGxvd2VkID0gYXdhaXQgUmF0ZUxpbWl0ZXIuY2hlY2tNYWdpY0xpbmtSZXF1ZXN0KGVtYWlsKVxuICAgIGlmICghcmF0ZUxpbWl0QWxsb3dlZCkge1xuICAgICAgY29uc29sZS53YXJuKCfimqDvuI8gUmF0ZSBsaW1pdCBleGNlZWRlZCBmb3IgbWFnaWMgbGluayByZXF1ZXN0OicsIGVtYWlsKVxuICAgICAgYXdhaXQgQXVkaXRMb2dnZXIubG9nUmF0ZUxpbWl0RXhjZWVkZWQoZW1haWwsICdtYWdpY19saW5rX3JlcXVlc3QnLCB7XG4gICAgICAgIGVtYWlsLFxuICAgICAgICBhdXRoVHlwZSxcbiAgICAgICAgdHlwZVxuICAgICAgfSlcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1RvbyBtYW55IHJlcXVlc3RzLiBQbGVhc2UgdHJ5IGFnYWluIGluIGFuIGhvdXIuJyB9XG4gICAgfVxuXG4gICAgY29uc3QgdG9rZW4gPSByYW5kb21VVUlEKClcbiAgICBjb25zdCBleHBpcnlEdXJhdGlvbiA9IGdldE1hZ2ljTGlua0V4cGlyeShlbWFpbClcbiAgICBjb25zdCBleHBpcmVzQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgZXhwaXJ5RHVyYXRpb24pXG5cbiAgICBjb25zb2xlLmxvZygn4pyFIFRva2VuIGNyZWF0ZWQ6JywgeyBcbiAgICAgIHRva2VuOiB0b2tlbi5zdWJzdHJpbmcoMCwgOCkgKyAnLi4uJywgXG4gICAgICBleHBpcmVzQXQ6IGV4cGlyZXNBdC50b0lTT1N0cmluZygpLFxuICAgICAgbm93OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKClcbiAgICB9KVxuXG4gICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdtYWdpY19saW5rcycpXG4gICAgICAuaW5zZXJ0KHtcbiAgICAgICAgZW1haWwsXG4gICAgICAgIHRva2VuLFxuICAgICAgICB0eXBlLFxuICAgICAgICBhdXRoX3R5cGU6IGF1dGhUeXBlLFxuICAgICAgICBleHBpcmVzX2F0OiBleHBpcmVzQXQudG9JU09TdHJpbmcoKSxcbiAgICAgICAgbWV0YWRhdGE6IHsgLi4ubWV0YWRhdGEsIGF1dGhfdHlwZTogYXV0aFR5cGUgfVxuICAgICAgfSlcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGNyZWF0aW5nIG1hZ2ljIGxpbms6JywgZXJyb3IpXG4gICAgICB0aHJvdyBlcnJvclxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCfinIUgTWFnaWMgbGluayBjcmVhdGVkIHN1Y2Nlc3NmdWxseSBmb3IgYXV0aCB0eXBlOicsIGF1dGhUeXBlKVxuXG4gICAgLy8gU2VuZCB0aGUgbWFnaWMgbGluayBlbWFpbFxuICAgIGNvbnN0IGJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BUFBfVVJMIHx8ICdodHRwOi8vbG9jYWxob3N0OjMwMDAnXG4gICAgY29uc3QgdmVyaWZpY2F0aW9uVXJsID0gYCR7YmFzZVVybH0vYXBpL2F1dGgvdmVyaWZ5LW1hZ2ljLWxpbms/dG9rZW49JHt0b2tlbn0mYXV0aF90eXBlPSR7YXV0aFR5cGV9YFxuICAgIFxuICAgIGNvbnNvbGUubG9nKCfwn5OnIFNlbmRpbmcgbWFnaWMgbGluayBlbWFpbC4uLicpXG4gICAgY29uc3QgZW1haWxSZXN1bHQgPSBhd2FpdCBzZW5kTWFnaWNMaW5rRW1haWwoZW1haWwsIHZlcmlmaWNhdGlvblVybCwgdHlwZSwgeyAuLi5tZXRhZGF0YSwgYXV0aF90eXBlOiBhdXRoVHlwZSB9KVxuICAgIFxuICAgIGlmICghZW1haWxSZXN1bHQuc3VjY2Vzcykge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEZhaWxlZCB0byBzZW5kIG1hZ2ljIGxpbmsgZW1haWw6JywgZW1haWxSZXN1bHQuZXJyb3IpXG4gICAgICAvLyBEb24ndCBmYWlsIHRoZSBlbnRpcmUgcmVxdWVzdCBpZiBlbWFpbCBmYWlscywganVzdCBsb2cgaXRcbiAgICAgIGNvbnNvbGUubG9nKCfimqDvuI8gTWFnaWMgbGluayBjcmVhdGVkIGJ1dCBlbWFpbCBmYWlsZWQgdG8gc2VuZC4gVG9rZW46JywgdG9rZW4uc3Vic3RyaW5nKDAsIDgpICsgJy4uLicpXG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgTWFnaWMgbGluayBlbWFpbCBzZW50IHN1Y2Nlc3NmdWxseScpXG4gICAgICBcbiAgICAgIC8vIEF1ZGl0IGxvZzogTWFnaWMgbGluayBzZW50XG4gICAgICBhd2FpdCBBdWRpdExvZ2dlci5sb2dNYWdpY0xpbmtTZW50KGVtYWlsLCB7XG4gICAgICAgIGVtYWlsLFxuICAgICAgICBhdXRoVHlwZSxcbiAgICAgICAgdHlwZSxcbiAgICAgICAgZXhwaXJ5RHVyYXRpb246IGV4cGlyeUR1cmF0aW9uIC8gMTAwMCAvIDYwLCAvLyBtaW51dGVzXG4gICAgICAgIGV4cGlyZXNBdDogZXhwaXJlc0F0LnRvSVNPU3RyaW5nKClcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgdG9rZW4gfVxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBjcmVhdGVNYWdpY0xpbmtGb3JBdXRoVHlwZSBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGYWlsZWQgdG8gY3JlYXRlIG1hZ2ljIGxpbmsnIH1cbiAgfVxufVxuXG4vLyBVbmlmaWVkIGZ1bmN0aW9uIHRvIHZlcmlmeSBtYWdpYyBsaW5rIGZvciBhbnkgYXV0aCB0eXBlXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5TWFnaWNMaW5rRm9yQXV0aFR5cGUodG9rZW46IHN0cmluZywgYXV0aFR5cGU6ICdpbmRpdmlkdWFsJyB8ICd0aGVyYXBpc3QnIHwgJ3BhcnRuZXInIHwgJ2FkbWluJykge1xuICBjb25zb2xlLmxvZygn8J+UjSB2ZXJpZnlNYWdpY0xpbmtGb3JBdXRoVHlwZSBjYWxsZWQgd2l0aCB0b2tlbjonLCB0b2tlbi5zdWJzdHJpbmcoMCwgOCkgKyAnLi4uJywgJ2F1dGhUeXBlOicsIGF1dGhUeXBlKVxuICBcbiAgdHJ5IHtcbiAgICAvLyBSYXRlIGxpbWl0aW5nIGNoZWNrIC0gMyBhdHRlbXB0cyBwZXIgdG9rZW5cbiAgICBjb25zdCByYXRlTGltaXRBbGxvd2VkID0gYXdhaXQgUmF0ZUxpbWl0ZXIuY2hlY2tNYWdpY0xpbmtWZXJpZmljYXRpb24odG9rZW4pXG4gICAgaWYgKCFyYXRlTGltaXRBbGxvd2VkKSB7XG4gICAgICBjb25zb2xlLndhcm4oJ+KaoO+4jyBSYXRlIGxpbWl0IGV4Y2VlZGVkIGZvciBtYWdpYyBsaW5rIHZlcmlmaWNhdGlvbicpXG4gICAgICBhd2FpdCBBdWRpdExvZ2dlci5sb2dSYXRlTGltaXRFeGNlZWRlZCh0b2tlbiwgJ21hZ2ljX2xpbmtfdmVyaWZ5Jywge1xuICAgICAgICB0b2tlbjogdG9rZW4uc3Vic3RyaW5nKDAsIDgpICsgJy4uLicsXG4gICAgICAgIGF1dGhUeXBlXG4gICAgICB9KVxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVG9vIG1hbnkgdmVyaWZpY2F0aW9uIGF0dGVtcHRzLiBQbGVhc2UgcmVxdWVzdCBhIG5ldyBtYWdpYyBsaW5rLicgfVxuICAgIH1cblxuICAgIC8vIEZpbmQgdGhlIG1hZ2ljIGxpbmtcbiAgICBjb25zb2xlLmxvZygn8J+UjSBMb29raW5nIHVwIG1hZ2ljIGxpbmsgaW4gZGF0YWJhc2UuLi4nKVxuICAgIGNvbnN0IHsgZGF0YTogbWFnaWNMaW5rLCBlcnJvcjogbWFnaWNMaW5rRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnbWFnaWNfbGlua3MnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ3Rva2VuJywgdG9rZW4pXG4gICAgICAuZXEoJ2F1dGhfdHlwZScsIGF1dGhUeXBlKVxuICAgICAgLmlzKCd1c2VkX2F0JywgbnVsbClcbiAgICAgIC5zaW5nbGUoKVxuXG4gICAgaWYgKG1hZ2ljTGlua0Vycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgTWFnaWMgbGluayBsb29rdXAgZXJyb3I6JywgbWFnaWNMaW5rRXJyb3IpXG4gICAgICBhd2FpdCBBdWRpdExvZ2dlci5sb2dNYWdpY0xpbmtWZXJpZmljYXRpb24obnVsbCwgZmFsc2UsIHtcbiAgICAgICAgdG9rZW46IHRva2VuLnN1YnN0cmluZygwLCA4KSArICcuLi4nLFxuICAgICAgICBhdXRoVHlwZSxcbiAgICAgICAgZXJyb3JfbWVzc2FnZTogJ0RhdGFiYXNlIGxvb2t1cCBlcnJvcidcbiAgICAgIH0pXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIG9yIGV4cGlyZWQgbWFnaWMgbGluaycgfVxuICAgIH1cblxuICAgIGlmICghbWFnaWNMaW5rKSB7XG4gICAgICBjb25zb2xlLmxvZygn4p2MIE1hZ2ljIGxpbmsgbm90IGZvdW5kIG9yIGFscmVhZHkgdXNlZCcpXG4gICAgICBhd2FpdCBBdWRpdExvZ2dlci5sb2dNYWdpY0xpbmtWZXJpZmljYXRpb24obnVsbCwgZmFsc2UsIHtcbiAgICAgICAgdG9rZW46IHRva2VuLnN1YnN0cmluZygwLCA4KSArICcuLi4nLFxuICAgICAgICBhdXRoVHlwZSxcbiAgICAgICAgZXJyb3JfbWVzc2FnZTogJ01hZ2ljIGxpbmsgbm90IGZvdW5kIG9yIGFscmVhZHkgdXNlZCdcbiAgICAgIH0pXG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIG9yIGV4cGlyZWQgbWFnaWMgbGluaycgfVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCfinIUgTWFnaWMgbGluayBmb3VuZDonLCB7XG4gICAgICBpZDogbWFnaWNMaW5rLmlkLFxuICAgICAgZW1haWw6IG1hZ2ljTGluay5lbWFpbCxcbiAgICAgIHR5cGU6IG1hZ2ljTGluay50eXBlLFxuICAgICAgYXV0aF90eXBlOiBtYWdpY0xpbmsuYXV0aF90eXBlLFxuICAgICAgZXhwaXJlc0F0OiBtYWdpY0xpbmsuZXhwaXJlc19hdFxuICAgIH0pXG5cbiAgICAvLyBDaGVjayBpZiBleHBpcmVkXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKVxuICAgIGNvbnN0IGV4cGlyZXNBdCA9IG5ldyBEYXRlKG1hZ2ljTGluay5leHBpcmVzX2F0KVxuICAgIFxuICAgIGlmIChleHBpcmVzQXQgPCBub3cpIHtcbiAgICAgIGNvbnNvbGUubG9nKCfinYwgTWFnaWMgbGluayBleHBpcmVkJylcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ01hZ2ljIGxpbmsgaGFzIGV4cGlyZWQuIFBsZWFzZSByZXF1ZXN0IGEgbmV3IG9uZS4nIH1cbiAgICB9XG5cbiAgICAvLyBNYXJrIG1hZ2ljIGxpbmsgYXMgdXNlZCB3aXRoIGF0b21pYyB1cGRhdGUgdG8gcHJldmVudCByYWNlIGNvbmRpdGlvblxuICAgIC8vIFRoaXMgZW5zdXJlcyBvbmx5IE9ORSByZXF1ZXN0IGNhbiBtYXJrIGl0IGFzIHVzZWRcbiAgICBjb25zdCB7IGRhdGE6IHVwZGF0ZWRMaW5rLCBlcnJvcjogdXBkYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgnbWFnaWNfbGlua3MnKVxuICAgICAgLnVwZGF0ZSh7IFxuICAgICAgICB1c2VkX2F0OiBub3cudG9JU09TdHJpbmcoKSxcbiAgICAgICAgdXBkYXRlZF9hdDogbm93LnRvSVNPU3RyaW5nKClcbiAgICAgIH0pXG4gICAgICAuZXEoJ2lkJywgbWFnaWNMaW5rLmlkKVxuICAgICAgLmlzKCd1c2VkX2F0JywgbnVsbCkgLy8gQ3JpdGljYWw6IE9ubHkgdXBkYXRlIGlmIHN0aWxsIHVudXNlZFxuICAgICAgLnNlbGVjdCgpXG4gICAgICAuc2luZ2xlKClcblxuICAgIGlmICh1cGRhdGVFcnJvciB8fCAhdXBkYXRlZExpbmspIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBNYWdpYyBsaW5rIGFscmVhZHkgdXNlZCBvciB1cGRhdGUgZmFpbGVkOicsIHVwZGF0ZUVycm9yKVxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnTWFnaWMgbGluayBhbHJlYWR5IHVzZWQgb3IgZXhwaXJlZC4gUGxlYXNlIHJlcXVlc3QgYSBuZXcgb25lLicgfVxuICAgIH1cbiAgICBcbiAgICBjb25zb2xlLmxvZygn4pyFIE1hZ2ljIGxpbmsgbWFya2VkIGFzIHVzZWQgYXRvbWljYWxseScpXG5cbiAgICAvLyBHZXQgb3IgY3JlYXRlIHVzZXJcbiAgICBjb25zb2xlLmxvZygn8J+UjSBHZXR0aW5nIG9yIGNyZWF0aW5nIHVzZXIuLi4nKVxuICAgIGNvbnN0IHsgZGF0YTogdXNlciwgZXJyb3I6IHVzZXJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5lcSgnZW1haWwnLCBtYWdpY0xpbmsuZW1haWwpXG4gICAgICAuc2luZ2xlKClcblxuICAgIGlmICh1c2VyRXJyb3IgJiYgdXNlckVycm9yLmNvZGUgIT09ICdQR1JTVDExNicpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBnZXR0aW5nIHVzZXI6JywgdXNlckVycm9yKVxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRXJyb3IgYWNjZXNzaW5nIHVzZXIgYWNjb3VudCcgfVxuICAgIH1cblxuICAgIGxldCBmaW5hbFVzZXIgPSB1c2VyXG5cbiAgICAvLyBJZiB1c2VyIGRvZXNuJ3QgZXhpc3QgYW5kIHRoaXMgaXMgYSBzaWdudXAsIGNyZWF0ZSB0aGVtXG4gICAgaWYgKCF1c2VyICYmIG1hZ2ljTGluay50eXBlID09PSAnc2lnbnVwJykge1xuICAgICAgY29uc29sZS5sb2coJ/CfkaQgQ3JlYXRpbmcgbmV3IHVzZXIgd2l0aCBTdXBhYmFzZSBBdXRoIHN5bmMuLi4nKVxuICAgICAgXG4gICAgICBjb25zdCBjcmVhdGVSZXN1bHQgPSBhd2FpdCBjcmVhdGVVc2VyV2l0aFN1cGFiYXNlQXV0aCh7XG4gICAgICAgIGVtYWlsOiBtYWdpY0xpbmsuZW1haWwsXG4gICAgICAgIGZ1bGxfbmFtZTogbWFnaWNMaW5rLm1ldGFkYXRhPy5maXJzdF9uYW1lIHx8IG1hZ2ljTGluay5lbWFpbC5zcGxpdCgnQCcpWzBdLFxuICAgICAgICB1c2VyX3R5cGU6IGF1dGhUeXBlXG4gICAgICB9KVxuXG4gICAgICBpZiAoIWNyZWF0ZVJlc3VsdC5zdWNjZXNzKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBjcmVhdGluZyB1c2VyIHdpdGggU3VwYWJhc2UgQXV0aCBzeW5jOicsIGNyZWF0ZVJlc3VsdC5lcnJvcilcbiAgICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRXJyb3IgY3JlYXRpbmcgdXNlciBhY2NvdW50JyB9XG4gICAgICB9XG5cbiAgICAgIC8vIEdldCB0aGUgY3JlYXRlZCB1c2VyIGZyb20gZGF0YWJhc2VcbiAgICAgIGNvbnN0IHsgZGF0YTogbmV3VXNlciwgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgICAuZXEoJ2lkJywgY3JlYXRlUmVzdWx0LnVzZXJfaWQpXG4gICAgICAgIC5zaW5nbGUoKVxuXG4gICAgICBpZiAoZmV0Y2hFcnJvciB8fCAhbmV3VXNlcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgZmV0Y2hpbmcgbmV3bHkgY3JlYXRlZCB1c2VyOicsIGZldGNoRXJyb3IpXG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0Vycm9yIGFjY2Vzc2luZyBuZXcgdXNlciBhY2NvdW50JyB9XG4gICAgICB9XG5cbiAgICAgIGZpbmFsVXNlciA9IG5ld1VzZXJcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgTmV3IHVzZXIgY3JlYXRlZCB3aXRoIFN1cGFiYXNlIEF1dGggc3luYzonLCBmaW5hbFVzZXIuaWQpXG4gICAgfSBlbHNlIGlmICghdXNlciAmJiBtYWdpY0xpbmsudHlwZSA9PT0gJ2xvZ2luJykge1xuICAgICAgY29uc29sZS5sb2coJ+KdjCBVc2VyIG5vdCBmb3VuZCBmb3IgbG9naW4nKVxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVXNlciBhY2NvdW50IG5vdCBmb3VuZC4gUGxlYXNlIHNpZ24gdXAgZmlyc3QuJyB9XG4gICAgfSBlbHNlIGlmICh1c2VyICYmIG1hZ2ljTGluay50eXBlID09PSAnbG9naW4nKSB7XG4gICAgICBjb25zb2xlLmxvZygn4pyFIEV4aXN0aW5nIHVzZXIgZm91bmQgZm9yIGxvZ2luOicsIHVzZXIuZW1haWwpXG4gICAgICAvLyBWZXJpZnkgdXNlciB0eXBlIG1hdGNoZXNcbiAgICAgIGlmICh1c2VyLnVzZXJfdHlwZSAhPT0gYXV0aFR5cGUpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ+KdjCBVc2VyIHR5cGUgbWlzbWF0Y2g6JywgdXNlci51c2VyX3R5cGUsICd2cycsIGF1dGhUeXBlKVxuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIHVzZXIgdHlwZSBmb3IgdGhpcyBsb2dpbicgfVxuICAgICAgfVxuICAgIH1cblxuICAgIC8vIENyZWF0ZSBzZXNzaW9uIHRva2VuIGFuZCBzdG9yZSBpbiBkYXRhYmFzZVxuICAgIGNvbnNvbGUubG9nKCfwn5SRIENyZWF0aW5nIHNlc3Npb24gdG9rZW4gYW5kIHN0b3JpbmcgaW4gZGF0YWJhc2UuLi4nKVxuICAgIGNvbnN0IHNlc3Npb25Ub2tlbiA9IHJhbmRvbVVVSUQoKVxuICAgIGNvbnN0IHNlc3Npb25FeHBpcmVzQXQgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgNyAqIDI0ICogNjAgKiA2MCAqIDEwMDApIC8vIDcgZGF5c1xuXG4gICAgLy8gQ2xlYXIgYW55IGV4aXN0aW5nIHNlc3Npb25zIGZvciB0aGlzIHVzZXJcbiAgICBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3VzZXJfc2Vzc2lvbnMnKVxuICAgICAgLmRlbGV0ZSgpXG4gICAgICAuZXEoJ3VzZXJfaWQnLCBmaW5hbFVzZXIuaWQpXG5cbiAgICAvLyBDcmVhdGUgbmV3IHNlc3Npb24gaW4gZGF0YWJhc2VcbiAgICBjb25zdCB7IGVycm9yOiBzZXNzaW9uRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcl9zZXNzaW9ucycpXG4gICAgICAuaW5zZXJ0KHtcbiAgICAgICAgdXNlcl9pZDogZmluYWxVc2VyLmlkLFxuICAgICAgICBzZXNzaW9uX3Rva2VuOiBzZXNzaW9uVG9rZW4sXG4gICAgICAgIGV4cGlyZXNfYXQ6IHNlc3Npb25FeHBpcmVzQXQudG9JU09TdHJpbmcoKSxcbiAgICAgICAgY3JlYXRlZF9hdDogbm93LnRvSVNPU3RyaW5nKCksXG4gICAgICAgIGxhc3RfYWNjZXNzZWRfYXQ6IG5vdy50b0lTT1N0cmluZygpXG4gICAgICB9KVxuXG4gICAgaWYgKHNlc3Npb25FcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGNyZWF0aW5nIHNlc3Npb246Jywgc2Vzc2lvbkVycm9yKVxuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRXJyb3IgY3JlYXRpbmcgc2Vzc2lvbicgfVxuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKCfinIUgU2Vzc2lvbiBjcmVhdGVkIGFuZCBzdG9yZWQgaW4gZGF0YWJhc2UnKVxuXG4gICAgLy8gVXBkYXRlIHVzZXIncyBsYXN0IGxvZ2luIGFuZCBtYXJrIGFzIHZlcmlmaWVkXG4gICAgYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAudXBkYXRlKHsgXG4gICAgICAgIGxhc3RfbG9naW5fYXQ6IG5vdy50b0lTT1N0cmluZygpLFxuICAgICAgICBpc192ZXJpZmllZDogdHJ1ZSAgLy8gTWFyayB1c2VyIGFzIHZlcmlmaWVkIGFmdGVyIHN1Y2Nlc3NmdWwgbWFnaWMgbGluayB2ZXJpZmljYXRpb25cbiAgICAgIH0pXG4gICAgICAuZXEoJ2lkJywgZmluYWxVc2VyLmlkKVxuXG4gICAgLy8gQXVkaXQgbG9nOiBTdWNjZXNzZnVsIG1hZ2ljIGxpbmsgdmVyaWZpY2F0aW9uXG4gICAgYXdhaXQgQXVkaXRMb2dnZXIubG9nTWFnaWNMaW5rVmVyaWZpY2F0aW9uKGZpbmFsVXNlci5pZCwgdHJ1ZSwge1xuICAgICAgZW1haWw6IGZpbmFsVXNlci5lbWFpbCxcbiAgICAgIGF1dGhUeXBlLFxuICAgICAgbWFnaWNMaW5rVHlwZTogbWFnaWNMaW5rLnR5cGVcbiAgICB9KVxuXG4gICAgLy8gQXVkaXQgbG9nOiBMb2dpbiBzdWNjZXNzXG4gICAgYXdhaXQgQXVkaXRMb2dnZXIubG9nTG9naW5TdWNjZXNzKGZpbmFsVXNlci5pZCwge1xuICAgICAgZW1haWw6IGZpbmFsVXNlci5lbWFpbCxcbiAgICAgIGF1dGhUeXBlLFxuICAgICAgbG9naW5NZXRob2Q6ICdtYWdpY19saW5rJ1xuICAgIH0pXG5cbiAgICByZXR1cm4ge1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIHVzZXI6IHtcbiAgICAgICAgLi4uZmluYWxVc2VyLFxuICAgICAgICBpc192ZXJpZmllZDogdHJ1ZSwgIC8vIEVuc3VyZSB0aGUgcmV0dXJuZWQgdXNlciBvYmplY3QgcmVmbGVjdHMgdmVyaWZpZWQgc3RhdHVzXG4gICAgICAgIHNlc3Npb25fdG9rZW46IHNlc3Npb25Ub2tlblxuICAgICAgfVxuICAgIH1cblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCB2ZXJpZnlNYWdpY0xpbmtGb3JBdXRoVHlwZSBlcnJvcjonLCBlcnJvcilcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnRlcm5hbCBzZXJ2ZXIgZXJyb3InIH1cbiAgfVxufVxuXG4vLyBMZWdhY3kgZnVuY3Rpb25zIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlTWFnaWNMaW5rKGVtYWlsOiBzdHJpbmcsIHR5cGU6ICdsb2dpbicgfCAnc2lnbnVwJywgbWV0YWRhdGE/OiBhbnkpIHtcbiAgcmV0dXJuIGNyZWF0ZU1hZ2ljTGlua0ZvckF1dGhUeXBlKGVtYWlsLCAnaW5kaXZpZHVhbCcsIHR5cGUsIG1ldGFkYXRhKVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gdmVyaWZ5TWFnaWNMaW5rKHRva2VuOiBzdHJpbmcpIHtcbiAgcmV0dXJuIHZlcmlmeU1hZ2ljTGlua0ZvckF1dGhUeXBlKHRva2VuLCAnaW5kaXZpZHVhbCcpXG59XG5cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJyYW5kb21VVUlEIiwic2VuZE1hZ2ljTGlua0VtYWlsIiwiY3JlYXRlVXNlcldpdGhTdXBhYmFzZUF1dGgiLCJSYXRlTGltaXRlciIsIkF1ZGl0TG9nZ2VyIiwic3VwYWJhc2UiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsImdldE1hZ2ljTGlua0V4cGlyeSIsImVtYWlsIiwiaGVhbHRoY2FyZURvbWFpbnMiLCJpc0hlYWx0aGNhcmVVc2VyIiwic29tZSIsImRvbWFpbiIsInRvTG93ZXJDYXNlIiwiaW5jbHVkZXMiLCJjb25zb2xlIiwibG9nIiwiY3JlYXRlTWFnaWNMaW5rRm9yQXV0aFR5cGUiLCJhdXRoVHlwZSIsInR5cGUiLCJtZXRhZGF0YSIsInJhdGVMaW1pdEFsbG93ZWQiLCJjaGVja01hZ2ljTGlua1JlcXVlc3QiLCJ3YXJuIiwibG9nUmF0ZUxpbWl0RXhjZWVkZWQiLCJzdWNjZXNzIiwiZXJyb3IiLCJ0b2tlbiIsImV4cGlyeUR1cmF0aW9uIiwiZXhwaXJlc0F0IiwiRGF0ZSIsIm5vdyIsInN1YnN0cmluZyIsInRvSVNPU3RyaW5nIiwiZnJvbSIsImluc2VydCIsImF1dGhfdHlwZSIsImV4cGlyZXNfYXQiLCJiYXNlVXJsIiwiTkVYVF9QVUJMSUNfQVBQX1VSTCIsInZlcmlmaWNhdGlvblVybCIsImVtYWlsUmVzdWx0IiwibG9nTWFnaWNMaW5rU2VudCIsInZlcmlmeU1hZ2ljTGlua0ZvckF1dGhUeXBlIiwiY2hlY2tNYWdpY0xpbmtWZXJpZmljYXRpb24iLCJkYXRhIiwibWFnaWNMaW5rIiwibWFnaWNMaW5rRXJyb3IiLCJzZWxlY3QiLCJlcSIsImlzIiwic2luZ2xlIiwibG9nTWFnaWNMaW5rVmVyaWZpY2F0aW9uIiwiZXJyb3JfbWVzc2FnZSIsImlkIiwidXBkYXRlZExpbmsiLCJ1cGRhdGVFcnJvciIsInVwZGF0ZSIsInVzZWRfYXQiLCJ1cGRhdGVkX2F0IiwidXNlciIsInVzZXJFcnJvciIsImNvZGUiLCJmaW5hbFVzZXIiLCJjcmVhdGVSZXN1bHQiLCJmdWxsX25hbWUiLCJmaXJzdF9uYW1lIiwic3BsaXQiLCJ1c2VyX3R5cGUiLCJuZXdVc2VyIiwiZmV0Y2hFcnJvciIsInVzZXJfaWQiLCJzZXNzaW9uVG9rZW4iLCJzZXNzaW9uRXhwaXJlc0F0IiwiZGVsZXRlIiwic2Vzc2lvbkVycm9yIiwic2Vzc2lvbl90b2tlbiIsImNyZWF0ZWRfYXQiLCJsYXN0X2FjY2Vzc2VkX2F0IiwibGFzdF9sb2dpbl9hdCIsImlzX3ZlcmlmaWVkIiwibWFnaWNMaW5rVHlwZSIsImxvZ0xvZ2luU3VjY2VzcyIsImxvZ2luTWV0aG9kIiwiY3JlYXRlTWFnaWNMaW5rIiwidmVyaWZ5TWFnaWNMaW5rIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/auth.ts\n");

/***/ }),

/***/ "(rsc)/./lib/email.ts":
/*!**********************!*\
  !*** ./lib/email.ts ***!
  \**********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   sendMagicLinkEmail: () => (/* binding */ sendMagicLinkEmail),\n/* harmony export */   sendPasswordResetEmail: () => (/* binding */ sendPasswordResetEmail),\n/* harmony export */   sendVerificationEmail: () => (/* binding */ sendVerificationEmail)\n/* harmony export */ });\n/* harmony import */ var nodemailer__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! nodemailer */ \"(rsc)/./node_modules/nodemailer/lib/nodemailer.js\");\n\n// Create Brevo SMTP transporter\nfunction createTransporter() {\n    if (!process.env.BREVO_SMTP_USER || !process.env.BREVO_SMTP_PASS) {\n        console.warn('Brevo SMTP credentials not configured - email sending will be disabled');\n        return null;\n    }\n    // Use a proper sender email address\n    const senderEmail = process.env.SENDER_EMAIL || 'noreply@trpi.com';\n    return nodemailer__WEBPACK_IMPORTED_MODULE_0__.createTransport({\n        host: 'smtp-relay.brevo.com',\n        port: 587,\n        secure: false,\n        auth: {\n            user: process.env.BREVO_SMTP_USER,\n            pass: process.env.BREVO_SMTP_PASS\n        },\n        tls: {\n            rejectUnauthorized: false\n        }\n    });\n}\nasync function sendVerificationEmail(email, token) {\n    const transporter = createTransporter();\n    if (!transporter) {\n        console.warn('Email transporter not available - skipping email send');\n        return {\n            success: false,\n            error: 'Email service not configured'\n        };\n    }\n    const verificationUrl = `${\"http://localhost:3000\" || 0}/api/auth/verify-email?email=${email}&token=${token}`;\n    const senderEmail = process.env.SENDER_EMAIL || 'noreply@trpi.com';\n    const mailOptions = {\n        from: `Michael from Quiet  <${senderEmail}>`,\n        to: email,\n        subject: 'Welcome to Thequietherapy.live - Access Your Dashboard',\n        html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #3b82f6;\">Welcome to Quiet!</h2>\n        <p>Your account has been created successfully! Click the button below to access your dashboard and start your therapy journey:</p>\n        <a href=\"${verificationUrl}\" style=\"display: inline-block; background-color: #3b82f6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0;\">\n          üöÄ Access Your Dashboard\n        </a>\n        <p>If the button doesn't work, copy and paste this link into your browser:</p>\n        <p style=\"word-break: break-all; color: #6b7280;\">${verificationUrl}</p>\n        <p>From your dashboard, you can:</p>\n        <ul style=\"color: #6b7280;\">\n          <li>Book therapy sessions</li>\n          <li>Manage your appointments</li>\n          <li>Track your progress</li>\n          <li>Access your credits and packages</li>\n        </ul>\n        <p>Best regards,<br>The Quiet Team</p>\n      </div>\n    `\n    };\n    try {\n        const info = await transporter.sendMail(mailOptions);\n        console.log('Verification email sent successfully:', info.messageId);\n        return {\n            success: true,\n            messageId: info.messageId\n        };\n    } catch (error) {\n        console.error('Failed to send verification email:', error);\n        return {\n            success: false,\n            error: 'Failed to send email'\n        };\n    }\n}\nasync function sendPasswordResetEmail(email, token) {\n    const transporter = createTransporter();\n    if (!transporter) {\n        console.warn('Email transporter not available - skipping email send');\n        return {\n            success: false,\n            error: 'Email service not configured'\n        };\n    }\n    const resetUrl = `${\"http://localhost:3000\" || 0}/reset-password?token=${token}`;\n    const senderEmail = process.env.SENDER_EMAIL || 'noreply@trpi.com';\n    const mailOptions = {\n        from: `Quiet <${senderEmail}>`,\n        to: email,\n        subject: 'Reset your Quiet password',\n        html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #3b82f6;\">Password Reset Request</h2>\n        <p>You requested to reset your password. Click the button below to create a new password:</p>\n        <a href=\"${resetUrl}\" style=\"display: inline-block; background-color: #3b82f6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0;\">\n          Reset Password\n        </a>\n        <p>If you didn't request this, you can safely ignore this email.</p>\n        <p>This link will expire in 1 hour.</p>\n        <p>Best regards,<br>The Quiet Team</p>\n      </div>\n    `\n    };\n    try {\n        const info = await transporter.sendMail(mailOptions);\n        console.log('Password reset email sent successfully:', info.messageId);\n        return {\n            success: true,\n            messageId: info.messageId\n        };\n    } catch (error) {\n        console.error('Failed to send password reset email:', error);\n        return {\n            success: false,\n            error: 'Failed to send email'\n        };\n    }\n}\nasync function sendMagicLinkEmail(email, verificationUrl, type, metadata) {\n    console.log('üìß sendMagicLinkEmail called with:', {\n        email,\n        verificationUrl,\n        type,\n        metadata\n    });\n    const transporter = createTransporter();\n    console.log('üìß Transporter created:', !!transporter);\n    if (!transporter) {\n        console.warn('Email transporter not available - logging magic link instead');\n        console.log('üîó MAGIC LINK FOR TESTING:');\n        console.log('Email:', email);\n        console.log('URL:', verificationUrl);\n        console.log('Type:', type);\n        console.log('Metadata:', metadata);\n        console.log('üîó END MAGIC LINK');\n        return {\n            success: true,\n            error: 'Email service not configured - link logged to console'\n        };\n    }\n    let subject = '';\n    let title = '';\n    let description = '';\n    // Determine user type for specific messaging\n    const userType = metadata?.user_type || 'individual';\n    switch(type){\n        case 'booking':\n            subject = 'Confirm Your Therapy Session Booking';\n            title = 'Confirm Your Booking';\n            description = `Hi ${metadata?.first_name || 'there'}, your therapy session has been booked successfully! Click the link below to confirm your details and access your dashboard:`;\n            break;\n        case 'login':\n            if (userType === 'therapist') {\n                subject = 'Login to Your Quiet Therapist Dashboard';\n                title = 'Login to Therapist Dashboard';\n                description = 'Click the link below to securely log in to your Quiet therapist dashboard:';\n            } else if (userType === 'partner') {\n                subject = 'Login to Your Quiet Partner Portal';\n                title = 'Login to Partner Portal';\n                description = 'Click the link below to securely log in to your Quiet partner portal:';\n            } else {\n                subject = 'Login to Your Quiet Account';\n                title = 'Login to Quiet';\n                description = 'Click the link below to securely log in to your Quiet account:';\n            }\n            break;\n        case 'signup':\n            if (userType === 'therapist') {\n                subject = 'Welcome to Quiet - Complete Your Therapist Registration';\n                title = 'Welcome to Quiet!';\n                description = `Hi ${metadata?.first_name || 'there'}, welcome to Quiet! Click the link below to complete your therapist registration and access your professional dashboard:`;\n            } else if (userType === 'partner') {\n                subject = 'Welcome to Trpi - Complete Your Partner Onboarding';\n                title = 'Welcome to Trpi!';\n                description = `Hi ${metadata?.first_name || 'there'}, welcome to Trpi! Click the link below to complete your partner onboarding and access your organization dashboard:`;\n            } else {\n                subject = 'Welcome to Trpi - Confirm Your Account';\n                title = 'Welcome to Trpi!';\n                description = `Hi ${metadata?.first_name || 'there'}, welcome to Trpi! Click the link below to confirm your account and start your therapy journey:`;\n            }\n            break;\n    }\n    const senderEmail = process.env.SENDER_EMAIL || 'noreply@trpi.com';\n    const mailOptions = {\n        from: `Quiet <${senderEmail}>`,\n        to: email,\n        subject: subject,\n        html: `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n        <h2 style=\"color: #3b82f6;\">${title}</h2>\n        <p>${description}</p>\n        <a href=\"${verificationUrl}\" style=\"display: inline-block; background-color: #3b82f6; color: white; padding: 12px 24px; text-decoration: none; border-radius: 6px; margin: 20px 0;\">\n          ${type === 'booking' ? 'Confirm & Access Dashboard' : type === 'login' ? userType === 'therapist' ? 'Login to Therapist Dashboard' : userType === 'partner' ? 'Login to Partner Portal' : 'Login to Account' : userType === 'therapist' ? 'Complete Therapist Registration' : userType === 'partner' ? 'Complete Partner Onboarding' : 'Confirm Account'}\n        </a>\n        <p>If the button doesn't work, copy and paste this link into your browser:</p>\n        <p style=\"word-break: break-all; color: #6b7280;\">${verificationUrl}</p>\n        <p>This link will expire in 24 hours.</p>\n        <p>Best regards,<br>The Quiet Team</p>\n      </div>\n    `\n    };\n    try {\n        const info = await transporter.sendMail(mailOptions);\n        console.log('Magic link email sent successfully:', info.messageId);\n        return {\n            success: true,\n            messageId: info.messageId\n        };\n    } catch (error) {\n        console.error('Failed to send magic link email:', error);\n        return {\n            success: false,\n            error: 'Failed to send email'\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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a3RvcC90cnBpLWFwcC9saWIvZW1haWwudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG5vZGVtYWlsZXIgZnJvbSAnbm9kZW1haWxlcic7XG5cbi8vIENyZWF0ZSBCcmV2byBTTVRQIHRyYW5zcG9ydGVyXG5mdW5jdGlvbiBjcmVhdGVUcmFuc3BvcnRlcigpIHtcbiAgaWYgKCFwcm9jZXNzLmVudi5CUkVWT19TTVRQX1VTRVIgfHwgIXByb2Nlc3MuZW52LkJSRVZPX1NNVFBfUEFTUykge1xuICAgIGNvbnNvbGUud2FybignQnJldm8gU01UUCBjcmVkZW50aWFscyBub3QgY29uZmlndXJlZCAtIGVtYWlsIHNlbmRpbmcgd2lsbCBiZSBkaXNhYmxlZCcpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIFxuICAvLyBVc2UgYSBwcm9wZXIgc2VuZGVyIGVtYWlsIGFkZHJlc3NcbiAgY29uc3Qgc2VuZGVyRW1haWwgPSBwcm9jZXNzLmVudi5TRU5ERVJfRU1BSUwgfHwgJ25vcmVwbHlAdHJwaS5jb20nO1xuICBcbiAgcmV0dXJuIG5vZGVtYWlsZXIuY3JlYXRlVHJhbnNwb3J0KHtcbiAgICBob3N0OiAnc210cC1yZWxheS5icmV2by5jb20nLFxuICAgIHBvcnQ6IDU4NyxcbiAgICBzZWN1cmU6IGZhbHNlLCAvLyB0cnVlIGZvciA0NjUsIGZhbHNlIGZvciBvdGhlciBwb3J0c1xuICAgIGF1dGg6IHtcbiAgICAgIHVzZXI6IHByb2Nlc3MuZW52LkJSRVZPX1NNVFBfVVNFUixcbiAgICAgIHBhc3M6IHByb2Nlc3MuZW52LkJSRVZPX1NNVFBfUEFTUyxcbiAgICB9LFxuICAgIHRsczoge1xuICAgICAgcmVqZWN0VW5hdXRob3JpemVkOiBmYWxzZVxuICAgIH1cbiAgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzZW5kVmVyaWZpY2F0aW9uRW1haWwoZW1haWw6IHN0cmluZywgdG9rZW46IHN0cmluZykge1xuICBjb25zdCB0cmFuc3BvcnRlciA9IGNyZWF0ZVRyYW5zcG9ydGVyKCk7XG4gIFxuICBpZiAoIXRyYW5zcG9ydGVyKSB7XG4gICAgY29uc29sZS53YXJuKCdFbWFpbCB0cmFuc3BvcnRlciBub3QgYXZhaWxhYmxlIC0gc2tpcHBpbmcgZW1haWwgc2VuZCcpO1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIHNlcnZpY2Ugbm90IGNvbmZpZ3VyZWQnIH07XG4gIH1cbiAgXG4gIGNvbnN0IHZlcmlmaWNhdGlvblVybCA9IGAke3Byb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0FQUF9VUkwgfHwgJ2h0dHA6Ly9sb2NhbGhvc3Q6MzAwMSd9L2FwaS9hdXRoL3ZlcmlmeS1lbWFpbD9lbWFpbD0ke2VtYWlsfSZ0b2tlbj0ke3Rva2VufWA7XG4gIFxuICBjb25zdCBzZW5kZXJFbWFpbCA9IHByb2Nlc3MuZW52LlNFTkRFUl9FTUFJTCB8fCAnbm9yZXBseUB0cnBpLmNvbSc7XG4gIFxuICBjb25zdCBtYWlsT3B0aW9ucyA9IHtcbiAgICBmcm9tOiBgTWljaGFlbCBmcm9tIFF1aWV0ICA8JHtzZW5kZXJFbWFpbH0+YCxcbiAgICB0bzogZW1haWwsXG4gICAgc3ViamVjdDogJ1dlbGNvbWUgdG8gVGhlcXVpZXRoZXJhcHkubGl2ZSAtIEFjY2VzcyBZb3VyIERhc2hib2FyZCcsXG4gICAgaHRtbDogYFxuICAgICAgPGRpdiBzdHlsZT1cImZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsgbWF4LXdpZHRoOiA2MDBweDsgbWFyZ2luOiAwIGF1dG87XCI+XG4gICAgICAgIDxoMiBzdHlsZT1cImNvbG9yOiAjM2I4MmY2O1wiPldlbGNvbWUgdG8gUXVpZXQhPC9oMj5cbiAgICAgICAgPHA+WW91ciBhY2NvdW50IGhhcyBiZWVuIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5ISBDbGljayB0aGUgYnV0dG9uIGJlbG93IHRvIGFjY2VzcyB5b3VyIGRhc2hib2FyZCBhbmQgc3RhcnQgeW91ciB0aGVyYXB5IGpvdXJuZXk6PC9wPlxuICAgICAgICA8YSBocmVmPVwiJHt2ZXJpZmljYXRpb25Vcmx9XCIgc3R5bGU9XCJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGJhY2tncm91bmQtY29sb3I6ICMzYjgyZjY7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMTJweCAyNHB4OyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IGJvcmRlci1yYWRpdXM6IDZweDsgbWFyZ2luOiAyMHB4IDA7XCI+XG4gICAgICAgICAg8J+agCBBY2Nlc3MgWW91ciBEYXNoYm9hcmRcbiAgICAgICAgPC9hPlxuICAgICAgICA8cD5JZiB0aGUgYnV0dG9uIGRvZXNuJ3Qgd29yaywgY29weSBhbmQgcGFzdGUgdGhpcyBsaW5rIGludG8geW91ciBicm93c2VyOjwvcD5cbiAgICAgICAgPHAgc3R5bGU9XCJ3b3JkLWJyZWFrOiBicmVhay1hbGw7IGNvbG9yOiAjNmI3MjgwO1wiPiR7dmVyaWZpY2F0aW9uVXJsfTwvcD5cbiAgICAgICAgPHA+RnJvbSB5b3VyIGRhc2hib2FyZCwgeW91IGNhbjo8L3A+XG4gICAgICAgIDx1bCBzdHlsZT1cImNvbG9yOiAjNmI3MjgwO1wiPlxuICAgICAgICAgIDxsaT5Cb29rIHRoZXJhcHkgc2Vzc2lvbnM8L2xpPlxuICAgICAgICAgIDxsaT5NYW5hZ2UgeW91ciBhcHBvaW50bWVudHM8L2xpPlxuICAgICAgICAgIDxsaT5UcmFjayB5b3VyIHByb2dyZXNzPC9saT5cbiAgICAgICAgICA8bGk+QWNjZXNzIHlvdXIgY3JlZGl0cyBhbmQgcGFja2FnZXM8L2xpPlxuICAgICAgICA8L3VsPlxuICAgICAgICA8cD5CZXN0IHJlZ2FyZHMsPGJyPlRoZSBRdWlldCBUZWFtPC9wPlxuICAgICAgPC9kaXY+XG4gICAgYCxcbiAgfTtcblxuICB0cnkge1xuICAgIGNvbnN0IGluZm8gPSBhd2FpdCB0cmFuc3BvcnRlci5zZW5kTWFpbChtYWlsT3B0aW9ucyk7XG4gICAgY29uc29sZS5sb2coJ1ZlcmlmaWNhdGlvbiBlbWFpbCBzZW50IHN1Y2Nlc3NmdWxseTonLCBpbmZvLm1lc3NhZ2VJZCk7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZUlkOiBpbmZvLm1lc3NhZ2VJZCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzZW5kIHZlcmlmaWNhdGlvbiBlbWFpbDonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRmFpbGVkIHRvIHNlbmQgZW1haWwnIH07XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHNlbmRQYXNzd29yZFJlc2V0RW1haWwoZW1haWw6IHN0cmluZywgdG9rZW46IHN0cmluZykge1xuICBjb25zdCB0cmFuc3BvcnRlciA9IGNyZWF0ZVRyYW5zcG9ydGVyKCk7XG4gIFxuICBpZiAoIXRyYW5zcG9ydGVyKSB7XG4gICAgY29uc29sZS53YXJuKCdFbWFpbCB0cmFuc3BvcnRlciBub3QgYXZhaWxhYmxlIC0gc2tpcHBpbmcgZW1haWwgc2VuZCcpO1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0VtYWlsIHNlcnZpY2Ugbm90IGNvbmZpZ3VyZWQnIH07XG4gIH1cbiAgXG4gIGNvbnN0IHJlc2V0VXJsID0gYCR7cHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBQX1VSTCB8fCAnaHR0cDovL2xvY2FsaG9zdDozMDAxJ30vcmVzZXQtcGFzc3dvcmQ/dG9rZW49JHt0b2tlbn1gO1xuICBcbiAgY29uc3Qgc2VuZGVyRW1haWwgPSBwcm9jZXNzLmVudi5TRU5ERVJfRU1BSUwgfHwgJ25vcmVwbHlAdHJwaS5jb20nO1xuICBcbiAgY29uc3QgbWFpbE9wdGlvbnMgPSB7XG4gICAgZnJvbTogYFF1aWV0IDwke3NlbmRlckVtYWlsfT5gLFxuICAgIHRvOiBlbWFpbCxcbiAgICBzdWJqZWN0OiAnUmVzZXQgeW91ciBRdWlldCBwYXNzd29yZCcsXG4gICAgaHRtbDogYFxuICAgICAgPGRpdiBzdHlsZT1cImZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsgbWF4LXdpZHRoOiA2MDBweDsgbWFyZ2luOiAwIGF1dG87XCI+XG4gICAgICAgIDxoMiBzdHlsZT1cImNvbG9yOiAjM2I4MmY2O1wiPlBhc3N3b3JkIFJlc2V0IFJlcXVlc3Q8L2gyPlxuICAgICAgICA8cD5Zb3UgcmVxdWVzdGVkIHRvIHJlc2V0IHlvdXIgcGFzc3dvcmQuIENsaWNrIHRoZSBidXR0b24gYmVsb3cgdG8gY3JlYXRlIGEgbmV3IHBhc3N3b3JkOjwvcD5cbiAgICAgICAgPGEgaHJlZj1cIiR7cmVzZXRVcmx9XCIgc3R5bGU9XCJkaXNwbGF5OiBpbmxpbmUtYmxvY2s7IGJhY2tncm91bmQtY29sb3I6ICMzYjgyZjY7IGNvbG9yOiB3aGl0ZTsgcGFkZGluZzogMTJweCAyNHB4OyB0ZXh0LWRlY29yYXRpb246IG5vbmU7IGJvcmRlci1yYWRpdXM6IDZweDsgbWFyZ2luOiAyMHB4IDA7XCI+XG4gICAgICAgICAgUmVzZXQgUGFzc3dvcmRcbiAgICAgICAgPC9hPlxuICAgICAgICA8cD5JZiB5b3UgZGlkbid0IHJlcXVlc3QgdGhpcywgeW91IGNhbiBzYWZlbHkgaWdub3JlIHRoaXMgZW1haWwuPC9wPlxuICAgICAgICA8cD5UaGlzIGxpbmsgd2lsbCBleHBpcmUgaW4gMSBob3VyLjwvcD5cbiAgICAgICAgPHA+QmVzdCByZWdhcmRzLDxicj5UaGUgUXVpZXQgVGVhbTwvcD5cbiAgICAgIDwvZGl2PlxuICAgIGAsXG4gIH07XG5cbiAgdHJ5IHtcbiAgICBjb25zdCBpbmZvID0gYXdhaXQgdHJhbnNwb3J0ZXIuc2VuZE1haWwobWFpbE9wdGlvbnMpO1xuICAgIGNvbnNvbGUubG9nKCdQYXNzd29yZCByZXNldCBlbWFpbCBzZW50IHN1Y2Nlc3NmdWxseTonLCBpbmZvLm1lc3NhZ2VJZCk7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgbWVzc2FnZUlkOiBpbmZvLm1lc3NhZ2VJZCB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzZW5kIHBhc3N3b3JkIHJlc2V0IGVtYWlsOicsIGVycm9yKTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGYWlsZWQgdG8gc2VuZCBlbWFpbCcgfTtcbiAgfVxufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gc2VuZE1hZ2ljTGlua0VtYWlsKGVtYWlsOiBzdHJpbmcsIHZlcmlmaWNhdGlvblVybDogc3RyaW5nLCB0eXBlOiAnYm9va2luZycgfCAnbG9naW4nIHwgJ3NpZ251cCcsIG1ldGFkYXRhPzogYW55KSB7XG4gIGNvbnNvbGUubG9nKCfwn5OnIHNlbmRNYWdpY0xpbmtFbWFpbCBjYWxsZWQgd2l0aDonLCB7IGVtYWlsLCB2ZXJpZmljYXRpb25VcmwsIHR5cGUsIG1ldGFkYXRhIH0pO1xuICBcbiAgY29uc3QgdHJhbnNwb3J0ZXIgPSBjcmVhdGVUcmFuc3BvcnRlcigpO1xuICBjb25zb2xlLmxvZygn8J+TpyBUcmFuc3BvcnRlciBjcmVhdGVkOicsICEhdHJhbnNwb3J0ZXIpO1xuICBcbiAgaWYgKCF0cmFuc3BvcnRlcikge1xuICAgIGNvbnNvbGUud2FybignRW1haWwgdHJhbnNwb3J0ZXIgbm90IGF2YWlsYWJsZSAtIGxvZ2dpbmcgbWFnaWMgbGluayBpbnN0ZWFkJyk7XG4gICAgY29uc29sZS5sb2coJ/CflJcgTUFHSUMgTElOSyBGT1IgVEVTVElORzonKTtcbiAgICBjb25zb2xlLmxvZygnRW1haWw6JywgZW1haWwpO1xuICAgIGNvbnNvbGUubG9nKCdVUkw6JywgdmVyaWZpY2F0aW9uVXJsKTtcbiAgICBjb25zb2xlLmxvZygnVHlwZTonLCB0eXBlKTtcbiAgICBjb25zb2xlLmxvZygnTWV0YWRhdGE6JywgbWV0YWRhdGEpO1xuICAgIGNvbnNvbGUubG9nKCfwn5SXIEVORCBNQUdJQyBMSU5LJyk7XG4gICAgcmV0dXJuIHsgc3VjY2VzczogdHJ1ZSwgZXJyb3I6ICdFbWFpbCBzZXJ2aWNlIG5vdCBjb25maWd1cmVkIC0gbGluayBsb2dnZWQgdG8gY29uc29sZScgfTtcbiAgfVxuICBcbiAgbGV0IHN1YmplY3QgPSAnJztcbiAgbGV0IHRpdGxlID0gJyc7XG4gIGxldCBkZXNjcmlwdGlvbiA9ICcnO1xuICBcbiAgLy8gRGV0ZXJtaW5lIHVzZXIgdHlwZSBmb3Igc3BlY2lmaWMgbWVzc2FnaW5nXG4gIGNvbnN0IHVzZXJUeXBlID0gbWV0YWRhdGE/LnVzZXJfdHlwZSB8fCAnaW5kaXZpZHVhbCc7XG4gIFxuICBzd2l0Y2ggKHR5cGUpIHtcbiAgICBjYXNlICdib29raW5nJzpcbiAgICAgIHN1YmplY3QgPSAnQ29uZmlybSBZb3VyIFRoZXJhcHkgU2Vzc2lvbiBCb29raW5nJztcbiAgICAgIHRpdGxlID0gJ0NvbmZpcm0gWW91ciBCb29raW5nJztcbiAgICAgIGRlc2NyaXB0aW9uID0gYEhpICR7bWV0YWRhdGE/LmZpcnN0X25hbWUgfHwgJ3RoZXJlJ30sIHlvdXIgdGhlcmFweSBzZXNzaW9uIGhhcyBiZWVuIGJvb2tlZCBzdWNjZXNzZnVsbHkhIENsaWNrIHRoZSBsaW5rIGJlbG93IHRvIGNvbmZpcm0geW91ciBkZXRhaWxzIGFuZCBhY2Nlc3MgeW91ciBkYXNoYm9hcmQ6YDtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ2xvZ2luJzpcbiAgICAgIGlmICh1c2VyVHlwZSA9PT0gJ3RoZXJhcGlzdCcpIHtcbiAgICAgICAgc3ViamVjdCA9ICdMb2dpbiB0byBZb3VyIFF1aWV0IFRoZXJhcGlzdCBEYXNoYm9hcmQnO1xuICAgICAgICB0aXRsZSA9ICdMb2dpbiB0byBUaGVyYXBpc3QgRGFzaGJvYXJkJztcbiAgICAgICAgZGVzY3JpcHRpb24gPSAnQ2xpY2sgdGhlIGxpbmsgYmVsb3cgdG8gc2VjdXJlbHkgbG9nIGluIHRvIHlvdXIgUXVpZXQgdGhlcmFwaXN0IGRhc2hib2FyZDonO1xuICAgICAgfSBlbHNlIGlmICh1c2VyVHlwZSA9PT0gJ3BhcnRuZXInKSB7XG4gICAgICAgIHN1YmplY3QgPSAnTG9naW4gdG8gWW91ciBRdWlldCBQYXJ0bmVyIFBvcnRhbCc7XG4gICAgICAgIHRpdGxlID0gJ0xvZ2luIHRvIFBhcnRuZXIgUG9ydGFsJztcbiAgICAgICAgZGVzY3JpcHRpb24gPSAnQ2xpY2sgdGhlIGxpbmsgYmVsb3cgdG8gc2VjdXJlbHkgbG9nIGluIHRvIHlvdXIgUXVpZXQgcGFydG5lciBwb3J0YWw6JztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHN1YmplY3QgPSAnTG9naW4gdG8gWW91ciBRdWlldCBBY2NvdW50JztcbiAgICAgICAgdGl0bGUgPSAnTG9naW4gdG8gUXVpZXQnO1xuICAgICAgICBkZXNjcmlwdGlvbiA9ICdDbGljayB0aGUgbGluayBiZWxvdyB0byBzZWN1cmVseSBsb2cgaW4gdG8geW91ciBRdWlldCBhY2NvdW50Oic7XG4gICAgICB9XG4gICAgICBicmVhaztcbiAgICBjYXNlICdzaWdudXAnOlxuICAgICAgaWYgKHVzZXJUeXBlID09PSAndGhlcmFwaXN0Jykge1xuICAgICAgICBzdWJqZWN0ID0gJ1dlbGNvbWUgdG8gUXVpZXQgLSBDb21wbGV0ZSBZb3VyIFRoZXJhcGlzdCBSZWdpc3RyYXRpb24nO1xuICAgICAgICB0aXRsZSA9ICdXZWxjb21lIHRvIFF1aWV0ISc7XG4gICAgICAgIGRlc2NyaXB0aW9uID0gYEhpICR7bWV0YWRhdGE/LmZpcnN0X25hbWUgfHwgJ3RoZXJlJ30sIHdlbGNvbWUgdG8gUXVpZXQhIENsaWNrIHRoZSBsaW5rIGJlbG93IHRvIGNvbXBsZXRlIHlvdXIgdGhlcmFwaXN0IHJlZ2lzdHJhdGlvbiBhbmQgYWNjZXNzIHlvdXIgcHJvZmVzc2lvbmFsIGRhc2hib2FyZDpgO1xuICAgICAgfSBlbHNlIGlmICh1c2VyVHlwZSA9PT0gJ3BhcnRuZXInKSB7XG4gICAgICAgIHN1YmplY3QgPSAnV2VsY29tZSB0byBUcnBpIC0gQ29tcGxldGUgWW91ciBQYXJ0bmVyIE9uYm9hcmRpbmcnO1xuICAgICAgICB0aXRsZSA9ICdXZWxjb21lIHRvIFRycGkhJztcbiAgICAgICAgZGVzY3JpcHRpb24gPSBgSGkgJHttZXRhZGF0YT8uZmlyc3RfbmFtZSB8fCAndGhlcmUnfSwgd2VsY29tZSB0byBUcnBpISBDbGljayB0aGUgbGluayBiZWxvdyB0byBjb21wbGV0ZSB5b3VyIHBhcnRuZXIgb25ib2FyZGluZyBhbmQgYWNjZXNzIHlvdXIgb3JnYW5pemF0aW9uIGRhc2hib2FyZDpgO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3ViamVjdCA9ICdXZWxjb21lIHRvIFRycGkgLSBDb25maXJtIFlvdXIgQWNjb3VudCc7XG4gICAgICAgIHRpdGxlID0gJ1dlbGNvbWUgdG8gVHJwaSEnO1xuICAgICAgICBkZXNjcmlwdGlvbiA9IGBIaSAke21ldGFkYXRhPy5maXJzdF9uYW1lIHx8ICd0aGVyZSd9LCB3ZWxjb21lIHRvIFRycGkhIENsaWNrIHRoZSBsaW5rIGJlbG93IHRvIGNvbmZpcm0geW91ciBhY2NvdW50IGFuZCBzdGFydCB5b3VyIHRoZXJhcHkgam91cm5leTpgO1xuICAgICAgfVxuICAgICAgYnJlYWs7XG4gIH1cbiAgXG4gIGNvbnN0IHNlbmRlckVtYWlsID0gcHJvY2Vzcy5lbnYuU0VOREVSX0VNQUlMIHx8ICdub3JlcGx5QHRycGkuY29tJztcbiAgXG4gIGNvbnN0IG1haWxPcHRpb25zID0ge1xuICAgIGZyb206IGBRdWlldCA8JHtzZW5kZXJFbWFpbH0+YCxcbiAgICB0bzogZW1haWwsXG4gICAgc3ViamVjdDogc3ViamVjdCxcbiAgICBodG1sOiBgXG4gICAgICA8ZGl2IHN0eWxlPVwiZm9udC1mYW1pbHk6IEFyaWFsLCBzYW5zLXNlcmlmOyBtYXgtd2lkdGg6IDYwMHB4OyBtYXJnaW46IDAgYXV0bztcIj5cbiAgICAgICAgPGgyIHN0eWxlPVwiY29sb3I6ICMzYjgyZjY7XCI+JHt0aXRsZX08L2gyPlxuICAgICAgICA8cD4ke2Rlc2NyaXB0aW9ufTwvcD5cbiAgICAgICAgPGEgaHJlZj1cIiR7dmVyaWZpY2F0aW9uVXJsfVwiIHN0eWxlPVwiZGlzcGxheTogaW5saW5lLWJsb2NrOyBiYWNrZ3JvdW5kLWNvbG9yOiAjM2I4MmY2OyBjb2xvcjogd2hpdGU7IHBhZGRpbmc6IDEycHggMjRweDsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyBib3JkZXItcmFkaXVzOiA2cHg7IG1hcmdpbjogMjBweCAwO1wiPlxuICAgICAgICAgICR7dHlwZSA9PT0gJ2Jvb2tpbmcnID8gJ0NvbmZpcm0gJiBBY2Nlc3MgRGFzaGJvYXJkJyA6IFxuICAgICAgICAgICAgdHlwZSA9PT0gJ2xvZ2luJyA/ICh1c2VyVHlwZSA9PT0gJ3RoZXJhcGlzdCcgPyAnTG9naW4gdG8gVGhlcmFwaXN0IERhc2hib2FyZCcgOiB1c2VyVHlwZSA9PT0gJ3BhcnRuZXInID8gJ0xvZ2luIHRvIFBhcnRuZXIgUG9ydGFsJyA6ICdMb2dpbiB0byBBY2NvdW50JykgOiBcbiAgICAgICAgICAgIHVzZXJUeXBlID09PSAndGhlcmFwaXN0JyA/ICdDb21wbGV0ZSBUaGVyYXBpc3QgUmVnaXN0cmF0aW9uJyA6IHVzZXJUeXBlID09PSAncGFydG5lcicgPyAnQ29tcGxldGUgUGFydG5lciBPbmJvYXJkaW5nJyA6ICdDb25maXJtIEFjY291bnQnfVxuICAgICAgICA8L2E+XG4gICAgICAgIDxwPklmIHRoZSBidXR0b24gZG9lc24ndCB3b3JrLCBjb3B5IGFuZCBwYXN0ZSB0aGlzIGxpbmsgaW50byB5b3VyIGJyb3dzZXI6PC9wPlxuICAgICAgICA8cCBzdHlsZT1cIndvcmQtYnJlYWs6IGJyZWFrLWFsbDsgY29sb3I6ICM2YjcyODA7XCI+JHt2ZXJpZmljYXRpb25Vcmx9PC9wPlxuICAgICAgICA8cD5UaGlzIGxpbmsgd2lsbCBleHBpcmUgaW4gMjQgaG91cnMuPC9wPlxuICAgICAgICA8cD5CZXN0IHJlZ2FyZHMsPGJyPlRoZSBRdWlldCBUZWFtPC9wPlxuICAgICAgPC9kaXY+XG4gICAgYCxcbiAgfTtcblxuICB0cnkge1xuICAgIGNvbnN0IGluZm8gPSBhd2FpdCB0cmFuc3BvcnRlci5zZW5kTWFpbChtYWlsT3B0aW9ucyk7XG4gICAgY29uc29sZS5sb2coJ01hZ2ljIGxpbmsgZW1haWwgc2VudCBzdWNjZXNzZnVsbHk6JywgaW5mby5tZXNzYWdlSWQpO1xuICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2VJZDogaW5mby5tZXNzYWdlSWQgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdGYWlsZWQgdG8gc2VuZCBtYWdpYyBsaW5rIGVtYWlsOicsIGVycm9yKTtcbiAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGYWlsZWQgdG8gc2VuZCBlbWFpbCcgfTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIm5vZGVtYWlsZXIiLCJjcmVhdGVUcmFuc3BvcnRlciIsInByb2Nlc3MiLCJlbnYiLCJCUkVWT19TTVRQX1VTRVIiLCJCUkVWT19TTVRQX1BBU1MiLCJjb25zb2xlIiwid2FybiIsInNlbmRlckVtYWlsIiwiU0VOREVSX0VNQUlMIiwiY3JlYXRlVHJhbnNwb3J0IiwiaG9zdCIsInBvcnQiLCJzZWN1cmUiLCJhdXRoIiwidXNlciIsInBhc3MiLCJ0bHMiLCJyZWplY3RVbmF1dGhvcml6ZWQiLCJzZW5kVmVyaWZpY2F0aW9uRW1haWwiLCJlbWFpbCIsInRva2VuIiwidHJhbnNwb3J0ZXIiLCJzdWNjZXNzIiwiZXJyb3IiLCJ2ZXJpZmljYXRpb25VcmwiLCJORVhUX1BVQkxJQ19BUFBfVVJMIiwibWFpbE9wdGlvbnMiLCJmcm9tIiwidG8iLCJzdWJqZWN0IiwiaHRtbCIsImluZm8iLCJzZW5kTWFpbCIsImxvZyIsIm1lc3NhZ2VJZCIsInNlbmRQYXNzd29yZFJlc2V0RW1haWwiLCJyZXNldFVybCIsInNlbmRNYWdpY0xpbmtFbWFpbCIsInR5cGUiLCJtZXRhZGF0YSIsInRpdGxlIiwiZGVzY3JpcHRpb24iLCJ1c2VyVHlwZSIsInVzZXJfdHlwZSIsImZpcnN0X25hbWUiXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./lib/email.ts\n");

/***/ }),

/***/ "(rsc)/./lib/rate-limit.ts":
/*!***************************!*\
  !*** ./lib/rate-limit.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   RateLimiter: () => (/* binding */ RateLimiter),\n/* harmony export */   withRateLimit: () => (/* binding */ withRateLimit)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\nconst supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://frzciymslvpohhyefmtr.supabase.co\" || 0, process.env.SUPABASE_SERVICE_ROLE_KEY || '');\n/**\n * Rate limiting system for authentication endpoints\n * Prevents brute force attacks and abuse\n */ class RateLimiter {\n    /**\n   * Check if rate limit is exceeded\n   * Returns true if allowed, false if rate limited\n   */ static async checkLimit(config) {\n        const { maxAttempts, windowMs, identifier, action } = config;\n        const now = new Date();\n        const windowStart = new Date(now.getTime() - windowMs);\n        try {\n            // Count recent attempts\n            const { data: attempts, error } = await supabase.from('rate_limit_attempts').select('id').eq('identifier', identifier).eq('action', action).gte('created_at', windowStart.toISOString());\n            if (error) {\n                console.error('‚ùå Rate limit check error:', error);\n                // On error, allow request (fail open for better UX)\n                return true;\n            }\n            const attemptCount = attempts?.length || 0;\n            console.log(`üîç Rate limit check: ${attemptCount}/${maxAttempts} attempts for ${action} by ${identifier}`);\n            if (attemptCount >= maxAttempts) {\n                console.warn(`‚ö†Ô∏è Rate limit exceeded: ${action} by ${identifier}`);\n                return false;\n            }\n            // Log this attempt\n            await supabase.from('rate_limit_attempts').insert({\n                identifier,\n                action,\n                created_at: now.toISOString(),\n                ip_address: identifier.includes('.') ? identifier : null // Store IP if identifier is an IP\n            });\n            return true;\n        } catch (error) {\n            console.error('‚ùå Rate limit error:', error);\n            // Fail open - allow request if rate limiting fails\n            return true;\n        }\n    }\n    /**\n   * Check magic link requests\n   * 10 requests per hour per email\n   */ static async checkMagicLinkRequest(email) {\n        return this.checkLimit({\n            identifier: email.toLowerCase(),\n            action: 'magic_link_request',\n            maxAttempts: 10,\n            windowMs: 60 * 60 * 1000 // 1 hour\n        });\n    }\n    /**\n   * Check authentication attempts from IP\n   * 100 attempts per hour per IP\n   */ static async checkAuthAttempts(ipAddress) {\n        return this.checkLimit({\n            identifier: ipAddress,\n            action: 'auth_attempt',\n            maxAttempts: 100,\n            windowMs: 60 * 60 * 1000 // 1 hour\n        });\n    }\n    /**\n   * Check failed validation attempts\n   * 5 failures per minute per session\n   */ static async checkFailedValidation(sessionId) {\n        return this.checkLimit({\n            identifier: sessionId,\n            action: 'failed_validation',\n            maxAttempts: 5,\n            windowMs: 60 * 1000 // 1 minute\n        });\n    }\n    /**\n   * Check magic link verification attempts\n   * 3 attempts per token (prevent brute force)\n   */ static async checkMagicLinkVerification(token) {\n        return this.checkLimit({\n            identifier: `token_${token}`,\n            action: 'magic_link_verify',\n            maxAttempts: 3,\n            windowMs: 60 * 60 * 1000 // 1 hour\n        });\n    }\n    /**\n   * Clean up old rate limit records\n   * Should be run periodically (e.g., via cron job)\n   */ static async cleanup() {\n        const oneDayAgo = new Date(Date.now() - 24 * 60 * 60 * 1000);\n        try {\n            const { error } = await supabase.from('rate_limit_attempts').delete().lt('created_at', oneDayAgo.toISOString());\n            if (error) {\n                console.error('‚ùå Rate limit cleanup error:', error);\n            } else {\n                console.log('‚úÖ Rate limit records cleaned up');\n            }\n        } catch (error) {\n            console.error('‚ùå Rate limit cleanup failed:', error);\n        }\n    }\n    /**\n   * Get remaining attempts for an action\n   * Useful for showing users how many attempts they have left\n   */ static async getRemainingAttempts(config) {\n        const { maxAttempts, windowMs, identifier, action } = config;\n        const windowStart = new Date(Date.now() - windowMs);\n        try {\n            const { data: attempts, error } = await supabase.from('rate_limit_attempts').select('id').eq('identifier', identifier).eq('action', action).gte('created_at', windowStart.toISOString());\n            if (error) {\n                return maxAttempts // On error, assume full attempts available\n                ;\n            }\n            const attemptCount = attempts?.length || 0;\n            return Math.max(0, maxAttempts - attemptCount);\n        } catch (error) {\n            return maxAttempts;\n        }\n    }\n}\n/**\n * Middleware helper for rate limiting in API routes\n */ async function withRateLimit(identifier, action, maxAttempts, windowMs, handler) {\n    const allowed = await RateLimiter.checkLimit({\n        identifier,\n        action,\n        maxAttempts,\n        windowMs\n    });\n    if (!allowed) {\n        throw new Error('RATE_LIMIT_EXCEEDED: Too many requests. Please try again later.');\n    }\n    return handler();\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QnlDLE9BQXlCO0lBRXpCLE1BQU1DLFVBQVUsTUFBTTlDLFlBQVlDLFVBQVUsQ0FBQztRQUMzQ0k7UUFDQUM7UUFDQUg7UUFDQUM7SUFDRjtJQUVBLElBQUksQ0FBQzBDLFNBQVM7UUFDWixNQUFNLElBQUlDLE1BQU07SUFDbEI7SUFFQSxPQUFPRjtBQUNUIiwic291cmNlcyI6WyIvVXNlcnMvbWFjYm9vay9EZXNrdG9wL3RycGktYXBwL2xpYi9yYXRlLWxpbWl0LnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcydcblxuY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVDbGllbnQoXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCB8fCAnJyxcbiAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSB8fCAnJ1xuKVxuXG5pbnRlcmZhY2UgUmF0ZUxpbWl0Q29uZmlnIHtcbiAgbWF4QXR0ZW1wdHM6IG51bWJlclxuICB3aW5kb3dNczogbnVtYmVyXG4gIGlkZW50aWZpZXI6IHN0cmluZ1xuICBhY3Rpb246IHN0cmluZ1xufVxuXG4vKipcbiAqIFJhdGUgbGltaXRpbmcgc3lzdGVtIGZvciBhdXRoZW50aWNhdGlvbiBlbmRwb2ludHNcbiAqIFByZXZlbnRzIGJydXRlIGZvcmNlIGF0dGFja3MgYW5kIGFidXNlXG4gKi9cbmV4cG9ydCBjbGFzcyBSYXRlTGltaXRlciB7XG4gIC8qKlxuICAgKiBDaGVjayBpZiByYXRlIGxpbWl0IGlzIGV4Y2VlZGVkXG4gICAqIFJldHVybnMgdHJ1ZSBpZiBhbGxvd2VkLCBmYWxzZSBpZiByYXRlIGxpbWl0ZWRcbiAgICovXG4gIHN0YXRpYyBhc3luYyBjaGVja0xpbWl0KGNvbmZpZzogUmF0ZUxpbWl0Q29uZmlnKTogUHJvbWlzZTxib29sZWFuPiB7XG4gICAgY29uc3QgeyBtYXhBdHRlbXB0cywgd2luZG93TXMsIGlkZW50aWZpZXIsIGFjdGlvbiB9ID0gY29uZmlnXG4gICAgY29uc3Qgbm93ID0gbmV3IERhdGUoKVxuICAgIGNvbnN0IHdpbmRvd1N0YXJ0ID0gbmV3IERhdGUobm93LmdldFRpbWUoKSAtIHdpbmRvd01zKVxuXG4gICAgdHJ5IHtcbiAgICAgIC8vIENvdW50IHJlY2VudCBhdHRlbXB0c1xuICAgICAgY29uc3QgeyBkYXRhOiBhdHRlbXB0cywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdyYXRlX2xpbWl0X2F0dGVtcHRzJylcbiAgICAgICAgLnNlbGVjdCgnaWQnKVxuICAgICAgICAuZXEoJ2lkZW50aWZpZXInLCBpZGVudGlmaWVyKVxuICAgICAgICAuZXEoJ2FjdGlvbicsIGFjdGlvbilcbiAgICAgICAgLmd0ZSgnY3JlYXRlZF9hdCcsIHdpbmRvd1N0YXJ0LnRvSVNPU3RyaW5nKCkpXG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgUmF0ZSBsaW1pdCBjaGVjayBlcnJvcjonLCBlcnJvcilcbiAgICAgICAgLy8gT24gZXJyb3IsIGFsbG93IHJlcXVlc3QgKGZhaWwgb3BlbiBmb3IgYmV0dGVyIFVYKVxuICAgICAgICByZXR1cm4gdHJ1ZVxuICAgICAgfVxuXG4gICAgICBjb25zdCBhdHRlbXB0Q291bnQgPSBhdHRlbXB0cz8ubGVuZ3RoIHx8IDBcbiAgICAgIGNvbnNvbGUubG9nKGDwn5SNIFJhdGUgbGltaXQgY2hlY2s6ICR7YXR0ZW1wdENvdW50fS8ke21heEF0dGVtcHRzfSBhdHRlbXB0cyBmb3IgJHthY3Rpb259IGJ5ICR7aWRlbnRpZmllcn1gKVxuXG4gICAgICBpZiAoYXR0ZW1wdENvdW50ID49IG1heEF0dGVtcHRzKSB7XG4gICAgICAgIGNvbnNvbGUud2Fybihg4pqg77iPIFJhdGUgbGltaXQgZXhjZWVkZWQ6ICR7YWN0aW9ufSBieSAke2lkZW50aWZpZXJ9YClcbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgICB9XG5cbiAgICAgIC8vIExvZyB0aGlzIGF0dGVtcHRcbiAgICAgIGF3YWl0IHN1cGFiYXNlXG4gICAgICAgIC5mcm9tKCdyYXRlX2xpbWl0X2F0dGVtcHRzJylcbiAgICAgICAgLmluc2VydCh7XG4gICAgICAgICAgaWRlbnRpZmllcixcbiAgICAgICAgICBhY3Rpb24sXG4gICAgICAgICAgY3JlYXRlZF9hdDogbm93LnRvSVNPU3RyaW5nKCksXG4gICAgICAgICAgaXBfYWRkcmVzczogaWRlbnRpZmllci5pbmNsdWRlcygnLicpID8gaWRlbnRpZmllciA6IG51bGwgLy8gU3RvcmUgSVAgaWYgaWRlbnRpZmllciBpcyBhbiBJUFxuICAgICAgICB9KVxuXG4gICAgICByZXR1cm4gdHJ1ZVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgUmF0ZSBsaW1pdCBlcnJvcjonLCBlcnJvcilcbiAgICAgIC8vIEZhaWwgb3BlbiAtIGFsbG93IHJlcXVlc3QgaWYgcmF0ZSBsaW1pdGluZyBmYWlsc1xuICAgICAgcmV0dXJuIHRydWVcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgbWFnaWMgbGluayByZXF1ZXN0c1xuICAgKiAxMCByZXF1ZXN0cyBwZXIgaG91ciBwZXIgZW1haWxcbiAgICovXG4gIHN0YXRpYyBhc3luYyBjaGVja01hZ2ljTGlua1JlcXVlc3QoZW1haWw6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmNoZWNrTGltaXQoe1xuICAgICAgaWRlbnRpZmllcjogZW1haWwudG9Mb3dlckNhc2UoKSxcbiAgICAgIGFjdGlvbjogJ21hZ2ljX2xpbmtfcmVxdWVzdCcsXG4gICAgICBtYXhBdHRlbXB0czogMTAsXG4gICAgICB3aW5kb3dNczogNjAgKiA2MCAqIDEwMDAgLy8gMSBob3VyXG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBhdXRoZW50aWNhdGlvbiBhdHRlbXB0cyBmcm9tIElQXG4gICAqIDEwMCBhdHRlbXB0cyBwZXIgaG91ciBwZXIgSVBcbiAgICovXG4gIHN0YXRpYyBhc3luYyBjaGVja0F1dGhBdHRlbXB0cyhpcEFkZHJlc3M6IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmNoZWNrTGltaXQoe1xuICAgICAgaWRlbnRpZmllcjogaXBBZGRyZXNzLFxuICAgICAgYWN0aW9uOiAnYXV0aF9hdHRlbXB0JyxcbiAgICAgIG1heEF0dGVtcHRzOiAxMDAsXG4gICAgICB3aW5kb3dNczogNjAgKiA2MCAqIDEwMDAgLy8gMSBob3VyXG4gICAgfSlcbiAgfVxuXG4gIC8qKlxuICAgKiBDaGVjayBmYWlsZWQgdmFsaWRhdGlvbiBhdHRlbXB0c1xuICAgKiA1IGZhaWx1cmVzIHBlciBtaW51dGUgcGVyIHNlc3Npb25cbiAgICovXG4gIHN0YXRpYyBhc3luYyBjaGVja0ZhaWxlZFZhbGlkYXRpb24oc2Vzc2lvbklkOiBzdHJpbmcpOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICByZXR1cm4gdGhpcy5jaGVja0xpbWl0KHtcbiAgICAgIGlkZW50aWZpZXI6IHNlc3Npb25JZCxcbiAgICAgIGFjdGlvbjogJ2ZhaWxlZF92YWxpZGF0aW9uJyxcbiAgICAgIG1heEF0dGVtcHRzOiA1LFxuICAgICAgd2luZG93TXM6IDYwICogMTAwMCAvLyAxIG1pbnV0ZVxuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogQ2hlY2sgbWFnaWMgbGluayB2ZXJpZmljYXRpb24gYXR0ZW1wdHNcbiAgICogMyBhdHRlbXB0cyBwZXIgdG9rZW4gKHByZXZlbnQgYnJ1dGUgZm9yY2UpXG4gICAqL1xuICBzdGF0aWMgYXN5bmMgY2hlY2tNYWdpY0xpbmtWZXJpZmljYXRpb24odG9rZW46IHN0cmluZyk6IFByb21pc2U8Ym9vbGVhbj4ge1xuICAgIHJldHVybiB0aGlzLmNoZWNrTGltaXQoe1xuICAgICAgaWRlbnRpZmllcjogYHRva2VuXyR7dG9rZW59YCxcbiAgICAgIGFjdGlvbjogJ21hZ2ljX2xpbmtfdmVyaWZ5JyxcbiAgICAgIG1heEF0dGVtcHRzOiAzLFxuICAgICAgd2luZG93TXM6IDYwICogNjAgKiAxMDAwIC8vIDEgaG91clxuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogQ2xlYW4gdXAgb2xkIHJhdGUgbGltaXQgcmVjb3Jkc1xuICAgKiBTaG91bGQgYmUgcnVuIHBlcmlvZGljYWxseSAoZS5nLiwgdmlhIGNyb24gam9iKVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGNsZWFudXAoKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgY29uc3Qgb25lRGF5QWdvID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIDI0ICogNjAgKiA2MCAqIDEwMDApXG5cbiAgICB0cnkge1xuICAgICAgY29uc3QgeyBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3JhdGVfbGltaXRfYXR0ZW1wdHMnKVxuICAgICAgICAuZGVsZXRlKClcbiAgICAgICAgLmx0KCdjcmVhdGVkX2F0Jywgb25lRGF5QWdvLnRvSVNPU3RyaW5nKCkpXG5cbiAgICAgIGlmIChlcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCfinYwgUmF0ZSBsaW1pdCBjbGVhbnVwIGVycm9yOicsIGVycm9yKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ+KchSBSYXRlIGxpbWl0IHJlY29yZHMgY2xlYW5lZCB1cCcpXG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBSYXRlIGxpbWl0IGNsZWFudXAgZmFpbGVkOicsIGVycm9yKVxuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgcmVtYWluaW5nIGF0dGVtcHRzIGZvciBhbiBhY3Rpb25cbiAgICogVXNlZnVsIGZvciBzaG93aW5nIHVzZXJzIGhvdyBtYW55IGF0dGVtcHRzIHRoZXkgaGF2ZSBsZWZ0XG4gICAqL1xuICBzdGF0aWMgYXN5bmMgZ2V0UmVtYWluaW5nQXR0ZW1wdHMoY29uZmlnOiBSYXRlTGltaXRDb25maWcpOiBQcm9taXNlPG51bWJlcj4ge1xuICAgIGNvbnN0IHsgbWF4QXR0ZW1wdHMsIHdpbmRvd01zLCBpZGVudGlmaWVyLCBhY3Rpb24gfSA9IGNvbmZpZ1xuICAgIGNvbnN0IHdpbmRvd1N0YXJ0ID0gbmV3IERhdGUoRGF0ZS5ub3coKSAtIHdpbmRvd01zKVxuXG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IHsgZGF0YTogYXR0ZW1wdHMsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAuZnJvbSgncmF0ZV9saW1pdF9hdHRlbXB0cycpXG4gICAgICAgIC5zZWxlY3QoJ2lkJylcbiAgICAgICAgLmVxKCdpZGVudGlmaWVyJywgaWRlbnRpZmllcilcbiAgICAgICAgLmVxKCdhY3Rpb24nLCBhY3Rpb24pXG4gICAgICAgIC5ndGUoJ2NyZWF0ZWRfYXQnLCB3aW5kb3dTdGFydC50b0lTT1N0cmluZygpKVxuXG4gICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgcmV0dXJuIG1heEF0dGVtcHRzIC8vIE9uIGVycm9yLCBhc3N1bWUgZnVsbCBhdHRlbXB0cyBhdmFpbGFibGVcbiAgICAgIH1cblxuICAgICAgY29uc3QgYXR0ZW1wdENvdW50ID0gYXR0ZW1wdHM/Lmxlbmd0aCB8fCAwXG4gICAgICByZXR1cm4gTWF0aC5tYXgoMCwgbWF4QXR0ZW1wdHMgLSBhdHRlbXB0Q291bnQpXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBtYXhBdHRlbXB0c1xuICAgIH1cbiAgfVxufVxuXG4vKipcbiAqIE1pZGRsZXdhcmUgaGVscGVyIGZvciByYXRlIGxpbWl0aW5nIGluIEFQSSByb3V0ZXNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHdpdGhSYXRlTGltaXQ8VD4oXG4gIGlkZW50aWZpZXI6IHN0cmluZyxcbiAgYWN0aW9uOiBzdHJpbmcsXG4gIG1heEF0dGVtcHRzOiBudW1iZXIsXG4gIHdpbmRvd01zOiBudW1iZXIsXG4gIGhhbmRsZXI6ICgpID0+IFByb21pc2U8VD5cbik6IFByb21pc2U8VD4ge1xuICBjb25zdCBhbGxvd2VkID0gYXdhaXQgUmF0ZUxpbWl0ZXIuY2hlY2tMaW1pdCh7XG4gICAgaWRlbnRpZmllcixcbiAgICBhY3Rpb24sXG4gICAgbWF4QXR0ZW1wdHMsXG4gICAgd2luZG93TXNcbiAgfSlcblxuICBpZiAoIWFsbG93ZWQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1JBVEVfTElNSVRfRVhDRUVERUQ6IFRvbyBtYW55IHJlcXVlc3RzLiBQbGVhc2UgdHJ5IGFnYWluIGxhdGVyLicpXG4gIH1cblxuICByZXR1cm4gaGFuZGxlcigpXG59XG5cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJzdXBhYmFzZSIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiUmF0ZUxpbWl0ZXIiLCJjaGVja0xpbWl0IiwiY29uZmlnIiwibWF4QXR0ZW1wdHMiLCJ3aW5kb3dNcyIsImlkZW50aWZpZXIiLCJhY3Rpb24iLCJub3ciLCJEYXRlIiwid2luZG93U3RhcnQiLCJnZXRUaW1lIiwiZGF0YSIsImF0dGVtcHRzIiwiZXJyb3IiLCJmcm9tIiwic2VsZWN0IiwiZXEiLCJndGUiLCJ0b0lTT1N0cmluZyIsImNvbnNvbGUiLCJhdHRlbXB0Q291bnQiLCJsZW5ndGgiLCJsb2ciLCJ3YXJuIiwiaW5zZXJ0IiwiY3JlYXRlZF9hdCIsImlwX2FkZHJlc3MiLCJpbmNsdWRlcyIsImNoZWNrTWFnaWNMaW5rUmVxdWVzdCIsImVtYWlsIiwidG9Mb3dlckNhc2UiLCJjaGVja0F1dGhBdHRlbXB0cyIsImlwQWRkcmVzcyIsImNoZWNrRmFpbGVkVmFsaWRhdGlvbiIsInNlc3Npb25JZCIsImNoZWNrTWFnaWNMaW5rVmVyaWZpY2F0aW9uIiwidG9rZW4iLCJjbGVhbnVwIiwib25lRGF5QWdvIiwiZGVsZXRlIiwibHQiLCJnZXRSZW1haW5pbmdBdHRlbXB0cyIsIk1hdGgiLCJtYXgiLCJ3aXRoUmF0ZUxpbWl0IiwiaGFuZGxlciIsImFsbG93ZWQiLCJFcnJvciJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/rate-limit.ts\n");

/***/ }),

/***/ "(rsc)/./lib/session-manager.ts":
/*!********************************!*\
  !*** ./lib/session-manager.ts ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   SessionManager: () => (/* binding */ SessionManager),\n/* harmony export */   requireAuth: () => (/* binding */ requireAuth)\n/* harmony export */ });\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! jose */ \"(rsc)/./node_modules/jose/dist/webapi/jwt/sign.js\");\n/* harmony import */ var jose__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! jose */ \"(rsc)/./node_modules/jose/dist/webapi/jwt/verify.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n\n\n\nconst JWT_SECRET = new TextEncoder().encode(process.env.JWT_SECRET || 'trpi-super-secret-key-2024-therapy-platform');\nclass SessionManager {\n    static{\n        this.COOKIE_NAME = 'quiet_session';\n    }\n    static{\n        this.MAX_AGE = 24 * 60 * 60 * 1000 // 24 hours (healthcare-grade security)\n        ;\n    }\n    static{\n        this.REFRESH_WINDOW = 6 * 60 * 60 * 1000 // Refresh if < 6 hours left\n        ;\n    }\n    static{\n        this.GRACE_PERIOD = 30 * 60 * 1000 // 30 minutes grace after expiry\n        ;\n    }\n    static{\n        this.ABSOLUTE_MAX_AGE = 30 * 24 * 60 * 60 * 1000 // 30 days absolute maximum\n        ;\n    }\n    /**\n   * Create a new session and set the cookie\n   */ static async createSession(sessionData) {\n        const token = await new jose__WEBPACK_IMPORTED_MODULE_2__.SignJWT(sessionData).setProtectedHeader({\n            alg: 'HS256'\n        }).setIssuedAt().setExpirationTime('24h') // Healthcare-grade: 24 hours\n        .sign(JWT_SECRET);\n        // Set the cookie\n        const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n        cookieStore.set(this.COOKIE_NAME, token, {\n            httpOnly: true,\n            secure: \"development\" === 'production',\n            sameSite: 'lax',\n            maxAge: this.MAX_AGE,\n            path: '/'\n        });\n        return token;\n    }\n    /**\n   * Get the current session from the cookie\n   */ static async getSession() {\n        try {\n            const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n            const token = cookieStore.get(this.COOKIE_NAME)?.value;\n            if (!token) {\n                console.log('üîç No session cookie found');\n                return null;\n            }\n            console.log('üç™ Raw cookie value:', token.substring(0, 50) + '...');\n            const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtVerify)(token, JWT_SECRET);\n            const sessionData = payload;\n            // Basic validation\n            if (!sessionData.id || !sessionData.email) {\n                console.error('‚ùå Invalid session data structure');\n                return null;\n            }\n            console.log('‚úÖ Session validated for user:', sessionData.email);\n            return sessionData;\n        } catch (error) {\n            // Distinguish between expired and invalid tokens\n            if (error?.code === 'ERR_JWT_EXPIRED' || error?.message?.includes('exp')) {\n                console.log('‚è∞ Session token expired');\n            } else {\n                console.error('‚ùå Session retrieval error:', error);\n            }\n            return null;\n        }\n    }\n    /**\n   * Get session with automatic refresh if nearing expiration\n   */ static async getSessionWithRefresh() {\n        try {\n            const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n            const token = cookieStore.get(this.COOKIE_NAME)?.value;\n            if (!token) {\n                console.log('üîç No session cookie found');\n                return null;\n            }\n            try {\n                const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtVerify)(token, JWT_SECRET);\n                const sessionData = payload;\n                // Check if token is nearing expiration (less than 6 hours remaining)\n                const expiryTime = (payload.exp || 0) * 1000;\n                const timeUntilExpiry = expiryTime - Date.now();\n                if (timeUntilExpiry < this.REFRESH_WINDOW && timeUntilExpiry > 0) {\n                    console.log('üîÑ Session nearing expiration, refreshing...');\n                    // Refresh the session\n                    await this.createSession(sessionData);\n                    console.log('‚úÖ Session refreshed successfully');\n                }\n                return sessionData;\n            } catch (error) {\n                // If token is expired but within grace period (30 minutes), allow refresh\n                if (error?.code === 'ERR_JWT_EXPIRED' || error?.message?.includes('exp')) {\n                    console.log('‚è∞ Token expired, checking if within grace period...');\n                    try {\n                        // Decode without verification to check expiry time\n                        const decoded = JSON.parse(Buffer.from(token.split('.')[1], 'base64').toString());\n                        const expiryTime = decoded.exp * 1000;\n                        const timeSinceExpiry = Date.now() - expiryTime;\n                        // Allow refresh if expired less than 30 minutes ago (grace period)\n                        if (timeSinceExpiry < this.GRACE_PERIOD && timeSinceExpiry > 0) {\n                            console.log('‚úÖ Within 30-minute grace period, refreshing session...');\n                            const sessionData = decoded;\n                            await this.createSession(sessionData);\n                            return sessionData;\n                        } else {\n                            console.log('‚ùå Expired beyond grace period, cannot refresh');\n                        }\n                    } catch (decodeError) {\n                        console.error('‚ùå Error decoding expired token:', decodeError);\n                    }\n                }\n                console.error('‚ùå Session retrieval error:', error);\n                return null;\n            }\n        } catch (error) {\n            console.error('‚ùå Session refresh error:', error);\n            return null;\n        }\n    }\n    /**\n   * Get session from request (for API routes)\n   */ static async getSessionFromRequest(request) {\n        try {\n            const sessionCookie = request.cookies.get(this.COOKIE_NAME)?.value;\n            if (!sessionCookie) {\n                console.log('üîç No session cookie found');\n                return null;\n            }\n            console.log('üç™ Raw cookie value:', sessionCookie.substring(0, 50) + '...');\n            // Verify JWT token\n            const { payload } = await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtVerify)(sessionCookie, JWT_SECRET);\n            const sessionData = payload;\n            // Basic validation\n            if (!sessionData.id || !sessionData.email) {\n                console.error('‚ùå Invalid session data structure');\n                return null;\n            }\n            console.log('‚úÖ Session found for user:', sessionData.email);\n            return sessionData;\n        } catch (error) {\n            console.error('‚ùå Session retrieval error:', error);\n            return null;\n        }\n    }\n    /**\n   * Clear the session cookie\n   */ static async clearSession() {\n        const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n        cookieStore.delete(this.COOKIE_NAME);\n    }\n    /**\n   * Clear expired session cookie from request\n   */ static async clearExpiredSession(request) {\n        const token = request.cookies.get(this.COOKIE_NAME)?.value;\n        if (token) {\n            try {\n                await (0,jose__WEBPACK_IMPORTED_MODULE_3__.jwtVerify)(token, JWT_SECRET);\n            } catch (error) {\n                // Token is expired or invalid, clear it\n                if (error instanceof Error && error.message.includes('exp')) {\n                    const response = next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.next();\n                    response.cookies.delete(this.COOKIE_NAME);\n                    return;\n                }\n            }\n        }\n    }\n    /**\n   * Update session data (useful for profile updates)\n   */ static async updateSession(updates) {\n        const currentSession = await this.getSession();\n        if (!currentSession) {\n            return null;\n        }\n        const updatedSession = {\n            ...currentSession,\n            ...updates\n        };\n        await this.createSession(updatedSession);\n        return updatedSession;\n    }\n    /**\n   * Check if user has specific role\n   */ static async hasRole(role) {\n        const session = await this.getSession();\n        return session?.role === role;\n    }\n    /**\n   * Require specific role (throws if not authorized)\n   */ static async requireRole(role) {\n        const session = await this.getSession();\n        if (!session || session.role !== role) {\n            throw new Error(`Access denied. Required role: ${role}`);\n        }\n        return session;\n    }\n}\n/**\n * Middleware helper for API routes\n */ async function requireAuth(requiredRole) {\n    return async (request)=>{\n        const session = await SessionManager.getSessionFromRequest(request);\n        if (!session) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                error: 'Authentication required'\n            }, {\n                status: 401\n            });\n        }\n        if (requiredRole && session.role !== requiredRole) {\n            return next_server__WEBPACK_IMPORTED_MODULE_1__.NextResponse.json({\n                error: `Access denied. Required role: ${requiredRole}`\n            }, {\n                status: 403\n            });\n        }\n        return {\n            session\n        };\n    };\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFBZ0JILFFBQVFELElBQUksS0FBS0ksY0FBYztZQUNqRCxPQUFPekUscURBQVlBLENBQUMwRSxJQUFJLENBQUM7Z0JBQUV0QyxPQUFPLENBQUMsOEJBQThCLEVBQUVxQyxjQUFjO1lBQUMsR0FBRztnQkFBRUUsUUFBUTtZQUFJO1FBQ3JHO1FBRUEsT0FBTztZQUFFTDtRQUFRO0lBQ25CO0FBQ0YiLCJzb3VyY2VzIjpbIi9Vc2Vycy9tYWNib29rL0Rlc2t0b3AvdHJwaS1hcHAvbGliL3Nlc3Npb24tbWFuYWdlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBTaWduSldULCBqd3RWZXJpZnkgfSBmcm9tICdqb3NlJ1xuaW1wb3J0IHsgY29va2llcyB9IGZyb20gJ25leHQvaGVhZGVycydcbmltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcidcblxuY29uc3QgSldUX1NFQ1JFVCA9IG5ldyBUZXh0RW5jb2RlcigpLmVuY29kZShwcm9jZXNzLmVudi5KV1RfU0VDUkVUIHx8ICd0cnBpLXN1cGVyLXNlY3JldC1rZXktMjAyNC10aGVyYXB5LXBsYXRmb3JtJylcblxuZXhwb3J0IGludGVyZmFjZSBTZXNzaW9uRGF0YSB7XG4gIGlkOiBzdHJpbmdcbiAgZW1haWw6IHN0cmluZ1xuICBuYW1lOiBzdHJpbmdcbiAgcm9sZTogJ2luZGl2aWR1YWwnIHwgJ3RoZXJhcGlzdCcgfCAncGFydG5lcicgfCAnYWRtaW4nXG4gIHVzZXJfdHlwZTogc3RyaW5nXG4gIGlzX3ZlcmlmaWVkOiBib29sZWFuXG4gIGlzX2FjdGl2ZTogYm9vbGVhblxuICBzZXNzaW9uX3Rva2VuPzogc3RyaW5nXG59XG5cbmV4cG9ydCBjbGFzcyBTZXNzaW9uTWFuYWdlciB7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IENPT0tJRV9OQU1FID0gJ3F1aWV0X3Nlc3Npb24nXG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IE1BWF9BR0UgPSAyNCAqIDYwICogNjAgKiAxMDAwIC8vIDI0IGhvdXJzIChoZWFsdGhjYXJlLWdyYWRlIHNlY3VyaXR5KVxuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBSRUZSRVNIX1dJTkRPVyA9IDYgKiA2MCAqIDYwICogMTAwMCAvLyBSZWZyZXNoIGlmIDwgNiBob3VycyBsZWZ0XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEdSQUNFX1BFUklPRCA9IDMwICogNjAgKiAxMDAwIC8vIDMwIG1pbnV0ZXMgZ3JhY2UgYWZ0ZXIgZXhwaXJ5XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEFCU09MVVRFX01BWF9BR0UgPSAzMCAqIDI0ICogNjAgKiA2MCAqIDEwMDAgLy8gMzAgZGF5cyBhYnNvbHV0ZSBtYXhpbXVtXG5cbiAgLyoqXG4gICAqIENyZWF0ZSBhIG5ldyBzZXNzaW9uIGFuZCBzZXQgdGhlIGNvb2tpZVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGNyZWF0ZVNlc3Npb24oc2Vzc2lvbkRhdGE6IFNlc3Npb25EYXRhKTogUHJvbWlzZTxzdHJpbmc+IHtcbiAgICBjb25zdCB0b2tlbiA9IGF3YWl0IG5ldyBTaWduSldUKHNlc3Npb25EYXRhIGFzIGFueSlcbiAgICAgIC5zZXRQcm90ZWN0ZWRIZWFkZXIoeyBhbGc6ICdIUzI1NicgfSlcbiAgICAgIC5zZXRJc3N1ZWRBdCgpXG4gICAgICAuc2V0RXhwaXJhdGlvblRpbWUoJzI0aCcpIC8vIEhlYWx0aGNhcmUtZ3JhZGU6IDI0IGhvdXJzXG4gICAgICAuc2lnbihKV1RfU0VDUkVUKVxuXG4gICAgLy8gU2V0IHRoZSBjb29raWVcbiAgICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKVxuICAgIGNvb2tpZVN0b3JlLnNldCh0aGlzLkNPT0tJRV9OQU1FLCB0b2tlbiwge1xuICAgICAgaHR0cE9ubHk6IHRydWUsXG4gICAgICBzZWN1cmU6IHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAncHJvZHVjdGlvbicsXG4gICAgICBzYW1lU2l0ZTogJ2xheCcsXG4gICAgICBtYXhBZ2U6IHRoaXMuTUFYX0FHRSwgLy8gMjQgaG91cnNcbiAgICAgIHBhdGg6ICcvJ1xuICAgIH0pXG5cbiAgICByZXR1cm4gdG9rZW5cbiAgfVxuXG4gIC8qKlxuICAgKiBHZXQgdGhlIGN1cnJlbnQgc2Vzc2lvbiBmcm9tIHRoZSBjb29raWVcbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRTZXNzaW9uKCk6IFByb21pc2U8U2Vzc2lvbkRhdGEgfCBudWxsPiB7XG4gICAgdHJ5IHtcbiAgICAgIGNvbnN0IGNvb2tpZVN0b3JlID0gYXdhaXQgY29va2llcygpXG4gICAgICBjb25zdCB0b2tlbiA9IGNvb2tpZVN0b3JlLmdldCh0aGlzLkNPT0tJRV9OQU1FKT8udmFsdWVcblxuICAgICAgaWYgKCF0b2tlbikge1xuICAgICAgICBjb25zb2xlLmxvZygn8J+UjSBObyBzZXNzaW9uIGNvb2tpZSBmb3VuZCcpXG4gICAgICAgIHJldHVybiBudWxsXG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCfwn42qIFJhdyBjb29raWUgdmFsdWU6JywgdG9rZW4uc3Vic3RyaW5nKDAsIDUwKSArICcuLi4nKVxuXG4gICAgICBjb25zdCB7IHBheWxvYWQgfSA9IGF3YWl0IGp3dFZlcmlmeSh0b2tlbiwgSldUX1NFQ1JFVClcbiAgICAgIGNvbnN0IHNlc3Npb25EYXRhID0gcGF5bG9hZCBhcyBhbnkgYXMgU2Vzc2lvbkRhdGFcblxuICAgICAgLy8gQmFzaWMgdmFsaWRhdGlvblxuICAgICAgaWYgKCFzZXNzaW9uRGF0YS5pZCB8fCAhc2Vzc2lvbkRhdGEuZW1haWwpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEludmFsaWQgc2Vzc2lvbiBkYXRhIHN0cnVjdHVyZScpXG4gICAgICAgIHJldHVybiBudWxsXG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCfinIUgU2Vzc2lvbiB2YWxpZGF0ZWQgZm9yIHVzZXI6Jywgc2Vzc2lvbkRhdGEuZW1haWwpXG4gICAgICByZXR1cm4gc2Vzc2lvbkRhdGFcbiAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAvLyBEaXN0aW5ndWlzaCBiZXR3ZWVuIGV4cGlyZWQgYW5kIGludmFsaWQgdG9rZW5zXG4gICAgICBpZiAoZXJyb3I/LmNvZGUgPT09ICdFUlJfSldUX0VYUElSRUQnIHx8IGVycm9yPy5tZXNzYWdlPy5pbmNsdWRlcygnZXhwJykpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ+KPsCBTZXNzaW9uIHRva2VuIGV4cGlyZWQnKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFNlc3Npb24gcmV0cmlldmFsIGVycm9yOicsIGVycm9yKVxuICAgICAgfVxuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNlc3Npb24gd2l0aCBhdXRvbWF0aWMgcmVmcmVzaCBpZiBuZWFyaW5nIGV4cGlyYXRpb25cbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRTZXNzaW9uV2l0aFJlZnJlc2goKTogUHJvbWlzZTxTZXNzaW9uRGF0YSB8IG51bGw+IHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKClcbiAgICAgIGNvbnN0IHRva2VuID0gY29va2llU3RvcmUuZ2V0KHRoaXMuQ09PS0lFX05BTUUpPy52YWx1ZVxuXG4gICAgICBpZiAoIXRva2VuKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIE5vIHNlc3Npb24gY29va2llIGZvdW5kJylcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cblxuICAgICAgdHJ5IHtcbiAgICAgICAgY29uc3QgeyBwYXlsb2FkIH0gPSBhd2FpdCBqd3RWZXJpZnkodG9rZW4sIEpXVF9TRUNSRVQpXG4gICAgICAgIGNvbnN0IHNlc3Npb25EYXRhID0gcGF5bG9hZCBhcyBhbnkgYXMgU2Vzc2lvbkRhdGFcblxuICAgICAgICAvLyBDaGVjayBpZiB0b2tlbiBpcyBuZWFyaW5nIGV4cGlyYXRpb24gKGxlc3MgdGhhbiA2IGhvdXJzIHJlbWFpbmluZylcbiAgICAgICAgY29uc3QgZXhwaXJ5VGltZSA9IChwYXlsb2FkLmV4cCB8fCAwKSAqIDEwMDBcbiAgICAgICAgY29uc3QgdGltZVVudGlsRXhwaXJ5ID0gZXhwaXJ5VGltZSAtIERhdGUubm93KClcblxuICAgICAgICBpZiAodGltZVVudGlsRXhwaXJ5IDwgdGhpcy5SRUZSRVNIX1dJTkRPVyAmJiB0aW1lVW50aWxFeHBpcnkgPiAwKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ/CflIQgU2Vzc2lvbiBuZWFyaW5nIGV4cGlyYXRpb24sIHJlZnJlc2hpbmcuLi4nKVxuICAgICAgICAgIC8vIFJlZnJlc2ggdGhlIHNlc3Npb25cbiAgICAgICAgICBhd2FpdCB0aGlzLmNyZWF0ZVNlc3Npb24oc2Vzc2lvbkRhdGEpXG4gICAgICAgICAgY29uc29sZS5sb2coJ+KchSBTZXNzaW9uIHJlZnJlc2hlZCBzdWNjZXNzZnVsbHknKVxuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHNlc3Npb25EYXRhXG4gICAgICB9IGNhdGNoIChlcnJvcjogYW55KSB7XG4gICAgICAgIC8vIElmIHRva2VuIGlzIGV4cGlyZWQgYnV0IHdpdGhpbiBncmFjZSBwZXJpb2QgKDMwIG1pbnV0ZXMpLCBhbGxvdyByZWZyZXNoXG4gICAgICAgIGlmIChlcnJvcj8uY29kZSA9PT0gJ0VSUl9KV1RfRVhQSVJFRCcgfHwgZXJyb3I/Lm1lc3NhZ2U/LmluY2x1ZGVzKCdleHAnKSkge1xuICAgICAgICAgIGNvbnNvbGUubG9nKCfij7AgVG9rZW4gZXhwaXJlZCwgY2hlY2tpbmcgaWYgd2l0aGluIGdyYWNlIHBlcmlvZC4uLicpXG4gICAgICAgICAgXG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIC8vIERlY29kZSB3aXRob3V0IHZlcmlmaWNhdGlvbiB0byBjaGVjayBleHBpcnkgdGltZVxuICAgICAgICAgICAgY29uc3QgZGVjb2RlZCA9IEpTT04ucGFyc2UoQnVmZmVyLmZyb20odG9rZW4uc3BsaXQoJy4nKVsxXSwgJ2Jhc2U2NCcpLnRvU3RyaW5nKCkpXG4gICAgICAgICAgICBjb25zdCBleHBpcnlUaW1lID0gZGVjb2RlZC5leHAgKiAxMDAwXG4gICAgICAgICAgICBjb25zdCB0aW1lU2luY2VFeHBpcnkgPSBEYXRlLm5vdygpIC0gZXhwaXJ5VGltZVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBBbGxvdyByZWZyZXNoIGlmIGV4cGlyZWQgbGVzcyB0aGFuIDMwIG1pbnV0ZXMgYWdvIChncmFjZSBwZXJpb2QpXG4gICAgICAgICAgICBpZiAodGltZVNpbmNlRXhwaXJ5IDwgdGhpcy5HUkFDRV9QRVJJT0QgJiYgdGltZVNpbmNlRXhwaXJ5ID4gMCkge1xuICAgICAgICAgICAgICBjb25zb2xlLmxvZygn4pyFIFdpdGhpbiAzMC1taW51dGUgZ3JhY2UgcGVyaW9kLCByZWZyZXNoaW5nIHNlc3Npb24uLi4nKVxuICAgICAgICAgICAgICBjb25zdCBzZXNzaW9uRGF0YSA9IGRlY29kZWQgYXMgU2Vzc2lvbkRhdGFcbiAgICAgICAgICAgICAgYXdhaXQgdGhpcy5jcmVhdGVTZXNzaW9uKHNlc3Npb25EYXRhKVxuICAgICAgICAgICAgICByZXR1cm4gc2Vzc2lvbkRhdGFcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfinYwgRXhwaXJlZCBiZXlvbmQgZ3JhY2UgcGVyaW9kLCBjYW5ub3QgcmVmcmVzaCcpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCAoZGVjb2RlRXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBkZWNvZGluZyBleHBpcmVkIHRva2VuOicsIGRlY29kZUVycm9yKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIFNlc3Npb24gcmV0cmlldmFsIGVycm9yOicsIGVycm9yKVxuICAgICAgICByZXR1cm4gbnVsbFxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgU2Vzc2lvbiByZWZyZXNoIGVycm9yOicsIGVycm9yKVxuICAgICAgcmV0dXJuIG51bGxcbiAgICB9XG4gIH1cblxuICAvKipcbiAgICogR2V0IHNlc3Npb24gZnJvbSByZXF1ZXN0IChmb3IgQVBJIHJvdXRlcylcbiAgICovXG4gIHN0YXRpYyBhc3luYyBnZXRTZXNzaW9uRnJvbVJlcXVlc3QocmVxdWVzdDogTmV4dFJlcXVlc3QpOiBQcm9taXNlPFNlc3Npb25EYXRhIHwgbnVsbD4ge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBzZXNzaW9uQ29va2llID0gcmVxdWVzdC5jb29raWVzLmdldCh0aGlzLkNPT0tJRV9OQU1FKT8udmFsdWVcblxuICAgICAgaWYgKCFzZXNzaW9uQ29va2llKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCfwn5SNIE5vIHNlc3Npb24gY29va2llIGZvdW5kJylcbiAgICAgICAgcmV0dXJuIG51bGxcbiAgICAgIH1cblxuICAgICAgY29uc29sZS5sb2coJ/CfjaogUmF3IGNvb2tpZSB2YWx1ZTonLCBzZXNzaW9uQ29va2llLnN1YnN0cmluZygwLCA1MCkgKyAnLi4uJylcblxuICAgICAgLy8gVmVyaWZ5IEpXVCB0b2tlblxuICAgICAgY29uc3QgeyBwYXlsb2FkIH0gPSBhd2FpdCBqd3RWZXJpZnkoc2Vzc2lvbkNvb2tpZSwgSldUX1NFQ1JFVClcbiAgICAgIGNvbnN0IHNlc3Npb25EYXRhID0gcGF5bG9hZCBhcyBhbnkgYXMgU2Vzc2lvbkRhdGFcblxuICAgICAgLy8gQmFzaWMgdmFsaWRhdGlvblxuICAgICAgaWYgKCFzZXNzaW9uRGF0YS5pZCB8fCAhc2Vzc2lvbkRhdGEuZW1haWwpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEludmFsaWQgc2Vzc2lvbiBkYXRhIHN0cnVjdHVyZScpXG4gICAgICAgIHJldHVybiBudWxsXG4gICAgICB9XG5cbiAgICAgIGNvbnNvbGUubG9nKCfinIUgU2Vzc2lvbiBmb3VuZCBmb3IgdXNlcjonLCBzZXNzaW9uRGF0YS5lbWFpbClcbiAgICAgIHJldHVybiBzZXNzaW9uRGF0YVxuXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBTZXNzaW9uIHJldHJpZXZhbCBlcnJvcjonLCBlcnJvcilcbiAgICAgIHJldHVybiBudWxsXG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIHRoZSBzZXNzaW9uIGNvb2tpZVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIGNsZWFyU2Vzc2lvbigpOiBQcm9taXNlPHZvaWQ+IHtcbiAgICBjb25zdCBjb29raWVTdG9yZSA9IGF3YWl0IGNvb2tpZXMoKVxuICAgIGNvb2tpZVN0b3JlLmRlbGV0ZSh0aGlzLkNPT0tJRV9OQU1FKVxuICB9XG5cbiAgLyoqXG4gICAqIENsZWFyIGV4cGlyZWQgc2Vzc2lvbiBjb29raWUgZnJvbSByZXF1ZXN0XG4gICAqL1xuICBzdGF0aWMgYXN5bmMgY2xlYXJFeHBpcmVkU2Vzc2lvbihyZXF1ZXN0OiBOZXh0UmVxdWVzdCk6IFByb21pc2U8dm9pZD4ge1xuICAgIGNvbnN0IHRva2VuID0gcmVxdWVzdC5jb29raWVzLmdldCh0aGlzLkNPT0tJRV9OQU1FKT8udmFsdWVcbiAgICBpZiAodG9rZW4pIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGF3YWl0IGp3dFZlcmlmeSh0b2tlbiwgSldUX1NFQ1JFVClcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIC8vIFRva2VuIGlzIGV4cGlyZWQgb3IgaW52YWxpZCwgY2xlYXIgaXRcbiAgICAgICAgaWYgKGVycm9yIGluc3RhbmNlb2YgRXJyb3IgJiYgZXJyb3IubWVzc2FnZS5pbmNsdWRlcygnZXhwJykpIHtcbiAgICAgICAgICBjb25zdCByZXNwb25zZSA9IE5leHRSZXNwb25zZS5uZXh0KClcbiAgICAgICAgICByZXNwb25zZS5jb29raWVzLmRlbGV0ZSh0aGlzLkNPT0tJRV9OQU1FKVxuICAgICAgICAgIHJldHVyblxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICAqIFVwZGF0ZSBzZXNzaW9uIGRhdGEgKHVzZWZ1bCBmb3IgcHJvZmlsZSB1cGRhdGVzKVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIHVwZGF0ZVNlc3Npb24odXBkYXRlczogUGFydGlhbDxTZXNzaW9uRGF0YT4pOiBQcm9taXNlPFNlc3Npb25EYXRhIHwgbnVsbD4ge1xuICAgIGNvbnN0IGN1cnJlbnRTZXNzaW9uID0gYXdhaXQgdGhpcy5nZXRTZXNzaW9uKClcbiAgICBpZiAoIWN1cnJlbnRTZXNzaW9uKSB7XG4gICAgICByZXR1cm4gbnVsbFxuICAgIH1cblxuICAgIGNvbnN0IHVwZGF0ZWRTZXNzaW9uID0geyAuLi5jdXJyZW50U2Vzc2lvbiwgLi4udXBkYXRlcyB9XG4gICAgYXdhaXQgdGhpcy5jcmVhdGVTZXNzaW9uKHVwZGF0ZWRTZXNzaW9uKVxuICAgIHJldHVybiB1cGRhdGVkU2Vzc2lvblxuICB9XG5cbiAgLyoqXG4gICAqIENoZWNrIGlmIHVzZXIgaGFzIHNwZWNpZmljIHJvbGVcbiAgICovXG4gIHN0YXRpYyBhc3luYyBoYXNSb2xlKHJvbGU6IFNlc3Npb25EYXRhWydyb2xlJ10pOiBQcm9taXNlPGJvb2xlYW4+IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgdGhpcy5nZXRTZXNzaW9uKClcbiAgICByZXR1cm4gc2Vzc2lvbj8ucm9sZSA9PT0gcm9sZVxuICB9XG5cbiAgLyoqXG4gICAqIFJlcXVpcmUgc3BlY2lmaWMgcm9sZSAodGhyb3dzIGlmIG5vdCBhdXRob3JpemVkKVxuICAgKi9cbiAgc3RhdGljIGFzeW5jIHJlcXVpcmVSb2xlKHJvbGU6IFNlc3Npb25EYXRhWydyb2xlJ10pOiBQcm9taXNlPFNlc3Npb25EYXRhPiB7XG4gICAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IHRoaXMuZ2V0U2Vzc2lvbigpXG4gICAgaWYgKCFzZXNzaW9uIHx8IHNlc3Npb24ucm9sZSAhPT0gcm9sZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBBY2Nlc3MgZGVuaWVkLiBSZXF1aXJlZCByb2xlOiAke3JvbGV9YClcbiAgICB9XG4gICAgcmV0dXJuIHNlc3Npb25cbiAgfVxufVxuXG4vKipcbiAqIE1pZGRsZXdhcmUgaGVscGVyIGZvciBBUEkgcm91dGVzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiByZXF1aXJlQXV0aChyZXF1aXJlZFJvbGU/OiBTZXNzaW9uRGF0YVsncm9sZSddKSB7XG4gIHJldHVybiBhc3luYyAocmVxdWVzdDogTmV4dFJlcXVlc3QpID0+IHtcbiAgICBjb25zdCBzZXNzaW9uID0gYXdhaXQgU2Vzc2lvbk1hbmFnZXIuZ2V0U2Vzc2lvbkZyb21SZXF1ZXN0KHJlcXVlc3QpXG4gICAgXG4gICAgaWYgKCFzZXNzaW9uKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ0F1dGhlbnRpY2F0aW9uIHJlcXVpcmVkJyB9LCB7IHN0YXR1czogNDAxIH0pXG4gICAgfVxuXG4gICAgaWYgKHJlcXVpcmVkUm9sZSAmJiBzZXNzaW9uLnJvbGUgIT09IHJlcXVpcmVkUm9sZSkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGBBY2Nlc3MgZGVuaWVkLiBSZXF1aXJlZCByb2xlOiAke3JlcXVpcmVkUm9sZX1gIH0sIHsgc3RhdHVzOiA0MDMgfSlcbiAgICB9XG5cbiAgICByZXR1cm4geyBzZXNzaW9uIH1cbiAgfVxufVxuIl0sIm5hbWVzIjpbIlNpZ25KV1QiLCJqd3RWZXJpZnkiLCJjb29raWVzIiwiTmV4dFJlc3BvbnNlIiwiSldUX1NFQ1JFVCIsIlRleHRFbmNvZGVyIiwiZW5jb2RlIiwicHJvY2VzcyIsImVudiIsIlNlc3Npb25NYW5hZ2VyIiwiQ09PS0lFX05BTUUiLCJNQVhfQUdFIiwiUkVGUkVTSF9XSU5ET1ciLCJHUkFDRV9QRVJJT0QiLCJBQlNPTFVURV9NQVhfQUdFIiwiY3JlYXRlU2Vzc2lvbiIsInNlc3Npb25EYXRhIiwidG9rZW4iLCJzZXRQcm90ZWN0ZWRIZWFkZXIiLCJhbGciLCJzZXRJc3N1ZWRBdCIsInNldEV4cGlyYXRpb25UaW1lIiwic2lnbiIsImNvb2tpZVN0b3JlIiwic2V0IiwiaHR0cE9ubHkiLCJzZWN1cmUiLCJzYW1lU2l0ZSIsIm1heEFnZSIsInBhdGgiLCJnZXRTZXNzaW9uIiwiZ2V0IiwidmFsdWUiLCJjb25zb2xlIiwibG9nIiwic3Vic3RyaW5nIiwicGF5bG9hZCIsImlkIiwiZW1haWwiLCJlcnJvciIsImNvZGUiLCJtZXNzYWdlIiwiaW5jbHVkZXMiLCJnZXRTZXNzaW9uV2l0aFJlZnJlc2giLCJleHBpcnlUaW1lIiwiZXhwIiwidGltZVVudGlsRXhwaXJ5IiwiRGF0ZSIsIm5vdyIsImRlY29kZWQiLCJKU09OIiwicGFyc2UiLCJCdWZmZXIiLCJmcm9tIiwic3BsaXQiLCJ0b1N0cmluZyIsInRpbWVTaW5jZUV4cGlyeSIsImRlY29kZUVycm9yIiwiZ2V0U2Vzc2lvbkZyb21SZXF1ZXN0IiwicmVxdWVzdCIsInNlc3Npb25Db29raWUiLCJjbGVhclNlc3Npb24iLCJkZWxldGUiLCJjbGVhckV4cGlyZWRTZXNzaW9uIiwiRXJyb3IiLCJyZXNwb25zZSIsIm5leHQiLCJ1cGRhdGVTZXNzaW9uIiwidXBkYXRlcyIsImN1cnJlbnRTZXNzaW9uIiwidXBkYXRlZFNlc3Npb24iLCJoYXNSb2xlIiwicm9sZSIsInNlc3Npb24iLCJyZXF1aXJlUm9sZSIsInJlcXVpcmVBdXRoIiwicmVxdWlyZWRSb2xlIiwianNvbiIsInN0YXR1cyJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/session-manager.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase-auth-sync.ts":
/*!***********************************!*\
  !*** ./lib/supabase-auth-sync.ts ***!
  \***********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   checkUserInSupabaseAuth: () => (/* binding */ checkUserInSupabaseAuth),\n/* harmony export */   createUserWithSupabaseAuth: () => (/* binding */ createUserWithSupabaseAuth),\n/* harmony export */   getAllSupabaseAuthUsers: () => (/* binding */ getAllSupabaseAuthUsers),\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin),\n/* harmony export */   syncAllUsersToSupabaseAuth: () => (/* binding */ syncAllUsersToSupabaseAuth),\n/* harmony export */   syncUserToSupabaseAuth: () => (/* binding */ syncUserToSupabaseAuth)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _supabase__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ./supabase */ \"(rsc)/./lib/supabase.ts\");\n\n\nconst supabaseUrl = \"https://frzciymslvpohhyefmtr.supabase.co\";\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(supabaseUrl, supabaseServiceKey);\n/**\n * Sync a single user with Supabase Auth\n */ async function syncUserToSupabaseAuth(userData) {\n    try {\n        console.log('üîÑ Syncing user to Supabase Auth:', userData.email);\n        // Check if user exists in Supabase Auth\n        const { data: existingAuthUser, error: getUserError } = await supabaseAdmin.auth.admin.getUserById(userData.id);\n        if (getUserError && getUserError.message !== 'User not found') {\n            console.error('‚ùå Error checking existing auth user:', getUserError);\n            return {\n                success: false,\n                error: getUserError.message\n            };\n        }\n        if (existingAuthUser?.user) {\n            // User exists in Supabase Auth - update metadata\n            console.log('‚úÖ User exists in Supabase Auth, updating metadata');\n            const { data: updatedUser, error: updateError } = await supabaseAdmin.auth.admin.updateUserById(userData.id, {\n                email: userData.email,\n                user_metadata: {\n                    full_name: userData.full_name,\n                    user_type: userData.user_type,\n                    custom_user_id: userData.id,\n                    synced_at: new Date().toISOString()\n                }\n            });\n            if (updateError) {\n                console.error('‚ùå Error updating Supabase Auth user:', updateError);\n                return {\n                    success: false,\n                    error: updateError.message\n                };\n            }\n            return {\n                success: true,\n                action: 'updated',\n                auth_user_id: updatedUser.user.id\n            };\n        } else {\n            // User doesn't exist in Supabase Auth - create them\n            console.log('üë§ Creating new user in Supabase Auth');\n            const { data: newAuthUser, error: createError } = await supabaseAdmin.auth.admin.createUser({\n                id: userData.id,\n                email: userData.email,\n                email_confirm: true,\n                user_metadata: {\n                    full_name: userData.full_name,\n                    user_type: userData.user_type,\n                    custom_user_id: userData.id,\n                    synced_at: new Date().toISOString()\n                }\n            });\n            if (createError) {\n                console.error('‚ùå Error creating Supabase Auth user:', createError);\n                return {\n                    success: false,\n                    error: createError.message\n                };\n            }\n            return {\n                success: true,\n                action: 'created',\n                auth_user_id: newAuthUser.user.id\n            };\n        }\n    } catch (error) {\n        console.error('‚ùå syncUserToSupabaseAuth error:', error);\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Unknown error'\n        };\n    }\n}\n/**\n * Create a new user in both your database and Supabase Auth\n */ async function createUserWithSupabaseAuth(userData) {\n    try {\n        console.log('üë§ Creating new user with Supabase Auth sync:', userData.email);\n        // Create user in Supabase Auth first\n        const { data: authUser, error: authError } = await supabaseAdmin.auth.admin.createUser({\n            email: userData.email,\n            email_confirm: true,\n            user_metadata: {\n                full_name: userData.full_name,\n                user_type: userData.user_type,\n                created_at: new Date().toISOString()\n            }\n        });\n        if (authError) {\n            console.error('‚ùå Supabase Auth creation error:', authError);\n            return {\n                success: false,\n                error: authError.message\n            };\n        }\n        const userId = authUser.user.id;\n        // Now create user in your database with the same ID\n        const supabase = (0,_supabase__WEBPACK_IMPORTED_MODULE_0__.createServerClient)();\n        // Set verification and active status based on user type\n        // Therapists need manual approval, others can be auto-verified\n        const isVerified = userData.user_type !== 'therapist';\n        const isActive = userData.user_type !== 'therapist';\n        const { error: dbError } = await supabase.from('users').insert({\n            id: userId,\n            email: userData.email,\n            full_name: userData.full_name,\n            user_type: userData.user_type,\n            is_verified: isVerified,\n            is_active: isActive,\n            credits: userData.user_type === 'partner' ? 100 : 0,\n            package_type: userData.user_type === 'partner' ? 'starter' : 'free'\n        });\n        if (dbError) {\n            console.error('‚ùå Database user creation error:', dbError);\n            // Try to clean up the Supabase Auth user if database creation fails\n            await supabaseAdmin.auth.admin.deleteUser(userId);\n            return {\n                success: false,\n                error: dbError.message\n            };\n        }\n        console.log('‚úÖ User created successfully in both systems:', userId);\n        return {\n            success: true,\n            user_id: userId,\n            auth_user_id: authUser.user.id\n        };\n    } catch (error) {\n        console.error('‚ùå createUserWithSupabaseAuth error:', error);\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Unknown error'\n        };\n    }\n}\n/**\n * Sync all users from your database to Supabase Auth\n */ async function syncAllUsersToSupabaseAuth() {\n    try {\n        console.log('üîÑ Starting bulk user sync to Supabase Auth...');\n        const supabase = (0,_supabase__WEBPACK_IMPORTED_MODULE_0__.createServerClient)();\n        // Get all users from your database\n        const { data: users, error: fetchError } = await supabase.from('users').select('id, email, full_name, user_type');\n        if (fetchError) {\n            console.error('‚ùå Error fetching users:', fetchError);\n            return {\n                success: false,\n                error: fetchError.message\n            };\n        }\n        if (!users || users.length === 0) {\n            return {\n                success: true,\n                message: 'No users found to sync',\n                syncedCount: 0\n            };\n        }\n        console.log(`üìä Found ${users.length} users to sync`);\n        const results = [];\n        let successCount = 0;\n        let errorCount = 0;\n        for (const user of users){\n            const result = await syncUserToSupabaseAuth({\n                id: user.id,\n                email: user.email,\n                full_name: user.full_name,\n                user_type: user.user_type\n            });\n            results.push({\n                userId: user.id,\n                email: user.email,\n                ...result\n            });\n            if (result.success) {\n                successCount++;\n            } else {\n                errorCount++;\n            }\n            // Add a small delay to avoid rate limiting\n            await new Promise((resolve)=>setTimeout(resolve, 100));\n        }\n        console.log(`‚úÖ Sync completed: ${successCount} successful, ${errorCount} errors`);\n        return {\n            success: true,\n            totalUsers: users.length,\n            successCount,\n            errorCount,\n            results\n        };\n    } catch (error) {\n        console.error('‚ùå syncAllUsersToSupabaseAuth error:', error);\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Unknown error'\n        };\n    }\n}\n/**\n * Check if a user exists in Supabase Auth\n */ async function checkUserInSupabaseAuth(userId) {\n    try {\n        const { data: authUser, error } = await supabaseAdmin.auth.admin.getUserById(userId);\n        if (error && error.message !== 'User not found') {\n            return {\n                success: false,\n                error: error.message\n            };\n        }\n        return {\n            success: true,\n            exists: !!authUser?.user,\n            user: authUser?.user || null\n        };\n    } catch (error) {\n        console.error('‚ùå checkUserInSupabaseAuth error:', error);\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Unknown error'\n        };\n    }\n}\n/**\n * Get all users from Supabase Auth\n */ async function getAllSupabaseAuthUsers() {\n    try {\n        const { data: users, error } = await supabaseAdmin.auth.admin.listUsers();\n        if (error) {\n            console.error('‚ùå getAllSupabaseAuthUsers error:', error);\n            return {\n                success: false,\n                error: error.message\n            };\n        }\n        return {\n            success: true,\n            users: users?.users || []\n        };\n    } catch (error) {\n        console.error('‚ùå getAllSupabaseAuthUsers error:', error);\n        return {\n            success: false,\n            error: error instanceof Error ? error.message : 'Unknown error'\n        };\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QSxNQUFNTSxPQUFPO1lBQUM7UUFDaEQ7UUFFQSxPQUFPO1lBQ0xDLFNBQVM7WUFDVG9ELFFBQVEsQ0FBQyxDQUFDaEMsVUFBVW5CO1lBQ3BCQSxNQUFNbUIsVUFBVW5CLFFBQVE7UUFDMUI7SUFDRixFQUFFLE9BQU9SLE9BQU87UUFDZEwsUUFBUUssS0FBSyxDQUFDLG9DQUFvQ0E7UUFDbEQsT0FBTztZQUNMTyxTQUFTO1lBQ1RQLE9BQU9BLGlCQUFpQnlCLFFBQVF6QixNQUFNTSxPQUFPLEdBQUc7UUFDbEQ7SUFDRjtBQUNGO0FBRUE7O0NBRUMsR0FDTSxlQUFlc0Q7SUFDcEIsSUFBSTtRQUNGLE1BQU0sRUFBRTlELE1BQU04QyxLQUFLLEVBQUU1QyxLQUFLLEVBQUUsR0FBRyxNQUFNUixjQUFjVSxJQUFJLENBQUNDLEtBQUssQ0FBQzBELFNBQVM7UUFFdkUsSUFBSTdELE9BQU87WUFDVEwsUUFBUUssS0FBSyxDQUFDLG9DQUFvQ0E7WUFDbEQsT0FBTztnQkFBRU8sU0FBUztnQkFBT1AsT0FBT0EsTUFBTU0sT0FBTztZQUFDO1FBQ2hEO1FBRUEsT0FBTztZQUNMQyxTQUFTO1lBQ1RxQyxPQUFPQSxPQUFPQSxTQUFTLEVBQUU7UUFDM0I7SUFDRixFQUFFLE9BQU81QyxPQUFPO1FBQ2RMLFFBQVFLLEtBQUssQ0FBQyxvQ0FBb0NBO1FBQ2xELE9BQU87WUFDTE8sU0FBUztZQUNUUCxPQUFPQSxpQkFBaUJ5QixRQUFRekIsTUFBTU0sT0FBTyxHQUFHO1FBQ2xEO0lBQ0Y7QUFDRiIsInNvdXJjZXMiOlsiL1VzZXJzL21hY2Jvb2svRGVza3RvcC90cnBpLWFwcC9saWIvc3VwYWJhc2UtYXV0aC1zeW5jLnRzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5pbXBvcnQgeyBjcmVhdGVTZXJ2ZXJDbGllbnQgfSBmcm9tICcuL3N1cGFiYXNlJztcblxuY29uc3Qgc3VwYWJhc2VVcmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwhO1xuY29uc3Qgc3VwYWJhc2VTZXJ2aWNlS2V5ID0gcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSE7XG5leHBvcnQgY29uc3Qgc3VwYWJhc2VBZG1pbiA9IGNyZWF0ZUNsaWVudChzdXBhYmFzZVVybCwgc3VwYWJhc2VTZXJ2aWNlS2V5KTtcblxuZXhwb3J0IGludGVyZmFjZSBVc2VyU3luY0RhdGEge1xuICBpZDogc3RyaW5nO1xuICBlbWFpbDogc3RyaW5nO1xuICBmdWxsX25hbWU6IHN0cmluZyB8IG51bGw7XG4gIHVzZXJfdHlwZTogJ2luZGl2aWR1YWwnIHwgJ3RoZXJhcGlzdCcgfCAncGFydG5lcicgfCAnYWRtaW4nO1xufVxuXG4vKipcbiAqIFN5bmMgYSBzaW5nbGUgdXNlciB3aXRoIFN1cGFiYXNlIEF1dGhcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHN5bmNVc2VyVG9TdXBhYmFzZUF1dGgodXNlckRhdGE6IFVzZXJTeW5jRGF0YSkge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKCfwn5SEIFN5bmNpbmcgdXNlciB0byBTdXBhYmFzZSBBdXRoOicsIHVzZXJEYXRhLmVtYWlsKTtcblxuICAgIC8vIENoZWNrIGlmIHVzZXIgZXhpc3RzIGluIFN1cGFiYXNlIEF1dGhcbiAgICBjb25zdCB7IGRhdGE6IGV4aXN0aW5nQXV0aFVzZXIsIGVycm9yOiBnZXRVc2VyRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW4uYXV0aC5hZG1pbi5nZXRVc2VyQnlJZCh1c2VyRGF0YS5pZCk7XG5cbiAgICBpZiAoZ2V0VXNlckVycm9yICYmIGdldFVzZXJFcnJvci5tZXNzYWdlICE9PSAnVXNlciBub3QgZm91bmQnKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgRXJyb3IgY2hlY2tpbmcgZXhpc3RpbmcgYXV0aCB1c2VyOicsIGdldFVzZXJFcnJvcik7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGdldFVzZXJFcnJvci5tZXNzYWdlIH07XG4gICAgfVxuXG4gICAgaWYgKGV4aXN0aW5nQXV0aFVzZXI/LnVzZXIpIHtcbiAgICAgIC8vIFVzZXIgZXhpc3RzIGluIFN1cGFiYXNlIEF1dGggLSB1cGRhdGUgbWV0YWRhdGFcbiAgICAgIGNvbnNvbGUubG9nKCfinIUgVXNlciBleGlzdHMgaW4gU3VwYWJhc2UgQXV0aCwgdXBkYXRpbmcgbWV0YWRhdGEnKTtcbiAgICAgIFxuICAgICAgY29uc3QgeyBkYXRhOiB1cGRhdGVkVXNlciwgZXJyb3I6IHVwZGF0ZUVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluLmF1dGguYWRtaW4udXBkYXRlVXNlckJ5SWQoXG4gICAgICAgIHVzZXJEYXRhLmlkLFxuICAgICAgICB7XG4gICAgICAgICAgZW1haWw6IHVzZXJEYXRhLmVtYWlsLFxuICAgICAgICAgIHVzZXJfbWV0YWRhdGE6IHtcbiAgICAgICAgICAgIGZ1bGxfbmFtZTogdXNlckRhdGEuZnVsbF9uYW1lLFxuICAgICAgICAgICAgdXNlcl90eXBlOiB1c2VyRGF0YS51c2VyX3R5cGUsXG4gICAgICAgICAgICBjdXN0b21fdXNlcl9pZDogdXNlckRhdGEuaWQsXG4gICAgICAgICAgICBzeW5jZWRfYXQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcblxuICAgICAgaWYgKHVwZGF0ZUVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciB1cGRhdGluZyBTdXBhYmFzZSBBdXRoIHVzZXI6JywgdXBkYXRlRXJyb3IpO1xuICAgICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IHVwZGF0ZUVycm9yLm1lc3NhZ2UgfTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHsgXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgICBhY3Rpb246ICd1cGRhdGVkJyxcbiAgICAgICAgYXV0aF91c2VyX2lkOiB1cGRhdGVkVXNlci51c2VyLmlkIFxuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gVXNlciBkb2Vzbid0IGV4aXN0IGluIFN1cGFiYXNlIEF1dGggLSBjcmVhdGUgdGhlbVxuICAgICAgY29uc29sZS5sb2coJ/CfkaQgQ3JlYXRpbmcgbmV3IHVzZXIgaW4gU3VwYWJhc2UgQXV0aCcpO1xuICAgICAgXG4gICAgICBjb25zdCB7IGRhdGE6IG5ld0F1dGhVc2VyLCBlcnJvcjogY3JlYXRlRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW4uYXV0aC5hZG1pbi5jcmVhdGVVc2VyKHtcbiAgICAgICAgaWQ6IHVzZXJEYXRhLmlkLCAvLyBVc2UgdGhlIHNhbWUgSUQgZnJvbSB5b3VyIGRhdGFiYXNlXG4gICAgICAgIGVtYWlsOiB1c2VyRGF0YS5lbWFpbCxcbiAgICAgICAgZW1haWxfY29uZmlybTogdHJ1ZSwgLy8gQXV0by1jb25maXJtIHNpbmNlIHlvdSdyZSB1c2luZyBtYWdpYyBsaW5rc1xuICAgICAgICB1c2VyX21ldGFkYXRhOiB7XG4gICAgICAgICAgZnVsbF9uYW1lOiB1c2VyRGF0YS5mdWxsX25hbWUsXG4gICAgICAgICAgdXNlcl90eXBlOiB1c2VyRGF0YS51c2VyX3R5cGUsXG4gICAgICAgICAgY3VzdG9tX3VzZXJfaWQ6IHVzZXJEYXRhLmlkLFxuICAgICAgICAgIHN5bmNlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgICBpZiAoY3JlYXRlRXJyb3IpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcign4p2MIEVycm9yIGNyZWF0aW5nIFN1cGFiYXNlIEF1dGggdXNlcjonLCBjcmVhdGVFcnJvcik7XG4gICAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogY3JlYXRlRXJyb3IubWVzc2FnZSB9O1xuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBcbiAgICAgICAgc3VjY2VzczogdHJ1ZSwgXG4gICAgICAgIGFjdGlvbjogJ2NyZWF0ZWQnLFxuICAgICAgICBhdXRoX3VzZXJfaWQ6IG5ld0F1dGhVc2VyLnVzZXIuaWQgXG4gICAgICB9O1xuICAgIH1cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgc3luY1VzZXJUb1N1cGFiYXNlQXV0aCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgXG4gICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicgXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZSBhIG5ldyB1c2VyIGluIGJvdGggeW91ciBkYXRhYmFzZSBhbmQgU3VwYWJhc2UgQXV0aFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY3JlYXRlVXNlcldpdGhTdXBhYmFzZUF1dGgodXNlckRhdGE6IE9taXQ8VXNlclN5bmNEYXRhLCAnaWQnPikge1xuICB0cnkge1xuICAgIGNvbnNvbGUubG9nKCfwn5GkIENyZWF0aW5nIG5ldyB1c2VyIHdpdGggU3VwYWJhc2UgQXV0aCBzeW5jOicsIHVzZXJEYXRhLmVtYWlsKTtcblxuICAgIC8vIENyZWF0ZSB1c2VyIGluIFN1cGFiYXNlIEF1dGggZmlyc3RcbiAgICBjb25zdCB7IGRhdGE6IGF1dGhVc2VyLCBlcnJvcjogYXV0aEVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluLmF1dGguYWRtaW4uY3JlYXRlVXNlcih7XG4gICAgICBlbWFpbDogdXNlckRhdGEuZW1haWwsXG4gICAgICBlbWFpbF9jb25maXJtOiB0cnVlLCAvLyBBdXRvLWNvbmZpcm0gc2luY2UgeW91J3JlIHVzaW5nIG1hZ2ljIGxpbmtzXG4gICAgICB1c2VyX21ldGFkYXRhOiB7XG4gICAgICAgIGZ1bGxfbmFtZTogdXNlckRhdGEuZnVsbF9uYW1lLFxuICAgICAgICB1c2VyX3R5cGU6IHVzZXJEYXRhLnVzZXJfdHlwZSxcbiAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpZiAoYXV0aEVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCfinYwgU3VwYWJhc2UgQXV0aCBjcmVhdGlvbiBlcnJvcjonLCBhdXRoRXJyb3IpO1xuICAgICAgcmV0dXJuIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBhdXRoRXJyb3IubWVzc2FnZSB9O1xuICAgIH1cblxuICAgIGNvbnN0IHVzZXJJZCA9IGF1dGhVc2VyLnVzZXIuaWQ7XG5cbiAgICAvLyBOb3cgY3JlYXRlIHVzZXIgaW4geW91ciBkYXRhYmFzZSB3aXRoIHRoZSBzYW1lIElEXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVTZXJ2ZXJDbGllbnQoKTtcbiAgICBcbiAgICAvLyBTZXQgdmVyaWZpY2F0aW9uIGFuZCBhY3RpdmUgc3RhdHVzIGJhc2VkIG9uIHVzZXIgdHlwZVxuICAgIC8vIFRoZXJhcGlzdHMgbmVlZCBtYW51YWwgYXBwcm92YWwsIG90aGVycyBjYW4gYmUgYXV0by12ZXJpZmllZFxuICAgIGNvbnN0IGlzVmVyaWZpZWQgPSB1c2VyRGF0YS51c2VyX3R5cGUgIT09ICd0aGVyYXBpc3QnXG4gICAgY29uc3QgaXNBY3RpdmUgPSB1c2VyRGF0YS51c2VyX3R5cGUgIT09ICd0aGVyYXBpc3QnXG4gICAgXG4gICAgY29uc3QgeyBlcnJvcjogZGJFcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAuaW5zZXJ0KHtcbiAgICAgICAgaWQ6IHVzZXJJZCxcbiAgICAgICAgZW1haWw6IHVzZXJEYXRhLmVtYWlsLFxuICAgICAgICBmdWxsX25hbWU6IHVzZXJEYXRhLmZ1bGxfbmFtZSxcbiAgICAgICAgdXNlcl90eXBlOiB1c2VyRGF0YS51c2VyX3R5cGUsXG4gICAgICAgIGlzX3ZlcmlmaWVkOiBpc1ZlcmlmaWVkLFxuICAgICAgICBpc19hY3RpdmU6IGlzQWN0aXZlLFxuICAgICAgICBjcmVkaXRzOiB1c2VyRGF0YS51c2VyX3R5cGUgPT09ICdwYXJ0bmVyJyA/IDEwMCA6IDAsIC8vIEdpdmUgcGFydG5lcnMgc29tZSBpbml0aWFsIGNyZWRpdHNcbiAgICAgICAgcGFja2FnZV90eXBlOiB1c2VyRGF0YS51c2VyX3R5cGUgPT09ICdwYXJ0bmVyJyA/ICdzdGFydGVyJyA6ICdmcmVlJ1xuICAgICAgfSk7XG5cbiAgICBpZiAoZGJFcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIERhdGFiYXNlIHVzZXIgY3JlYXRpb24gZXJyb3I6JywgZGJFcnJvcik7XG4gICAgICAvLyBUcnkgdG8gY2xlYW4gdXAgdGhlIFN1cGFiYXNlIEF1dGggdXNlciBpZiBkYXRhYmFzZSBjcmVhdGlvbiBmYWlsc1xuICAgICAgYXdhaXQgc3VwYWJhc2VBZG1pbi5hdXRoLmFkbWluLmRlbGV0ZVVzZXIodXNlcklkKTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZGJFcnJvci5tZXNzYWdlIH07XG4gICAgfVxuXG4gICAgY29uc29sZS5sb2coJ+KchSBVc2VyIGNyZWF0ZWQgc3VjY2Vzc2Z1bGx5IGluIGJvdGggc3lzdGVtczonLCB1c2VySWQpO1xuICAgIHJldHVybiB7IFxuICAgICAgc3VjY2VzczogdHJ1ZSwgXG4gICAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgICBhdXRoX3VzZXJfaWQ6IGF1dGhVc2VyLnVzZXIuaWQgXG4gICAgfTtcblxuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBjcmVhdGVVc2VyV2l0aFN1cGFiYXNlQXV0aCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgXG4gICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicgXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIFN5bmMgYWxsIHVzZXJzIGZyb20geW91ciBkYXRhYmFzZSB0byBTdXBhYmFzZSBBdXRoXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBzeW5jQWxsVXNlcnNUb1N1cGFiYXNlQXV0aCgpIHtcbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygn8J+UhCBTdGFydGluZyBidWxrIHVzZXIgc3luYyB0byBTdXBhYmFzZSBBdXRoLi4uJyk7XG5cbiAgICBjb25zdCBzdXBhYmFzZSA9IGNyZWF0ZVNlcnZlckNsaWVudCgpO1xuICAgIFxuICAgIC8vIEdldCBhbGwgdXNlcnMgZnJvbSB5b3VyIGRhdGFiYXNlXG4gICAgY29uc3QgeyBkYXRhOiB1c2VycywgZXJyb3I6IGZldGNoRXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcnMnKVxuICAgICAgLnNlbGVjdCgnaWQsIGVtYWlsLCBmdWxsX25hbWUsIHVzZXJfdHlwZScpO1xuXG4gICAgaWYgKGZldGNoRXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBFcnJvciBmZXRjaGluZyB1c2VyczonLCBmZXRjaEVycm9yKTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZmV0Y2hFcnJvci5tZXNzYWdlIH07XG4gICAgfVxuXG4gICAgaWYgKCF1c2VycyB8fCB1c2Vycy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IHRydWUsIG1lc3NhZ2U6ICdObyB1c2VycyBmb3VuZCB0byBzeW5jJywgc3luY2VkQ291bnQ6IDAgfTtcbiAgICB9XG5cbiAgICBjb25zb2xlLmxvZyhg8J+TiiBGb3VuZCAke3VzZXJzLmxlbmd0aH0gdXNlcnMgdG8gc3luY2ApO1xuXG4gICAgY29uc3QgcmVzdWx0cyA9IFtdO1xuICAgIGxldCBzdWNjZXNzQ291bnQgPSAwO1xuICAgIGxldCBlcnJvckNvdW50ID0gMDtcblxuICAgIGZvciAoY29uc3QgdXNlciBvZiB1c2Vycykge1xuICAgICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgc3luY1VzZXJUb1N1cGFiYXNlQXV0aCh7XG4gICAgICAgIGlkOiB1c2VyLmlkLFxuICAgICAgICBlbWFpbDogdXNlci5lbWFpbCxcbiAgICAgICAgZnVsbF9uYW1lOiB1c2VyLmZ1bGxfbmFtZSxcbiAgICAgICAgdXNlcl90eXBlOiB1c2VyLnVzZXJfdHlwZVxuICAgICAgfSk7XG5cbiAgICAgIHJlc3VsdHMucHVzaCh7XG4gICAgICAgIHVzZXJJZDogdXNlci5pZCxcbiAgICAgICAgZW1haWw6IHVzZXIuZW1haWwsXG4gICAgICAgIC4uLnJlc3VsdFxuICAgICAgfSk7XG5cbiAgICAgIGlmIChyZXN1bHQuc3VjY2Vzcykge1xuICAgICAgICBzdWNjZXNzQ291bnQrKztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGVycm9yQ291bnQrKztcbiAgICAgIH1cblxuICAgICAgLy8gQWRkIGEgc21hbGwgZGVsYXkgdG8gYXZvaWQgcmF0ZSBsaW1pdGluZ1xuICAgICAgYXdhaXQgbmV3IFByb21pc2UocmVzb2x2ZSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIDEwMCkpO1xuICAgIH1cblxuICAgIGNvbnNvbGUubG9nKGDinIUgU3luYyBjb21wbGV0ZWQ6ICR7c3VjY2Vzc0NvdW50fSBzdWNjZXNzZnVsLCAke2Vycm9yQ291bnR9IGVycm9yc2ApO1xuXG4gICAgcmV0dXJuIHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICB0b3RhbFVzZXJzOiB1c2Vycy5sZW5ndGgsXG4gICAgICBzdWNjZXNzQ291bnQsXG4gICAgICBlcnJvckNvdW50LFxuICAgICAgcmVzdWx0c1xuICAgIH07XG5cbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCfinYwgc3luY0FsbFVzZXJzVG9TdXBhYmFzZUF1dGggZXJyb3I6JywgZXJyb3IpO1xuICAgIHJldHVybiB7IFxuICAgICAgc3VjY2VzczogZmFsc2UsIFxuICAgICAgZXJyb3I6IGVycm9yIGluc3RhbmNlb2YgRXJyb3IgPyBlcnJvci5tZXNzYWdlIDogJ1Vua25vd24gZXJyb3InIFxuICAgIH07XG4gIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiBhIHVzZXIgZXhpc3RzIGluIFN1cGFiYXNlIEF1dGhcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNoZWNrVXNlckluU3VwYWJhc2VBdXRoKHVzZXJJZDogc3RyaW5nKSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBkYXRhOiBhdXRoVXNlciwgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW4uYXV0aC5hZG1pbi5nZXRVc2VyQnlJZCh1c2VySWQpO1xuICAgIFxuICAgIGlmIChlcnJvciAmJiBlcnJvci5tZXNzYWdlICE9PSAnVXNlciBub3QgZm91bmQnKSB7XG4gICAgICByZXR1cm4geyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6IGVycm9yLm1lc3NhZ2UgfTtcbiAgICB9XG5cbiAgICByZXR1cm4geyBcbiAgICAgIHN1Y2Nlc3M6IHRydWUsIFxuICAgICAgZXhpc3RzOiAhIWF1dGhVc2VyPy51c2VyLFxuICAgICAgdXNlcjogYXV0aFVzZXI/LnVzZXIgfHwgbnVsbCBcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ+KdjCBjaGVja1VzZXJJblN1cGFiYXNlQXV0aCBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgXG4gICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnVW5rbm93biBlcnJvcicgXG4gICAgfTtcbiAgfVxufVxuXG4vKipcbiAqIEdldCBhbGwgdXNlcnMgZnJvbSBTdXBhYmFzZSBBdXRoXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBbGxTdXBhYmFzZUF1dGhVc2VycygpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCB7IGRhdGE6IHVzZXJzLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pbi5hdXRoLmFkbWluLmxpc3RVc2VycygpO1xuICAgIFxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcign4p2MIGdldEFsbFN1cGFiYXNlQXV0aFVzZXJzIGVycm9yOicsIGVycm9yKTtcbiAgICAgIHJldHVybiB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogZXJyb3IubWVzc2FnZSB9O1xuICAgIH1cblxuICAgIHJldHVybiB7IFxuICAgICAgc3VjY2VzczogdHJ1ZSwgXG4gICAgICB1c2VyczogdXNlcnM/LnVzZXJzIHx8IFtdIFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcign4p2MIGdldEFsbFN1cGFiYXNlQXV0aFVzZXJzIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4geyBcbiAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgIGVycm9yOiBlcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZXJyb3IubWVzc2FnZSA6ICdVbmtub3duIGVycm9yJyBcbiAgICB9O1xuICB9XG59Il0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsImNyZWF0ZVNlcnZlckNsaWVudCIsInN1cGFiYXNlVXJsIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsInN1cGFiYXNlU2VydmljZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJzdXBhYmFzZUFkbWluIiwic3luY1VzZXJUb1N1cGFiYXNlQXV0aCIsInVzZXJEYXRhIiwiY29uc29sZSIsImxvZyIsImVtYWlsIiwiZGF0YSIsImV4aXN0aW5nQXV0aFVzZXIiLCJlcnJvciIsImdldFVzZXJFcnJvciIsImF1dGgiLCJhZG1pbiIsImdldFVzZXJCeUlkIiwiaWQiLCJtZXNzYWdlIiwic3VjY2VzcyIsInVzZXIiLCJ1cGRhdGVkVXNlciIsInVwZGF0ZUVycm9yIiwidXBkYXRlVXNlckJ5SWQiLCJ1c2VyX21ldGFkYXRhIiwiZnVsbF9uYW1lIiwidXNlcl90eXBlIiwiY3VzdG9tX3VzZXJfaWQiLCJzeW5jZWRfYXQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJhY3Rpb24iLCJhdXRoX3VzZXJfaWQiLCJuZXdBdXRoVXNlciIsImNyZWF0ZUVycm9yIiwiY3JlYXRlVXNlciIsImVtYWlsX2NvbmZpcm0iLCJFcnJvciIsImNyZWF0ZVVzZXJXaXRoU3VwYWJhc2VBdXRoIiwiYXV0aFVzZXIiLCJhdXRoRXJyb3IiLCJjcmVhdGVkX2F0IiwidXNlcklkIiwic3VwYWJhc2UiLCJpc1ZlcmlmaWVkIiwiaXNBY3RpdmUiLCJkYkVycm9yIiwiZnJvbSIsImluc2VydCIsImlzX3ZlcmlmaWVkIiwiaXNfYWN0aXZlIiwiY3JlZGl0cyIsInBhY2thZ2VfdHlwZSIsImRlbGV0ZVVzZXIiLCJ1c2VyX2lkIiwic3luY0FsbFVzZXJzVG9TdXBhYmFzZUF1dGgiLCJ1c2VycyIsImZldGNoRXJyb3IiLCJzZWxlY3QiLCJsZW5ndGgiLCJzeW5jZWRDb3VudCIsInJlc3VsdHMiLCJzdWNjZXNzQ291bnQiLCJlcnJvckNvdW50IiwicmVzdWx0IiwicHVzaCIsIlByb21pc2UiLCJyZXNvbHZlIiwic2V0VGltZW91dCIsInRvdGFsVXNlcnMiLCJjaGVja1VzZXJJblN1cGFiYXNlQXV0aCIsImV4aXN0cyIsImdldEFsbFN1cGFiYXNlQXV0aFVzZXJzIiwibGlzdFVzZXJzIl0sImlnbm9yZUxpc3QiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase-auth-sync.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabase.ts":
/*!*************************!*\
  !*** ./lib/supabase.ts ***!
  \*************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createServerClient: () => (/* binding */ createServerClient),\n/* harmony export */   supabase: () => (/* binding */ supabase)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/ssr */ \"(rsc)/./node_modules/@supabase/ssr/dist/module/index.js\");\n\n\nconst supabaseUrl = \"https://frzciymslvpohhyefmtr.supabase.co\" || 0;\nconst supabaseAnonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyenNjaXltc2x2cG9oaHllZm10ciIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNzU0NzA4NDgyLCJleHAiOjIwNzAyODQ0ODJ9.y_CSv6rhYngCDvSe9Z6NuEPzPLgBV_huXq5f3WbGiLM\" || 0;\n// Client-side Supabase client with real-time disabled to prevent WebSocket errors\nconst supabase = (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_0__.createBrowserClient)(supabaseUrl, supabaseAnonKey, {\n    realtime: {\n        enabled: false\n    }\n});\n// Server-side Supabase client with service role key\nconst createServerClient = ()=>{\n    const serverSupabaseUrl = \"https://frzciymslvpohhyefmtr.supabase.co\" || 0;\n    // Use anon key as fallback if service role key is invalid\n    const serviceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n    const anonKey = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZyenNjaXltc2x2cG9oaHllZm10ciIsInJvbGUiOiJhbm9uIiwiaWF0IjoxNzU0NzA4NDgyLCJleHAiOjIwNzAyODQ0ODJ9.y_CSv6rhYngCDvSe9Z6NuEPzPLgBV_huXq5f3WbGiLM\" || 0;\n    console.log('üîç createServerClient: Service role key exists:', !!serviceRoleKey);\n    console.log('üîç createServerClient: Service role key length:', serviceRoleKey?.length);\n    console.log('üîç createServerClient: Anon key length:', anonKey?.length);\n    // Use service role key if available, otherwise fallback to anon key\n    const serverSupabaseKey = serviceRoleKey || anonKey;\n    console.log('üîç createServerClient: Using key type:', serviceRoleKey ? 'service_role' : 'anon');\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_1__.createClient)(serverSupabaseUrl, serverSupabaseKey, {\n        auth: {\n            persistSession: false\n        }\n    });\n};\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2UudHMiLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFvRDtBQUNEO0FBRW5ELE1BQU1FLGNBQWNDLDBDQUFvQyxJQUFJLENBQUU7QUFDOUQsTUFBTUcsa0JBQWtCSCxtTkFBeUMsSUFBSSxDQUFFO0FBRXZFLGtGQUFrRjtBQUMzRSxNQUFNSyxXQUFXUCxrRUFBbUJBLENBQUNDLGFBQWFJLGlCQUFpQjtJQUN4RUcsVUFBVTtRQUNSQyxTQUFTO0lBQ1g7QUFDRixHQUFFO0FBRUYsb0RBQW9EO0FBQzdDLE1BQU1DLHFCQUFxQjtJQUNoQyxNQUFNQyxvQkFBb0JULDBDQUFvQyxJQUFJLENBQTBDO0lBRTVHLDBEQUEwRDtJQUMxRCxNQUFNVSxpQkFBaUJWLFFBQVFDLEdBQUcsQ0FBQ1UseUJBQXlCO0lBQzVELE1BQU1DLFVBQVVaLG1OQUF5QyxJQUFJLENBQUU7SUFFL0RhLFFBQVFDLEdBQUcsQ0FBQyxtREFBbUQsQ0FBQyxDQUFDSjtJQUNqRUcsUUFBUUMsR0FBRyxDQUFDLG1EQUFtREosZ0JBQWdCSztJQUMvRUYsUUFBUUMsR0FBRyxDQUFDLDJDQUEyQ0YsU0FBU0c7SUFFaEUsb0VBQW9FO0lBQ3BFLE1BQU1DLG9CQUFvQk4sa0JBQWtCRTtJQUU1Q0MsUUFBUUMsR0FBRyxDQUFDLDBDQUEwQ0osaUJBQWlCLGlCQUFpQjtJQUV4RixPQUFPYixtRUFBWUEsQ0FBQ1ksbUJBQW1CTyxtQkFBbUI7UUFDeERDLE1BQU07WUFDSkMsZ0JBQWdCO1FBQ2xCO0lBQ0Y7QUFDRixFQUFDIiwic291cmNlcyI6WyIvVXNlcnMvbWFjYm9vay9EZXNrdG9wL3RycGktYXBwL2xpYi9zdXBhYmFzZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCJcbmltcG9ydCB7IGNyZWF0ZUJyb3dzZXJDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3NzclwiXG5cbmNvbnN0IHN1cGFiYXNlVXJsID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIHx8ICcnXG5jb25zdCBzdXBhYmFzZUFub25LZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSB8fCAnJ1xuXG4vLyBDbGllbnQtc2lkZSBTdXBhYmFzZSBjbGllbnQgd2l0aCByZWFsLXRpbWUgZGlzYWJsZWQgdG8gcHJldmVudCBXZWJTb2NrZXQgZXJyb3JzXG5leHBvcnQgY29uc3Qgc3VwYWJhc2UgPSBjcmVhdGVCcm93c2VyQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZUFub25LZXksIHtcbiAgcmVhbHRpbWU6IHtcbiAgICBlbmFibGVkOiBmYWxzZVxuICB9XG59KVxuXG4vLyBTZXJ2ZXItc2lkZSBTdXBhYmFzZSBjbGllbnQgd2l0aCBzZXJ2aWNlIHJvbGUga2V5XG5leHBvcnQgY29uc3QgY3JlYXRlU2VydmVyQ2xpZW50ID0gKCkgPT4ge1xuICBjb25zdCBzZXJ2ZXJTdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCB8fCAnaHR0cHM6Ly9mcnpjaXltc2x2cG9oaHllZm10ci5zdXBhYmFzZS5jbydcbiAgXG4gIC8vIFVzZSBhbm9uIGtleSBhcyBmYWxsYmFjayBpZiBzZXJ2aWNlIHJvbGUga2V5IGlzIGludmFsaWRcbiAgY29uc3Qgc2VydmljZVJvbGVLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZXG4gIGNvbnN0IGFub25LZXkgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSB8fCAnJ1xuICBcbiAgY29uc29sZS5sb2coJ/CflI0gY3JlYXRlU2VydmVyQ2xpZW50OiBTZXJ2aWNlIHJvbGUga2V5IGV4aXN0czonLCAhIXNlcnZpY2VSb2xlS2V5KVxuICBjb25zb2xlLmxvZygn8J+UjSBjcmVhdGVTZXJ2ZXJDbGllbnQ6IFNlcnZpY2Ugcm9sZSBrZXkgbGVuZ3RoOicsIHNlcnZpY2VSb2xlS2V5Py5sZW5ndGgpXG4gIGNvbnNvbGUubG9nKCfwn5SNIGNyZWF0ZVNlcnZlckNsaWVudDogQW5vbiBrZXkgbGVuZ3RoOicsIGFub25LZXk/Lmxlbmd0aClcbiAgXG4gIC8vIFVzZSBzZXJ2aWNlIHJvbGUga2V5IGlmIGF2YWlsYWJsZSwgb3RoZXJ3aXNlIGZhbGxiYWNrIHRvIGFub24ga2V5XG4gIGNvbnN0IHNlcnZlclN1cGFiYXNlS2V5ID0gc2VydmljZVJvbGVLZXkgfHwgYW5vbktleVxuICBcbiAgY29uc29sZS5sb2coJ/CflI0gY3JlYXRlU2VydmVyQ2xpZW50OiBVc2luZyBrZXkgdHlwZTonLCBzZXJ2aWNlUm9sZUtleSA/ICdzZXJ2aWNlX3JvbGUnIDogJ2Fub24nKVxuICBcbiAgcmV0dXJuIGNyZWF0ZUNsaWVudChzZXJ2ZXJTdXBhYmFzZVVybCwgc2VydmVyU3VwYWJhc2VLZXksIHtcbiAgICBhdXRoOiB7XG4gICAgICBwZXJzaXN0U2Vzc2lvbjogZmFsc2UsXG4gICAgfSxcbiAgfSlcbn1cblxuLy8gRGF0YWJhc2UgdHlwZXMgKHdpbGwgYmUgZ2VuZXJhdGVkIGZyb20gU3VwYWJhc2UpXG5leHBvcnQgaW50ZXJmYWNlIERhdGFiYXNlIHtcbiAgcHVibGljOiB7XG4gICAgVGFibGVzOiB7XG4gICAgICB1c2Vyczoge1xuICAgICAgICBSb3c6IHtcbiAgICAgICAgICBpZDogc3RyaW5nXG4gICAgICAgICAgZW1haWw6IHN0cmluZ1xuICAgICAgICAgIGZ1bGxfbmFtZTogc3RyaW5nIHwgbnVsbFxuICAgICAgICAgIHVzZXJfdHlwZTogXCJpbmRpdmlkdWFsXCIgfCBcInBhcnRuZXJcIiB8IFwidGhlcmFwaXN0XCIgfCBcImFkbWluXCJcbiAgICAgICAgICBwYXJ0bmVyX2lkOiBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgY3JlYXRlZF9hdDogc3RyaW5nXG4gICAgICAgICAgdXBkYXRlZF9hdDogc3RyaW5nXG4gICAgICAgICAgaXNfdmVyaWZpZWQ6IGJvb2xlYW5cbiAgICAgICAgICBpc19hY3RpdmU6IGJvb2xlYW5cbiAgICAgICAgfVxuICAgICAgICBJbnNlcnQ6IHtcbiAgICAgICAgICBpZD86IHN0cmluZ1xuICAgICAgICAgIGVtYWlsOiBzdHJpbmdcbiAgICAgICAgICBmdWxsX25hbWU/OiBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgdXNlcl90eXBlOiBcImluZGl2aWR1YWxcIiB8IFwicGFydG5lclwiIHwgXCJ0aGVyYXBpc3RcIiB8IFwiYWRtaW5cIlxuICAgICAgICAgIHBhcnRuZXJfaWQ/OiBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgY3JlYXRlZF9hdD86IHN0cmluZ1xuICAgICAgICAgIHVwZGF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgICBpc192ZXJpZmllZD86IGJvb2xlYW5cbiAgICAgICAgICBpc19hY3RpdmU/OiBib29sZWFuXG4gICAgICAgIH1cbiAgICAgICAgVXBkYXRlOiB7XG4gICAgICAgICAgaWQ/OiBzdHJpbmdcbiAgICAgICAgICBlbWFpbD86IHN0cmluZ1xuICAgICAgICAgIGZ1bGxfbmFtZT86IHN0cmluZyB8IG51bGxcbiAgICAgICAgICB1c2VyX3R5cGU/OiBcImluZGl2aWR1YWxcIiB8IFwicGFydG5lclwiIHwgXCJ0aGVyYXBpc3RcIiB8IFwiYWRtaW5cIlxuICAgICAgICAgIHBhcnRuZXJfaWQ/OiBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgY3JlYXRlZF9hdD86IHN0cmluZ1xuICAgICAgICAgIHVwZGF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgICBpc192ZXJpZmllZD86IGJvb2xlYW5cbiAgICAgICAgICBpc19hY3RpdmU/OiBib29sZWFuXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHRoZXJhcGlzdHM6IHtcbiAgICAgICAgUm93OiB7XG4gICAgICAgICAgaWQ6IHN0cmluZ1xuICAgICAgICAgIHVzZXJfaWQ6IHN0cmluZ1xuICAgICAgICAgIHNwZWNpYWxpemF0aW9uOiBzdHJpbmdcbiAgICAgICAgICBtZGNuX2NvZGU6IHN0cmluZ1xuICAgICAgICAgIGV4cGVyaWVuY2VfeWVhcnM6IG51bWJlclxuICAgICAgICAgIGJpbzogc3RyaW5nIHwgbnVsbFxuICAgICAgICAgIGhvdXJseV9yYXRlOiBudW1iZXJcbiAgICAgICAgICBpc192ZXJpZmllZDogYm9vbGVhblxuICAgICAgICAgIHZlcmlmaWNhdGlvbl9zdGF0dXM6IFwicGVuZGluZ1wiIHwgXCJhcHByb3ZlZFwiIHwgXCJyZWplY3RlZFwiXG4gICAgICAgICAgY3JlYXRlZF9hdDogc3RyaW5nXG4gICAgICAgICAgdXBkYXRlZF9hdDogc3RyaW5nXG4gICAgICAgIH1cbiAgICAgICAgSW5zZXJ0OiB7XG4gICAgICAgICAgaWQ/OiBzdHJpbmdcbiAgICAgICAgICB1c2VyX2lkOiBzdHJpbmdcbiAgICAgICAgICBzcGVjaWFsaXphdGlvbjogc3RyaW5nXG4gICAgICAgICAgbWRjbl9jb2RlOiBzdHJpbmdcbiAgICAgICAgICBleHBlcmllbmNlX3llYXJzOiBudW1iZXJcbiAgICAgICAgICBiaW8/OiBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgaG91cmx5X3JhdGU6IG51bWJlclxuICAgICAgICAgIGlzX3ZlcmlmaWVkPzogYm9vbGVhblxuICAgICAgICAgIHZlcmlmaWNhdGlvbl9zdGF0dXM/OiBcInBlbmRpbmdcIiB8IFwiYXBwcm92ZWRcIiB8IFwicmVqZWN0ZWRcIlxuICAgICAgICAgIGNyZWF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgICB1cGRhdGVkX2F0Pzogc3RyaW5nXG4gICAgICAgIH1cbiAgICAgICAgVXBkYXRlOiB7XG4gICAgICAgICAgaWQ/OiBzdHJpbmdcbiAgICAgICAgICB1c2VyX2lkPzogc3RyaW5nXG4gICAgICAgICAgc3BlY2lhbGl6YXRpb24/OiBzdHJpbmdcbiAgICAgICAgICBtZGNuX2NvZGU/OiBzdHJpbmdcbiAgICAgICAgICBleHBlcmllbmNlX3llYXJzPzogbnVtYmVyXG4gICAgICAgICAgYmlvPzogc3RyaW5nIHwgbnVsbFxuICAgICAgICAgIGhvdXJseV9yYXRlPzogbnVtYmVyXG4gICAgICAgICAgaXNfdmVyaWZpZWQ/OiBib29sZWFuXG4gICAgICAgICAgdmVyaWZpY2F0aW9uX3N0YXR1cz86IFwicGVuZGluZ1wiIHwgXCJhcHByb3ZlZFwiIHwgXCJyZWplY3RlZFwiXG4gICAgICAgICAgY3JlYXRlZF9hdD86IHN0cmluZ1xuICAgICAgICAgIHVwZGF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcGFydG5lcnM6IHtcbiAgICAgICAgUm93OiB7XG4gICAgICAgICAgaWQ6IHN0cmluZ1xuICAgICAgICAgIHVzZXJfaWQ6IHN0cmluZ1xuICAgICAgICAgIG9yZ2FuaXphdGlvbl9uYW1lOiBzdHJpbmdcbiAgICAgICAgICBvcmdhbml6YXRpb25fdHlwZTogXCJob3NwaXRhbFwiIHwgXCJjbGluaWNcIiB8IFwibmdvXCIgfCBcInNjaG9vbFwiIHwgXCJjb3Jwb3JhdGVcIiB8IFwiZ292ZXJubWVudFwiXG4gICAgICAgICAgY29udGFjdF9wZXJzb246IHN0cmluZ1xuICAgICAgICAgIHBob25lOiBzdHJpbmdcbiAgICAgICAgICBhZGRyZXNzOiBzdHJpbmdcbiAgICAgICAgICB3ZWJzaXRlOiBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgaXNfdmVyaWZpZWQ6IGJvb2xlYW5cbiAgICAgICAgICB2ZXJpZmljYXRpb25fc3RhdHVzOiBcInBlbmRpbmdcIiB8IFwiYXBwcm92ZWRcIiB8IFwicmVqZWN0ZWRcIlxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IHN0cmluZ1xuICAgICAgICAgIHVwZGF0ZWRfYXQ6IHN0cmluZ1xuICAgICAgICB9XG4gICAgICAgIEluc2VydDoge1xuICAgICAgICAgIGlkPzogc3RyaW5nXG4gICAgICAgICAgdXNlcl9pZDogc3RyaW5nXG4gICAgICAgICAgb3JnYW5pemF0aW9uX25hbWU6IHN0cmluZ1xuICAgICAgICAgIG9yZ2FuaXphdGlvbl90eXBlOiBcImhvc3BpdGFsXCIgfCBcImNsaW5pY1wiIHwgXCJuZ29cIiB8IFwic2Nob29sXCIgfCBcImNvcnBvcmF0ZVwiIHwgXCJnb3Zlcm5tZW50XCJcbiAgICAgICAgICBjb250YWN0X3BlcnNvbjogc3RyaW5nXG4gICAgICAgICAgcGhvbmU6IHN0cmluZ1xuICAgICAgICAgIGFkZHJlc3M6IHN0cmluZ1xuICAgICAgICAgIHdlYnNpdGU/OiBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgaXNfdmVyaWZpZWQ/OiBib29sZWFuXG4gICAgICAgICAgdmVyaWZpY2F0aW9uX3N0YXR1cz86IFwicGVuZGluZ1wiIHwgXCJhcHByb3ZlZFwiIHwgXCJyZWplY3RlZFwiXG4gICAgICAgICAgY3JlYXRlZF9hdD86IHN0cmluZ1xuICAgICAgICAgIHVwZGF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgfVxuICAgICAgICBVcGRhdGU6IHtcbiAgICAgICAgICBpZD86IHN0cmluZ1xuICAgICAgICAgIHVzZXJfaWQ/OiBzdHJpbmdcbiAgICAgICAgICBvcmdhbml6YXRpb25fbmFtZT86IHN0cmluZ1xuICAgICAgICAgIG9yZ2FuaXphdGlvbl90eXBlPzogXCJob3NwaXRhbFwiIHwgXCJjbGluaWNcIiB8IFwibmdvXCIgfCBcInNjaG9vbFwiIHwgXCJjb3Jwb3JhdGVcIiB8IFwiZ292ZXJubWVudFwiXG4gICAgICAgICAgY29udGFjdF9wZXJzb24/OiBzdHJpbmdcbiAgICAgICAgICBwaG9uZT86IHN0cmluZ1xuICAgICAgICAgIGFkZHJlc3M/OiBzdHJpbmdcbiAgICAgICAgICB3ZWJzaXRlPzogc3RyaW5nIHwgbnVsbFxuICAgICAgICAgIGlzX3ZlcmlmaWVkPzogYm9vbGVhblxuICAgICAgICAgIHZlcmlmaWNhdGlvbl9zdGF0dXM/OiBcInBlbmRpbmdcIiB8IFwiYXBwcm92ZWRcIiB8IFwicmVqZWN0ZWRcIlxuICAgICAgICAgIGNyZWF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgICB1cGRhdGVkX2F0Pzogc3RyaW5nXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIHNlc3Npb25zOiB7XG4gICAgICAgIFJvdzoge1xuICAgICAgICAgIGlkOiBzdHJpbmdcbiAgICAgICAgICBjbGllbnRfaWQ6IHN0cmluZ1xuICAgICAgICAgIHRoZXJhcGlzdF9pZDogc3RyaW5nXG4gICAgICAgICAgcGFydG5lcl9pZDogc3RyaW5nIHwgbnVsbFxuICAgICAgICAgIHNlc3Npb25fZGF0ZTogc3RyaW5nXG4gICAgICAgICAgc3RhcnRfdGltZTogc3RyaW5nXG4gICAgICAgICAgZW5kX3RpbWU6IHN0cmluZ1xuICAgICAgICAgIGR1cmF0aW9uX21pbnV0ZXM6IG51bWJlclxuICAgICAgICAgIHNlc3Npb25fdHlwZTogc3RyaW5nXG4gICAgICAgICAgc3RhdHVzOiBcInNjaGVkdWxlZFwiIHwgXCJjb21wbGV0ZWRcIiB8IFwiY2FuY2VsbGVkXCIgfCBcIm5vX3Nob3dcIlxuICAgICAgICAgIGFtb3VudDogbnVtYmVyXG4gICAgICAgICAgcGF5bWVudF9zdGF0dXM6IFwicGVuZGluZ1wiIHwgXCJwYWlkXCIgfCBcInJlZnVuZGVkXCJcbiAgICAgICAgICBub3Rlczogc3RyaW5nIHwgbnVsbFxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IHN0cmluZ1xuICAgICAgICAgIHVwZGF0ZWRfYXQ6IHN0cmluZ1xuICAgICAgICB9XG4gICAgICAgIEluc2VydDoge1xuICAgICAgICAgIGlkPzogc3RyaW5nXG4gICAgICAgICAgY2xpZW50X2lkOiBzdHJpbmdcbiAgICAgICAgICB0aGVyYXBpc3RfaWQ6IHN0cmluZ1xuICAgICAgICAgIHBhcnRuZXJfaWQ/OiBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgc2Vzc2lvbl9kYXRlOiBzdHJpbmdcbiAgICAgICAgICBzdGFydF90aW1lOiBzdHJpbmdcbiAgICAgICAgICBlbmRfdGltZTogc3RyaW5nXG4gICAgICAgICAgZHVyYXRpb25fbWludXRlczogbnVtYmVyXG4gICAgICAgICAgc2Vzc2lvbl90eXBlOiBzdHJpbmdcbiAgICAgICAgICBzdGF0dXM/OiBcInNjaGVkdWxlZFwiIHwgXCJjb21wbGV0ZWRcIiB8IFwiY2FuY2VsbGVkXCIgfCBcIm5vX3Nob3dcIlxuICAgICAgICAgIGFtb3VudDogbnVtYmVyXG4gICAgICAgICAgcGF5bWVudF9zdGF0dXM/OiBcInBlbmRpbmdcIiB8IFwicGFpZFwiIHwgXCJyZWZ1bmRlZFwiXG4gICAgICAgICAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgY3JlYXRlZF9hdD86IHN0cmluZ1xuICAgICAgICAgIHVwZGF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgfVxuICAgICAgICBVcGRhdGU6IHtcbiAgICAgICAgICBpZD86IHN0cmluZ1xuICAgICAgICAgIGNsaWVudF9pZD86IHN0cmluZ1xuICAgICAgICAgIHRoZXJhcGlzdF9pZD86IHN0cmluZ1xuICAgICAgICAgIHBhcnRuZXJfaWQ/OiBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgc2Vzc2lvbl9kYXRlPzogc3RyaW5nXG4gICAgICAgICAgc3RhcnRfdGltZT86IHN0cmluZ1xuICAgICAgICAgIGVuZF90aW1lPzogc3RyaW5nXG4gICAgICAgICAgZHVyYXRpb25fbWludXRlcz86IG51bWJlclxuICAgICAgICAgIHNlc3Npb25fdHlwZT86IHN0cmluZ1xuICAgICAgICAgIHN0YXR1cz86IFwic2NoZWR1bGVkXCIgfCBcImNvbXBsZXRlZFwiIHwgXCJjYW5jZWxsZWRcIiB8IFwibm9fc2hvd1wiXG4gICAgICAgICAgYW1vdW50PzogbnVtYmVyXG4gICAgICAgICAgcGF5bWVudF9zdGF0dXM/OiBcInBlbmRpbmdcIiB8IFwicGFpZFwiIHwgXCJyZWZ1bmRlZFwiXG4gICAgICAgICAgbm90ZXM/OiBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgY3JlYXRlZF9hdD86IHN0cmluZ1xuICAgICAgICAgIHVwZGF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcGF5bWVudHM6IHtcbiAgICAgICAgUm93OiB7XG4gICAgICAgICAgaWQ6IHN0cmluZ1xuICAgICAgICAgIHVzZXJfaWQ6IHN0cmluZ1xuICAgICAgICAgIHNlc3Npb25faWQ6IHN0cmluZyB8IG51bGxcbiAgICAgICAgICBhbW91bnQ6IG51bWJlclxuICAgICAgICAgIHBheW1lbnRfbWV0aG9kOiBcInBheXN0YWNrXCIgfCBcImNyZWRpdHNcIiB8IFwiYmFua190cmFuc2ZlclwiXG4gICAgICAgICAgc3RhdHVzOiBcInBlbmRpbmdcIiB8IFwiY29tcGxldGVkXCIgfCBcImZhaWxlZFwiIHwgXCJyZWZ1bmRlZFwiXG4gICAgICAgICAgcmVmZXJlbmNlOiBzdHJpbmdcbiAgICAgICAgICBjcmVkaXRzX3B1cmNoYXNlZDogbnVtYmVyXG4gICAgICAgICAgY3JlYXRlZF9hdDogc3RyaW5nXG4gICAgICAgICAgdXBkYXRlZF9hdDogc3RyaW5nXG4gICAgICAgIH1cbiAgICAgICAgSW5zZXJ0OiB7XG4gICAgICAgICAgaWQ/OiBzdHJpbmdcbiAgICAgICAgICB1c2VyX2lkOiBzdHJpbmdcbiAgICAgICAgICBzZXNzaW9uX2lkPzogc3RyaW5nIHwgbnVsbFxuICAgICAgICAgIGFtb3VudDogbnVtYmVyXG4gICAgICAgICAgcGF5bWVudF9tZXRob2Q6IFwicGF5c3RhY2tcIiB8IFwiY3JlZGl0c1wiIHwgXCJiYW5rX3RyYW5zZmVyXCJcbiAgICAgICAgICBzdGF0dXM/OiBcInBlbmRpbmdcIiB8IFwiY29tcGxldGVkXCIgfCBcImZhaWxlZFwiIHwgXCJyZWZ1bmRlZFwiXG4gICAgICAgICAgcmVmZXJlbmNlOiBzdHJpbmdcbiAgICAgICAgICBjcmVkaXRzX3B1cmNoYXNlZDogbnVtYmVyXG4gICAgICAgICAgY3JlYXRlZF9hdD86IHN0cmluZ1xuICAgICAgICAgIHVwZGF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgfVxuICAgICAgICBVcGRhdGU6IHtcbiAgICAgICAgICBpZD86IHN0cmluZ1xuICAgICAgICAgIHVzZXJfaWQ/OiBzdHJpbmdcbiAgICAgICAgICBzZXNzaW9uX2lkPzogc3RyaW5nIHwgbnVsbFxuICAgICAgICAgIGFtb3VudD86IG51bWJlclxuICAgICAgICAgIHBheW1lbnRfbWV0aG9kPzogXCJwYXlzdGFja1wiIHwgXCJjcmVkaXRzXCIgfCBcImJhbmtfdHJhbnNmZXJcIlxuICAgICAgICAgIHN0YXR1cz86IFwicGVuZGluZ1wiIHwgXCJjb21wbGV0ZWRcIiB8IFwiZmFpbGVkXCIgfCBcInJlZnVuZGVkXCJcbiAgICAgICAgICByZWZlcmVuY2U/OiBzdHJpbmdcbiAgICAgICAgICBjcmVkaXRzX3B1cmNoYXNlZD86IG51bWJlclxuICAgICAgICAgIGNyZWF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgICB1cGRhdGVkX2F0Pzogc3RyaW5nXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNyZWRpdHM6IHtcbiAgICAgICAgUm93OiB7XG4gICAgICAgICAgaWQ6IHN0cmluZ1xuICAgICAgICAgIHVzZXJfaWQ6IHN0cmluZ1xuICAgICAgICAgIGNyZWRpdHNfYmFsYW5jZTogbnVtYmVyXG4gICAgICAgICAgY3JlZGl0c191c2VkOiBudW1iZXJcbiAgICAgICAgICBjcmVkaXRzX3B1cmNoYXNlZDogbnVtYmVyXG4gICAgICAgICAgbGFzdF91cGRhdGVkOiBzdHJpbmdcbiAgICAgICAgfVxuICAgICAgICBJbnNlcnQ6IHtcbiAgICAgICAgICBpZD86IHN0cmluZ1xuICAgICAgICAgIHVzZXJfaWQ6IHN0cmluZ1xuICAgICAgICAgIGNyZWRpdHNfYmFsYW5jZT86IG51bWJlclxuICAgICAgICAgIGNyZWRpdHNfdXNlZD86IG51bWJlclxuICAgICAgICAgIGNyZWRpdHNfcHVyY2hhc2VkPzogbnVtYmVyXG4gICAgICAgICAgbGFzdF91cGRhdGVkPzogc3RyaW5nXG4gICAgICAgIH1cbiAgICAgICAgVXBkYXRlOiB7XG4gICAgICAgICAgaWQ/OiBzdHJpbmdcbiAgICAgICAgICB1c2VyX2lkPzogc3RyaW5nXG4gICAgICAgICAgY3JlZGl0c19iYWxhbmNlPzogbnVtYmVyXG4gICAgICAgICAgY3JlZGl0c191c2VkPzogbnVtYmVyXG4gICAgICAgICAgY3JlZGl0c19wdXJjaGFzZWQ/OiBudW1iZXJcbiAgICAgICAgICBsYXN0X3VwZGF0ZWQ/OiBzdHJpbmdcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgdGhlcmFwaXN0X2F2YWlsYWJpbGl0eToge1xuICAgICAgICBSb3c6IHtcbiAgICAgICAgICBpZDogc3RyaW5nXG4gICAgICAgICAgdGhlcmFwaXN0X2lkOiBzdHJpbmdcbiAgICAgICAgICBkYXlfb2Zfd2VlazogbnVtYmVyXG4gICAgICAgICAgc3RhcnRfdGltZTogc3RyaW5nXG4gICAgICAgICAgZW5kX3RpbWU6IHN0cmluZ1xuICAgICAgICAgIGlzX2F2YWlsYWJsZTogYm9vbGVhblxuICAgICAgICAgIGNyZWF0ZWRfYXQ6IHN0cmluZ1xuICAgICAgICB9XG4gICAgICAgIEluc2VydDoge1xuICAgICAgICAgIGlkPzogc3RyaW5nXG4gICAgICAgICAgdGhlcmFwaXN0X2lkOiBzdHJpbmdcbiAgICAgICAgICBkYXlfb2Zfd2VlazogbnVtYmVyXG4gICAgICAgICAgc3RhcnRfdGltZTogc3RyaW5nXG4gICAgICAgICAgZW5kX3RpbWU6IHN0cmluZ1xuICAgICAgICAgIGlzX2F2YWlsYWJsZT86IGJvb2xlYW5cbiAgICAgICAgICBjcmVhdGVkX2F0Pzogc3RyaW5nXG4gICAgICAgIH1cbiAgICAgICAgVXBkYXRlOiB7XG4gICAgICAgICAgaWQ/OiBzdHJpbmdcbiAgICAgICAgICB0aGVyYXBpc3RfaWQ/OiBzdHJpbmdcbiAgICAgICAgICBkYXlfb2Zfd2Vlaz86IG51bWJlclxuICAgICAgICAgIHN0YXJ0X3RpbWU/OiBzdHJpbmdcbiAgICAgICAgICBlbmRfdGltZT86IHN0cmluZ1xuICAgICAgICAgIGlzX2F2YWlsYWJsZT86IGJvb2xlYW5cbiAgICAgICAgICBjcmVhdGVkX2F0Pzogc3RyaW5nXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnRlbnQ6IHtcbiAgICAgICAgUm93OiB7XG4gICAgICAgICAgaWQ6IHN0cmluZ1xuICAgICAgICAgIHRpdGxlOiBzdHJpbmdcbiAgICAgICAgICBjb250ZW50X3R5cGU6IFwiYXJ0aWNsZVwiIHwgXCJ2aWRlb1wiIHwgXCJpbWFnZVwiXG4gICAgICAgICAgY2F0ZWdvcnk6IHN0cmluZ1xuICAgICAgICAgIGF1dGhvcl9pZDogc3RyaW5nXG4gICAgICAgICAgY29udGVudDogc3RyaW5nXG4gICAgICAgICAgc3RhdHVzOiBcImRyYWZ0XCIgfCBcInB1Ymxpc2hlZFwiIHwgXCJhcmNoaXZlZFwiXG4gICAgICAgICAgdmlld3M6IG51bWJlclxuICAgICAgICAgIHRhZ3M6IHN0cmluZ1tdXG4gICAgICAgICAgY3JlYXRlZF9hdDogc3RyaW5nXG4gICAgICAgICAgdXBkYXRlZF9hdDogc3RyaW5nXG4gICAgICAgIH1cbiAgICAgICAgSW5zZXJ0OiB7XG4gICAgICAgICAgaWQ/OiBzdHJpbmdcbiAgICAgICAgICB0aXRsZTogc3RyaW5nXG4gICAgICAgICAgY29udGVudF90eXBlOiBcImFydGljbGVcIiB8IFwidmlkZW9cIiB8IFwiaW1hZ2VcIlxuICAgICAgICAgIGNhdGVnb3J5OiBzdHJpbmdcbiAgICAgICAgICBhdXRob3JfaWQ6IHN0cmluZ1xuICAgICAgICAgIGNvbnRlbnQ6IHN0cmluZ1xuICAgICAgICAgIHN0YXR1cz86IFwiZHJhZnRcIiB8IFwicHVibGlzaGVkXCIgfCBcImFyY2hpdmVkXCJcbiAgICAgICAgICB2aWV3cz86IG51bWJlclxuICAgICAgICAgIHRhZ3M/OiBzdHJpbmdbXVxuICAgICAgICAgIGNyZWF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgICB1cGRhdGVkX2F0Pzogc3RyaW5nXG4gICAgICAgIH1cbiAgICAgICAgVXBkYXRlOiB7XG4gICAgICAgICAgaWQ/OiBzdHJpbmdcbiAgICAgICAgICB0aXRsZT86IHN0cmluZ1xuICAgICAgICAgIGNvbnRlbnRfdHlwZT86IFwiYXJ0aWNsZVwiIHwgXCJ2aWRlb1wiIHwgXCJpbWFnZVwiXG4gICAgICAgICAgY2F0ZWdvcnk/OiBzdHJpbmdcbiAgICAgICAgICBhdXRob3JfaWQ/OiBzdHJpbmdcbiAgICAgICAgICBjb250ZW50Pzogc3RyaW5nXG4gICAgICAgICAgc3RhdHVzPzogXCJkcmFmdFwiIHwgXCJwdWJsaXNoZWRcIiB8IFwiYXJjaGl2ZWRcIlxuICAgICAgICAgIHZpZXdzPzogbnVtYmVyXG4gICAgICAgICAgdGFncz86IHN0cmluZ1tdXG4gICAgICAgICAgY3JlYXRlZF9hdD86IHN0cmluZ1xuICAgICAgICAgIHVwZGF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgYWRtaW5fbG9nczoge1xuICAgICAgICBSb3c6IHtcbiAgICAgICAgICBpZDogc3RyaW5nXG4gICAgICAgICAgYWRtaW5faWQ6IHN0cmluZ1xuICAgICAgICAgIGFjdGlvbjogc3RyaW5nXG4gICAgICAgICAgdGFibGVfbmFtZTogc3RyaW5nXG4gICAgICAgICAgcmVjb3JkX2lkOiBzdHJpbmcgfCBudWxsXG4gICAgICAgICAgb2xkX3ZhbHVlczogYW55IHwgbnVsbFxuICAgICAgICAgIG5ld192YWx1ZXM6IGFueSB8IG51bGxcbiAgICAgICAgICBpcF9hZGRyZXNzOiBzdHJpbmdcbiAgICAgICAgICB1c2VyX2FnZW50OiBzdHJpbmdcbiAgICAgICAgICBjcmVhdGVkX2F0OiBzdHJpbmdcbiAgICAgICAgfVxuICAgICAgICBJbnNlcnQ6IHtcbiAgICAgICAgICBpZD86IHN0cmluZ1xuICAgICAgICAgIGFkbWluX2lkOiBzdHJpbmdcbiAgICAgICAgICBhY3Rpb246IHN0cmluZ1xuICAgICAgICAgIHRhYmxlX25hbWU6IHN0cmluZ1xuICAgICAgICAgIHJlY29yZF9pZD86IHN0cmluZyB8IG51bGxcbiAgICAgICAgICBvbGRfdmFsdWVzPzogYW55IHwgbnVsbFxuICAgICAgICAgIG5ld192YWx1ZXM/OiBhbnkgfCBudWxsXG4gICAgICAgICAgaXBfYWRkcmVzczogc3RyaW5nXG4gICAgICAgICAgdXNlcl9hZ2VudDogc3RyaW5nXG4gICAgICAgICAgY3JlYXRlZF9hdD86IHN0cmluZ1xuICAgICAgICB9XG4gICAgICAgIFVwZGF0ZToge1xuICAgICAgICAgIGlkPzogc3RyaW5nXG4gICAgICAgICAgYWRtaW5faWQ/OiBzdHJpbmdcbiAgICAgICAgICBhY3Rpb24/OiBzdHJpbmdcbiAgICAgICAgICB0YWJsZV9uYW1lPzogc3RyaW5nXG4gICAgICAgICAgcmVjb3JkX2lkPzogc3RyaW5nIHwgbnVsbFxuICAgICAgICAgIG9sZF92YWx1ZXM/OiBhbnkgfCBudWxsXG4gICAgICAgICAgbmV3X3ZhbHVlcz86IGFueSB8IG51bGxcbiAgICAgICAgICBpcF9hZGRyZXNzPzogc3RyaW5nXG4gICAgICAgICAgdXNlcl9hZ2VudD86IHN0cmluZ1xuICAgICAgICAgIGNyZWF0ZWRfYXQ/OiBzdHJpbmdcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICBWaWV3czoge1xuICAgICAgW18gaW4gbmV2ZXJdOiBuZXZlclxuICAgIH1cbiAgICBGdW5jdGlvbnM6IHtcbiAgICAgIFtfIGluIG5ldmVyXTogbmV2ZXJcbiAgICB9XG4gICAgRW51bXM6IHtcbiAgICAgIFtfIGluIG5ldmVyXTogbmV2ZXJcbiAgICB9XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJjcmVhdGVCcm93c2VyQ2xpZW50Iiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VBbm9uS2V5IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJzdXBhYmFzZSIsInJlYWx0aW1lIiwiZW5hYmxlZCIsImNyZWF0ZVNlcnZlckNsaWVudCIsInNlcnZlclN1cGFiYXNlVXJsIiwic2VydmljZVJvbGVLZXkiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiYW5vbktleSIsImNvbnNvbGUiLCJsb2ciLCJsZW5ndGgiLCJzZXJ2ZXJTdXBhYmFzZUtleSIsImF1dGgiLCJwZXJzaXN0U2Vzc2lvbiJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabase.ts\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fverify-magic-link%2Froute&page=%2Fapi%2Fauth%2Fverify-magic-link%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fverify-magic-link%2Froute.ts&appDir=%2FUsers%2Fmacbook%2FDesktop%2Ftrpi-app%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmacbook%2FDesktop%2Ftrpi-app&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fverify-magic-link%2Froute&page=%2Fapi%2Fauth%2Fverify-magic-link%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fverify-magic-link%2Froute.ts&appDir=%2FUsers%2Fmacbook%2FDesktop%2Ftrpi-app%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmacbook%2FDesktop%2Ftrpi-app&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/./node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_macbook_Desktop_trpi_app_app_api_auth_verify_magic_link_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/auth/verify-magic-link/route.ts */ \"(rsc)/./app/api/auth/verify-magic-link/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"standalone\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/auth/verify-magic-link/route\",\n        pathname: \"/api/auth/verify-magic-link\",\n        filename: \"route\",\n        bundlePath: \"app/api/auth/verify-magic-link/route\"\n    },\n    resolvedPagePath: \"/Users/macbook/Desktop/trpi-app/app/api/auth/verify-magic-link/route.ts\",\n    nextConfigOutput,\n    userland: _Users_macbook_Desktop_trpi_app_app_api_auth_verify_magic_link_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIvaW5kZXguanM/bmFtZT1hcHAlMkZhcGklMkZhdXRoJTJGdmVyaWZ5LW1hZ2ljLWxpbmslMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmF1dGglMkZ2ZXJpZnktbWFnaWMtbGluayUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmF1dGglMkZ2ZXJpZnktbWFnaWMtbGluayUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRm1hY2Jvb2slMkZEZXNrdG9wJTJGdHJwaS1hcHAlMkZhcHAmcGFnZUV4dGVuc2lvbnM9dHN4JnBhZ2VFeHRlbnNpb25zPXRzJnBhZ2VFeHRlbnNpb25zPWpzeCZwYWdlRXh0ZW5zaW9ucz1qcyZyb290RGlyPSUyRlVzZXJzJTJGbWFjYm9vayUyRkRlc2t0b3AlMkZ0cnBpLWFwcCZpc0Rldj10cnVlJnRzY29uZmlnUGF0aD10c2NvbmZpZy5qc29uJmJhc2VQYXRoPSZhc3NldFByZWZpeD0mbmV4dENvbmZpZ091dHB1dD1zdGFuZGFsb25lJnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ3FCO0FBQ3VCO0FBQ3BHO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix5R0FBbUI7QUFDM0M7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsc0RBQXNEO0FBQzlEO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzBGOztBQUUxRiIsInNvdXJjZXMiOlsiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvbWFjYm9vay9EZXNrdG9wL3RycGktYXBwL2FwcC9hcGkvYXV0aC92ZXJpZnktbWFnaWMtbGluay9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJzdGFuZGFsb25lXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2F1dGgvdmVyaWZ5LW1hZ2ljLWxpbmsvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9hdXRoL3ZlcmlmeS1tYWdpYy1saW5rXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9hdXRoL3ZlcmlmeS1tYWdpYy1saW5rL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL21hY2Jvb2svRGVza3RvcC90cnBpLWFwcC9hcHAvYXBpL2F1dGgvdmVyaWZ5LW1hZ2ljLWxpbmsvcm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICB3b3JrQXN5bmNTdG9yYWdlLFxuICAgICAgICB3b3JrVW5pdEFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHdvcmtBc3luY1N0b3JhZ2UsIHdvcmtVbml0QXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fverify-magic-link%2Froute&page=%2Fapi%2Fauth%2Fverify-magic-link%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fverify-magic-link%2Froute.ts&appDir=%2FUsers%2Fmacbook%2FDesktop%2Ftrpi-app%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmacbook%2FDesktop%2Ftrpi-app&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(ssr)/./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!******************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "child_process":
/*!********************************!*\
  !*** external "child_process" ***!
  \********************************/
/***/ ((module) => {

"use strict";
module.exports = require("child_process");

/***/ }),

/***/ "crypto":
/*!*************************!*\
  !*** external "crypto" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("crypto");

/***/ }),

/***/ "dns":
/*!**********************!*\
  !*** external "dns" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("dns");

/***/ }),

/***/ "events":
/*!*************************!*\
  !*** external "events" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("events");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("fs");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "net":
/*!**********************!*\
  !*** external "net" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("net");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "os":
/*!*********************!*\
  !*** external "os" ***!
  \*********************/
/***/ ((module) => {

"use strict";
module.exports = require("os");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("path");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "tls":
/*!**********************!*\
  !*** external "tls" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("tls");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "util":
/*!***********************!*\
  !*** external "util" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("util");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions","vendor-chunks/jose","vendor-chunks/cookie","vendor-chunks/nodemailer"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fauth%2Fverify-magic-link%2Froute&page=%2Fapi%2Fauth%2Fverify-magic-link%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fauth%2Fverify-magic-link%2Froute.ts&appDir=%2FUsers%2Fmacbook%2FDesktop%2Ftrpi-app%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fmacbook%2FDesktop%2Ftrpi-app&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=standalone&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();